      SUBROUTINE BUILD.DF.SUB(F.CLIENTS,F.CARRIERS,F.TRANSPORT,F.TABLES,F.FILE,VIN,VOUT)
************************************************************************
* Program name : BUILD.DF.SUB
* Author       : David R. Friend
* Date written : 08/06/97
* Library      : FBBP
* COPYRIGHT (C) 2016 - AFS LOGISTICS LLC - ALL RIGHTS RESERVED.
*
* This program builds a delimited file for all the bills
* paid during the specified dates so data can be worked
* with under excel.monitor rating requests by hour
*
* Last updated by afs (AFSLOGISTICS\nmeddaugh) at 08:03:12 on 10/15/2021.
*
* Start modification history
* 032499 - Tami Seago
* 030501 - David Friend changed from a program to a subroutine
* 110102 - JMK01 - ADD LCC FILTER FOR PROCESS
* 090803 - JMK02 - ADD MISROUTE EMAIL ATTACHMENT
* 102703 - JMK03 - ONLY RETURN RECORD NAME IF DATA EXISTS
* 111303 - JMK04 - ADD SS ACCESS FILTERS TO PROCESSING
* 121003 - JMK05 - ADD LTL DETAIL TO OUTPUT DEFINITIONS
* 121703 - JMK06 - ADD SUMMATION TO OUTPUT
* 012004 - JMK07 - CORRECT INITIALIZATION FOR JMK05
* 020304 - JMK08 - ADD EXCLUSION FOR SUMMARY
* 020504 - JMK09 - ADD CALL FOR DARLING BLENDED RATE
* 072304 - JMK10 - FILTER OUT POSSIBLE '"' MARKS IN DATA
* 110504 - JMK11 - ADD OPTIONS FOR AFS OR SCT CLIENT GROUPS
* 120704 - JMK12 - ADD USER FIELDS FOR EXPORT
* 121304 - JMK13 - MAKE USER FIELDS LIKE TEXT FOR OUTPUT
* 121504 - JMK14 - ADD STC CLIENT SCAC CODE TO OUTPUT
* 121704 - JMK15 - ADD INITIAL AND SERVICE SALESMAN TO OUTPUT 22
* 122104 - KWM01 - ADDED EXCEPTION AROUND QUOTED FIELDS FOR MOYNO 01244
* 012605 - KWM01 - ADDED EXCEPTION FOR AARCOPR 10272 FOR QUOTED FIELDS
* 021105 - JMK16 - ADD USER FIELD TAG FOR EXCLE MACRO HANDLING
* 040505 - JMK17 - MAKE SURE THE ADD.CHAR PROCESS WORKS FOR FB.2.3.NW AS WELL AS FB.3.1.NEW
* 040805 - JMK18 - ADD GET-LIST OPTION FOR CLIENTS
* 042105 - JMK19 - ADD TL OPTIONS FOR FB FILTERS
* 042205 - JMK20 - ADD EDI/PPR COLUMN FOR REVIEW
* 050205 - JMK21 - EDI/PPR ADJUSTMENTS
* 062705 - JMK22 - EDI/PPR ADJUSTMENTS
* 080405 - JMK23 - ADD ELECTRONIC BILL INC/EXC OPTIONS
* 101205 - JMK24 - ADD FB.PROC.DATE.XREF PRE-SELECT TO HISTORY REPORTS
* 111805 - JMK25 - DISABLE FB.PROC.DATE.XREF FOR CLIENT 00000
* 022106 - JMK26 - SET EXPENSE CODES INTO FIXED POSITIONS FOR 01418 AIRGAS
* 022806 - JMK27 - ADD SAMPLE ONE OPTION TO EXPEDITE PROCESSING
* 050106 - JCW01 - ADD INBOUND/OUTBOUND/THIRD PARTY OPTION
* 050906 - JCW02 - CHANGES TO @SELECTED, CLEARSELECT, AND STMT<X>
* 052206 - JMK28 - ADD TRANSLATE FOR REJ.CODES
* 062606 - JMK29 - PERFORM VEND/CUST READ IF VEND OR CUST IS TURNED ON
* 061606 - JCW03 - USE EDI.BILLS.HIST,CLIENT.ID
* 101306 - JMK30 - MOVE OPEN OF EDI.BILLS.HIST,CLIENT.ID WITH FB.BILLS
* 011707 - JCW04 - C200611150003 ADD "FEDEX" CARRIER OPTION
* 011807 - JCW05 - C200701150005 COPY COL E TO COL AW FOR FEDEX GROUND 'PPR' BILLS
* 032807 - JMK31 - C200703260002 / ASAP /  Servicing Salesman & Manager Weekly Report Emails
* 042307 - JCW06 - C200704230003 / CHANGE AN EXPENSE CODE FOR 01418 - AIRGAS-GREAT LAKES
* 122807 - NPR01 - ADDED LAST AUDITED DATE AND TIME
* 031108 - JMK32 - T080799 - Remove duplicates in FB History Reporting
* 032008 - JMK33 - C080617 - TL FSC Estimation
* 032608 - JMK34 - CORRECT DUPLICATE BILL COUNTER FOR PROGRESS BAR
* 042508 - JMK35 - C080617 - TL FSC Estimation
* 050808 - JMK36 - C081128 - Modilfy BLS new filed 'FedEx Num of Pcs' to include all modes piece count
* 102708 - JMK37 - T082265 - Fuel Surcharge Data
* 110308 - JMK38 - T081156 - Change BLS column heading from Benchmark to Gross Charges
* 111108 - JMK39 - C082504 - Change BLS heading back to "Benchmark Charge" for one client #01524 Total Biz Fulfillment
* 112108 - JMK40 - C082566 - Ohio Gratings 1474  ; Needs pro number / bol formatting stripped out of BLS file
* 120508 - JMK41 - C082639 - Add option to remove file breaks for Excel 2007 format
* 011909 - JMK42 - C090048 - Alcon Labs ; FedEx Details
* 020509 - JMK43 - CORRECTED A PROBLEM WITH THE DIVISION FLAG VARIABLE
* 021309 - JMK44 - CHANGE LCC FILTER FROM NULL TO > 0
* 021809 - JMK45 - Make Client translation read from CLIENT.ID
* 021909 - JMK46 - ADD TRANSLATION TO READ THE SALESMAN NAME
* 031709 - JMK47 - C090272 - Report Reqest: only shipments to/from HI, AK and PR for specified time period.
* 032009 - JMK48 - T090400 - Actic MFG No LCC Generated
* 032509 - JMK49 - C090307 - Change to reports for Calgon Carbon (Macro / BLS)
* 041409 - JMK50 - C090501 - Alcon parcel report needs to have headers
* 041609 - JMK51 - C090352 - Provide logistics the ability to see all data captured on international bills.
* 042309 - JMK52 - C090307 - Change to reports for Calgon Carbon (Macro / BLS)
* 042309 - JMK53 - T090479 - LCC not calculated correctly #1518 Airpro
* 050109 - JMK54 - T090590 - Client on troubleshoot and emails still went out to the client
* 060809 - NPR02 - T090622 - Added STACK filter
* 061009 - JMK55 - C090669 - LCC Emails ; with transit times
* 070909 - JMK56 - C090893 - Image Projections West: Add customer information
* 111209 - JMK57 - C091367 - Customer Vender reports ; restrict access
* 112309 - JMK58 - C091313 - needs help with coding for Airgas Great Lakes
* 012010 - JMK59 - T100052 - Amounts on SS report for H&K do not match
* 021510 - JMK60 - C091468 - New columns on the BLS file
* 031910 - JMK61 - ADD REXEL UPS DETAILS TO NEW BLS FILE CALLED "ALL"
* 041210 - JMK62 - C100317 - For Rawson - Custom Report: Marked Up version of TCR on weekly process email.
* 042710 - JMK63 - C100385 - Adjust Rawson users and the TCR Report
* 061710 - JMK64 - C100525 - Additional access requested: commissions on SS reports
* 082610 - JMK65 - ADD OPTIONS FOR 'UNI' CLIENTS
* 102010 - JMK66 - ADD OPTIONS FOR "ONCE" PROCESSING
* 102610 - NPR03 - T101045 - Write BLS file to Latrobe FTP directory
* 111110 - JMK67 - T101109 - Vendor codes #30004 AM General
* 112310 - NPR04 - T999999 - Add option to allow seperated City & State columns based on zip - See T.FILE='CSZ'
* 011811 - JMK68 - C999999 - ADD ZONE TO THE BLS AND PARCEL REPORTS
* 021511 - NPR05 - T999999 - Added/revised conversion BDU to return "Y" if AFS BOL data used or else "N"
* 022211 - NPR06 - T999999 - Added/revised conversion BDU again to return "Y" if AFS BOL data used or else "N"
* 031711 - JMK69 - T110111 - Rexel "ALL" Weekly Report is empty when UPS is only carrier.
* 032211 - JMK70 - T999999 - ADD ALL REPORT TO WABTREC PROCESSING (0187)
* 050311 - JMK71 - T999999 - ADD ALL REPORT TO WABTREC PROCESSING (01979)
* 050311 - JMK72 - T999999 - CORRECT THE FILE USED FOR REPORTING WHEN CLIENT = "ALL"
* 050611 - NPR07 - T101205 - Add option to select only Bills with accesorial charges other than FSC type 'M' on LI.CODES
* 052511 - JMK74 - C110561 - No CSCAC code populated in column GS for UPS 41 within the All report
* 090611 - JMK75 - PROJECT 49 - WABTEC CUSTOM MACROS
* 090711 - DFP01 - PROJECT 55 - ADD MESSAGE TO TRUE COST REPORT
* 091411 - JMK76 - PROJECT 81 - Rexel Area Reporting for "ALL" Report
* 091911 - JMK77 - R111155 - Alcon GL coding needs to be copied over from 15 & 1075 to carrier #41
* 101211 - JMK78 - ADD CAVENDERS (01825) TO ALL REPORTING
* 101711 - JMK79 - SysAid#31 - Cavender's Stores LTD All report
* 102411 - JMK80 - SysAid#31 - Cavender's Stores LTD All report
* 110711 - JMK81 - SysAid#319 - Alcon parcel reports
* 111711 - JMK82 - SysAid#349 - Consulting Commision cap
* 110211 - DS001 - PROJ94    - SS Report option for multi division numbers
* 011612 - SWB01 - PROJ93    - Add BOL Source to report as last column
* 021612 - JMK83 - SysAid#928 - UPS Coding for SVP
* 032612 - DFP02 - PROJECT 187 - PREVENT AUTOMATICALLY  CHANGING FB.STATUS WHEN GREIGHT BILL IS REJECTED OR MODIFIED.
* 042312 - JMK84 - SysAid#2487 - H&K Canada - GST not reporting correctly
* 061212 - JMK85 - Add UFM to the company selection options
* 072312 - RLM01 - Sysaid #3073 - Replace former employees' email addresses with current employees
* 100512 - JMK86 - SysAid#4429 - Tracking the BD resolution process
* 022213 - JMK86 - SysAid#5224 - Transit TIme Advantage
* 050613 - JMK87 - SHV Freight Data File
* 051513 - JMK88 - SysAid#5919 - Commission visibility - Hot Shot for PMARQUARDT
* 062013 - JMK89 - SysAid#6168 - Add the -ALL report to processing
* 071813 - JMK90 - SysAid#6384 - SS reports - commission
* 072413 - DRF01 - SysAid#6508 - Added the special character to the TEM report
* 082813 - JMK91 - SysAid#6885 - EFE Repport is showing = infront of the pro
* 091013 - JMK92 - Project#xxx - Add time to the Freight Data Report for uniqueness
* 091113 - JMK93 - Create B460 Report for Rexel 01706
* 091613 - JMK94 - SysAid#7020 - TJ Pniak access to shared drives and universe.
* 091613 - JMK95 - Adjust the name of the adjustment folder for post invoice adjustments.
* 101813 - JMK96 - SysAid#7436 - Excessive Freight Expense-BOL
* 120613 - JMK97 - Zero out charges for SVP Worldwide (01322) when UPS freight bills are zeroed out
* 121213 - JMK98 - SysAid#7968 - SVP ALL report
* 123113 - JMK99 - SysAid#8072 - SVP ALL Report
* 010614 - JMK100 - SysAid#7614 - BLS report for Lund
* 012914 - JMK101 - Frt Data Export for Weekly and Processing days
* 072214 - DRF02 - Special unprocess 01706 unprocess 9999 bills
* 073014 - JMK102 - SysAid#11040 - Freight data transfer looks to have failed 4074
* 090514 - DRF03 - SysAid 11967 - Unassigned variable fix with an non existing division is selected.
* 091014 - JMK103 - SysAid#11833 - Springs Window Fashions Match Pay File
* 100614 - JMK104 - SysAid#11833 - Springs Window Fashions Match Pay File - Add check digit to AAA Cooper pros
* 102014 - JMK105 - SysAid#11833 - Springs Window Fashions Match Pay File - Add check digit to USF Reddaway pros
* 111414 - JMK106 - SysAid#13235 - Freight class not visible in SLC reporting for freight clients transferred to SHV
* 011315 - JMK107 - Change SLC Freight Data Export email from Kent Crowley to Raju
* 021815 - SWB02  - SysAid#9955  - New version 600 for Cutback Reconcilliation
* 030915 - DRF04 - SysAid 15615 - Added 02138 to the ALL report
* 030915 - SWB04  - SysAid#13523 - Wabtec Master Billing reports
* 032515 - SWB03  - SysAid#12480 - New version 610 emphasising Accessorials
* 040215 - SWB05 -  SysAid# 12480 bug fix to keep ACC code from appending
*                   after previous dollar amount
* 070115 - DRF05 -  SysAid 18393 Gave Robbie Jester access
* 120815 - GRB01 - Add PROGTRACK monitor for length of processing
* 030316 - GRB02 - Correct issue of quote inserting in pro # and expense
* 040716 - GRB03 - SysAid 23651 limit length of division # for 01267
* 060816 - GRB04 - SysAid# 24578 change calculation for true cost on master billing unfunded report
* 062716 - GRB05 - SysAID# 25283 Add Ord# to misroute report
* 082416 - GRB06 - SysAid# 26611 Create new column for ver 25 that will calc diff of the 2 proceeding columns
* 083016 - DRF06 - SysAid 26388 Special condensed report for 05495 Thoro
* 111416 - GRB07 - SysAid# 28510 Add overcharge commission to true cost calculation
* 012017 - TAG01 - Set Default Data String Length to 50
* 032117 - TAG02 - Change email address to AFSAnalyticsConfig@afs.net
* 091817 - GRB08 - ME 6748 Remove string limitation
* 092717 - DRF07 - Ticket 7046 - Email not working. This happened because the client was setup for troubleshooting email. I check to make sure it is not an auto email
* 111317 - DRF08 - Ticket 7398 - Removed zero lines item for UPS data for 01706 Rexel
* 032318 - GRB09 - ME 10728 - Create version 26 with reject dt and reject approval DT
* 071118 - DRF09 -  Special report for 05813 Arcelormittal
* 021519 - GRB10 - Skip inactive clients on SLC
* 092019 - GRB11 - ACCU-571 Add min charge flag and line haul charge
* 110191 - GRB12 - ANALYTICS-161 remove "CWT" from amount field  so SLC FRT extract
* 111919 - DRF10 - ACCU-659 Added a special version for check bank E and R
* 021920 - GRB13 - ACCU-480 Automated processing
* 022020 - GRB14 - ACCU-773 Add bill fee for Air Gas
* 060120 - DRF11 - ACCU-873 Special SS for Lion Group Accessorial Report
* 101320 - DRF12 - ACCU-1014 Save BLS file to FTP.BOL.TO.210 for clients
*                  02427, 05654, 06006, and 06007
* 061421 - NKH01 - ACCU-1189 Remove weight if there is no associated class
* 062421 - NKH02 - ACCU-1239 Removed PO starting with WH for client 5589 and carrier 18
* 071521 - NKH03 - ACCU-1239 Removed PO starting with WH for client 5589 and carriers 453,1002,14
* 101521 - NKH04 - ACCU-1419 Add scan date to version 681
* 041922 - DRF13 - INT-28 Send BLS to FTP folder for SMA 01067
* 051122 - NKH05 - ACCU-1733 Removed check digit for Reddaway
* 080822 - DRF14 - ACCU-1824 Special report for 07252 AER Dahmer
* 101022 - DRF15 - ACCU-1920 Change per bill fee from 7.625 to 7.600 and
*                  0.475 to 0.450
* 011623 - DRF16 - ACCU-2018 Change per bill fee from 7.600 to 8.55 and
*                  0.450 to 0.500
* 011623 - DRF17 - ACCU-2022 Do not calculate a fee on AD or BD for Airgas
* 052323 - NKH06 - ACCU-2178 Show weight for AFS Advantage TL bills
* 060523 - DRF18 - ACCU-2220 Change per bill fee from 8.55 to 9.10 and
*                  0.500 to 0.500
* 070723 - GRB15 - ACCU-2299 Add check digit for spring windows saia
* 071023 - DRF19 - ACCU-2312 Change per bill fee from 9.10 to 9.125 and
*                  0.500 to 0.525
* 012924 - DRF20 - ACCU-2563 Change per bill fee from 9.125 to 9.43 and
*                  0.525 to 0.570
* 040124 - DRF21 - ACCU-2622 Do not calculated an estimated fuel for
*                  client 01015 Hillyard for carrier 32353 Cowdery
* 052824 - DRF22 - INT-343 Have BPTS show as PPR not EDI
* End modification history
*********************************************************************
* VIN<1>=CLIENT               CLIENT NUMBER
*                             CAN BE CLIENT NUMBER OR 'ALL'
*
* VIN<2>=LOG.ONLY             CHOICE FOR LOGISTICS CLIENTS ONLY
*                             VALID SELECTIONS (Y/N)
*
* VIN<3>=CARRIER              CARRIER NUMBER
*                             CAN BE CARRIER NUMBER OR 'ALL'
*
* VIN<4>=MODE                 TRANSPORTATION MODE
*                             THIS IS ONLY ASKED FOR IF CARRIER IS EQUAL TO 'ALL'
*                             IF YOU SPECIFY CARRIER - LEAVE THIS NULL!!!
*
* VIN<5>=FILE.SEL             FILE SELECTION
*                             VALID SELECTIONS ARE 1 - TEMP
*                                                  2 - HISTORY
*                                                  3 - LAST PROCESSED
*                             THIS IS ONLY NEEDED IF CLIENT IS EQUAL TO 'ALL'
*
* VIN<6>=BEG.DATE             BEGINNING DATE - IF CLIENT IS SPECIFIED
*                             AND YOU HAVE SELECTED 3 FOR FILE.SEL (LAST PROCESSED)
*                             THEN BEG.DATE AND END.DATE=NULL
*
* VIN<7>=END.DATE             ENDING DATE - IF CLIENT IS SPECIFIED
*                             AND YOU HAVE SELECTED 3 FOR FILE.SEL (LAST PROCESSED)
*                             THEN BEG.DATE AND END.DATE NEED TO BE NULL
*
* VIN<8>=CUT.BACK.CODE        CUT BACK CODE - LEAVE NULL FOR ALL (NO PREFERENCE)
*
* VIN<9>=MISROUTE.INFO        MISROUTE INFO - VALID SELECTIONS ARE...
*                                 'I' - INCLUDE MISROUTE ONLY
*                                 'E' - EXCLUDE MISROUTE ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<10>=OVERCHARGE.INFO     OVERCHARGE INFO - VALID SELECTIONS ARE...
*                                 'I' - INCLUDE OVERCHARGE ONLY
*                                 'E' - EXCLUDE OVERCHARGE ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<11>=LOGISTICS.INFO      LOGISTICS INFO - VALID SELECTIONS ARE...
*                                 'I' - INCLUDE LOGISTICS ONLY
*                                 'E' - EXCLUDE LOGISTICS ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<12>=DISCOUNT.INFO       DISCOUNT INFO - VALID SELECTIONS ARE...
*                                 'I' - INCLUDE DISCOUNTS ONLY
*                                 'E' - EXCLUDE DISCOUNTS ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<13>=VERSION             VERSION NUMBER - IF CLIENT[1,2]='99'
*                             THEN VERSION NUMBER WILL BE SET TO 8
*
* VIN<14>=TYPE.OF.REPORT       VALID SELECTIONS ARE...
*                              STANDARD (STD) => AUTO.EMAIL = 0
*                              REGULAR EMAIL (EMAIL) => AUTO.EMAIL = 1
*                              DIVISIONAL EMAIL (EMAIL-DIV) => AUTO.EMAIL = 1
*
* VIN<15>=SEPARATE.DIVISIONS   SEPARATE REPORT FOR DIVISION
*
* VIN<16>=DIVISIONAL.ID        DIVISION ID TO USE
*
* VIN<17>=SORT                 SORT OPTION
*
* VIN<18>=MANUAL.EMAIL         MANUAL EMAIL
*
* VIN<19>=NEW.EMAIL.ADDR       ADDRESS TO BE EMAILED TO
*
* VIN<20>=DIV.EMAIL.ADDR       ADDRESS FOR DIVISION TO BE EMAILED TO
*
* VIN<21>=USER                 USER ID
*
* VIN<22>=CH.NUM               CHANNEL NUMBER
*
* VIN<23>=AUTO                 LAST PROCESSING DATES
*
* VIN<24>=CUT.DESC             CUT BACK DESCRIPTION
*
* VIN<25>=FROM.FB.3.1.NEW      THIS IS SET TO THE LITERAL 'FROM FB.3.1.NEW' IF
*                              THE CALLING PROGRAM IS FB.3.1.NEW OR 'FROM FB.2.3.NW'
*                              IF THE CALLING PROGRAM IS FB.2.3.NW.
* VIN<26>=USING.NEW.MACRO      SWITCH SET IN FB.3.1.NEW
*                              INSERTS A "?" BEFORE CERTAIN FIELDS FOR MACRO TO WORK
* VIN<27>=DUP.ONLY             SWITCH SET IN BUILD.DF.NW.
*                              1 MEANS USE ONLY DUPLICATES
*                              0 MEANS USE ONLY NON-DUPLICATES
* VIN<28>=INC.BD               SWITCH SET IN BUILD.DF.NW.
*                              1 MEANS INCLUDE BALANCE DUE AMOUNTS WITH OVERCHARGES
*                              0 MEANS DO NOT INCLUDE BALANCE DUE AMOUNTS WITH OVERCHARGES
* VIN<29>=LCC.INFO             LCC INFO - VALID SELECTIONS ARE...
*                                 'I' - INCLUDE LCC ONLY
*                                 'E' - EXCLUDE LCC ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<30>=FBLIST              FREIGHT BILL LIST FROM MISROUTE EMAIL    ; * JMK02
*
* VIN<31>=CLIENT.ACCESS       SS CLIENT ACCESS FILTERS ; * JMK04
*
* VIN<32>=CARRIER.ACCESS      SS CARRIER ACCESS FILTER ; * JMK04
*
* VIN<33>=SALES.ACCESS        SS SALES ACCESS FILTER ; * JMK04
*
* VIN<34>=COMM.ACCESS         SS COMMISSION ACCESS FILTER ; * JMK04
*
* VIN<35>=TL.INFO             TL PARAMETERS FOR FB FILTER ; * JMK19
*
* VIN<36>=EBILL.INFO          EBILL PARAMETERS FOR FB FILTER ; * JMK23
*
* VIN<37>=SAMPLE.ONE          PROCESS ONE FB AND MOVE ON ; * JMK27
*
* VIN<38>=INCLUDE.IOT         INCLUDE OR EXCLUDE IOT INFO - VALID SELECTIONS ARE... ; * JCW01
*                                 'I' - INCLUDE ONLY
*                                 'E' - EXCLUDE ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<39>=IOT.INFO            VALID SELECTIONS ARE... ; * JCWO1
*                                 'I' - INBOUND
*                                 'O' - OUTBOUND
*                                 'T' - THIRD PARTY
*
* VIN<40>=REJ.INFO            REJ INFO - VALID SELECTIONS ARE... ; * JMK28
*                                'I' - INCLUDE REJ ONLY          ; * JMK28
*                                'E' - EXCLUDE REJ ONLY          ; * JMK28
*                                'N' - NO PREFERENCE             ; * JMK28
*
* VIN<41>=ROW.LIMIT           ROW.LIMIT - VALID SELECTIONS ARE...      ; * JMK41
*                                'O' - OLD LIMIT OF 65000    ; * JMK41
*                                'N' - NEW LIMIT OF 1040000  ; * JMK41
*
* VIN<42>=ST.FILTER           LIST OF STATE CODES TO FILTER FB ; * JMK47
*
* VIN<43>=STACK.FILTER        Stack Number 1 2 3 4 or nothing  ; * NPR02
*
* VIN<44>=REPORT.STYLE        'T' OR '' EQUALS TEXT ; DEFAULT          ; * JMK60
*                             'H' EQUALS HTML      ; * JMK60
*
* VIN<45>=ONCE                OPTION FOR TROUBLESHOOTING EMAIL BYPASS ; * JMK66
* VIN<46>=ACCESS.ONLY         Accessorials Only - type 'M' on FB.TABLES 'LI.CODES' item   ; * NPR07
*                                'I' - INCLUDE Accessorials ONLY                          ; * NPR07
*                                'E' - EXCLUDE Accessorials ONLY                          ; * NPR07
*                                'N' - NO PREFERENCE                                      ; * NPR07
*
* VIN<47>=BD.ONLY             VALID SELECTIONS ARE...
*                                 'I' - INCLUDE ONLY
*                                 'E' - EXCLUDE ONLY
*                                 'N' - NO PREFERENCE
*
* VIN<48>=HDG.ONLY            VALID SELECTIONS ARE...
*                                 'I' - INCLUDE (DEFAULT)
*                                 'E' - EXCLUDE
*
**********************************************************************************************************

$INCLUDE PROG.ADMIN INC_OPTIONS

*
* Assign parameters
*
      PROG.NAME='BUILD.DF.SUB'
      CLIENT=VIN<1>
      CL.LST=''                          ; * JMK18
      IF CLIENT[1,1]='(' THEN            ; * JMK18
         CL.LST=CLIENT[2,9999]           ; * JMK18

         CLIENT='ALL'                    ; * JMK18
      END                                ; * JMK18
      LOG.ONLY=VIN<2>
      CARRIER=VIN<3>
      MODE=VIN<4>
      FILE.SEL=VIN<5>
      BEG.DATE=VIN<6>
      END.DATE=VIN<7>
      CUT.BACK.CODE=VIN<8>
      MISROUTE.INFO=VIN<9>
      OVERCHARGE.INFO=VIN<10>
      LOGISTICS.INFO=VIN<11>
      DISCOUNT.INFO=VIN<12>
      VERSION=VIN<13>
      IF VERSION='' THEN VERSION=1
      SLC.FRT=0                          ; * JMK87
      IF VERSION='752' THEN SLC.FRT=1    ; * JMK87
      SLC.ADJ=0                          ; * JMK87
      IF VERSION='753' THEN SLC.ADJ=1    ; * JMK87
      VERSION.DESC = ""
      TYPE.OF.REPORT=VIN<14>
      SEPARATE.DIVISIONS=VIN<15>
      DIVISIONAL.ID=VIN<16>
      DIVISIONAL.ID.CNT=DCOUNT(VIN<16>,@VM)        ; * DS001
      SORT=VIN<17>
      IF SORT='' THEN SORT=1
      MANUAL.EMAIL=VIN<18>
      NEW.EMAIL.ADDR=VIN<19>
      DIV.EMAIL.ADDR=VIN<20>
      USER=VIN<21>

      CH.NUM=VIN<22>
      AUTO=VIN<23>
      IF VERSION = "26" THEN AUTO = 0
      CUT.DESC=VIN<24>
      WHERE.FROM=VIN<25>
      USING.NEW.MACRO=VIN<26>
      DUP.ONLY=VIN<27>
      INC.BD=VIN<28>
      LCC.INFO=VIN<29>                   ; * JMK01
      FBLIST=VIN<30>                     ; * JMK02
      CLIENT.ACCESS=VIN<31>              ; * JMK04
      IF CLIENT.ACCESS='' THEN CLIENT.ACCESS='ALL'           ; * JMK04
      CARRIER.ACCESS=VIN<32>             ; * JMK04
      IF CARRIER.ACCESS='' THEN CARRIER.ACCESS='ALL'         ; * JMK04
      SALES.ACCESS=VIN<33>               ; * JMK04
      IF SALES.ACCESS='' THEN SALES.ACCESS='ALL'   ; * JMK04
      COMM.ACCESS=VIN<34>                ; * JMK04
      IF COMM.ACCESS='' THEN COMM.ACCESS='Y'       ; * JMK04
      TL.INFO=VIN<35>                    ; * JMK19
      EBILL.INFO=VIN<36>                 ; * JMK23
      SAMPLE.ONE=VIN<37>                 ; * JMK27
      INCLUDE.IOT=VIN<38>                ; * JCW01
      IOT.INFO=VIN<39>                   ; * JCW01
      REJ.INFO=VIN<40>                   ; * JMK28
      ROW.LIMIT=VIN<41>                  ; * JMK41
      ROW.MAX=65000                      ; * JMK41
      IF ROW.LIMIT='N' THEN              ; * JMK41
         ROW.MAX=1040000                 ; * JMK41
      END                                ; * JMK41
      ST.FILTER=VIN<42>                  ; * JMK47
      ST.LIST=''                         ; * JMK47
      IF ST.FILTER#'' THEN               ; * JMK47
         ST.LIST=CHANGE(ST.FILTER,' ',@VM)         ; * JMK47
      END                                ; *JMK47

      STACK.FILTER=VIN<43>               ; * NPR02
      STACK.LIST=''                      ; * NPR02
      IF STACK.FILTER#'' THEN            ; * NPR02
         STACK.LIST=CHANGE(STACK.FILTER,' ',@VM)   ; * NPR02
      END                                ; * NPR02
      RPT.STYLE=VIN<44>                  ; * JMK60
      IF VERSION='610' THEN              ; * SWB03
*Always output in tab delimited with .xls  ; * SWB03
         RPT.STYLE='T'                   ; * SWB03
      END                                ; * SWB03
      ONCE=VIN<45>+0                     ; * JMK66
      ACCESS.ONLY = VIN<46>              ; * NPR07
      BD.ONLY=VIN<47>                    ; * JMK86
      HDG.ONLY=VIN<48>                   ; * JMK100
      DIV.COUNT = 0
      CITY.STATE = ''
      COUNTER.1 = 0

      UPL.VIN = 'FBBP' ; UPL.VIN<2> = 'BUILD.DF.SUB' ; UPL.VOUT = ''   ; * NPR_UPL 04/22/2010
      UPL.VIN<3> = USER
      UPL.VIN<4> = CH.NUM
      CALL UPD.PROGRAM.LOG(UPL.VIN,UPL.VOUT)       ; * NPR_UPL 04/22/2010
* Begin GRB01
      VIN1=""
      VIN1<1> = UPL.VIN<2>
      VIN1<2> = USER
      VIN1<3> = SYSTEM(18)
      VIN1<4> = "S"
*****      CALL PROGTRACK(VIN1,VOUT1)
* End GRB01
      DIM CLIENT.REC(350),PRO.REC(350),DIV.REC(50),TEMP.REC(350),FB.DIV.REC(50),DSPECS(25)
      MAT CLIENT.REC = '' ; MAT PRO.REC = '' ; MAT DIV.REC = "" ; MAT TEMP.REC = '' ; MAT FB.DIV.REC = ''
      MAT DSPECS = ""
      PRFX='FMT'                         ; * JMK02
      IF WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' THEN      ; * JMK02
         PRFX='MRS'                      ; * JMK02
      END                                ; * JMK02
      JMK.MESSAGE=''                     ; * JMK03
      NATT=DCOUNT(VIN,@AM)               ; * JMK03
      FOR X=1 TO NATT                    ; * JMK03
         JMK.MESSAGE<1,X>=VIN<X>         ; * JMK03
      NEXT X                             ; * JMK03
      ***CLIENT.REC=''                      ; * JMK12
      DTL.CAPTURE=0                      ; * JMK51
      DTL.ARRAY=''                       ; * JMK51
      IF VERSION='115' THEN              ; * JMK51
         DTL.CAPTURE=1                   ; * JMK51
      END                                ; * JMK51
      ALL.RPT=0                          ; * JMK78

      IF CLIENT='01394' THEN ALL.RPT=1
      IF CLIENT='05043' THEN ALL.RPT=1
      IF CLIENT='01581' THEN ALL.RPT=1   ; * JMK89
      IF CLIENT='01706' THEN ALL.RPT=1   ; * JMK78
      IF CLIENT='01825' THEN ALL.RPT=1   ; * JMK78
      IF CLIENT='01633' THEN ALL.RPT=1
      IF TYPE.OF.REPORT='EMAIL' OR TYPE.OF.REPORT='EMAIL-DIV' THEN
         AUTO.EMAIL=1
      END ELSE
         AUTO.EMAIL=0
      END


      IF FILE.SEL=1 OR FILE.SEL=4 OR FILE.SEL=5 THEN
         FILE='FB.BILLS,':CLIENT
      END ELSE
         FILE='FB.BILLS.HIST,':CLIENT
      END
      IF RPT.STYLE='H' THEN              ; * JMK60
         DARRAY.HTML=''                  ; * JMK60
         DARRAY.HTML<1>=\<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" LANG="EN-US">\  ; * JMK60
         DARRAY.HTML<-1>=\<HTML>\        ; * JMK60
         DARRAY.HTML<-1>=\<STYLE>\       ; * JMK60
         DARRAY.HTML<-1>=\<!--\          ; * JMK60
         DARRAY.HTML<-1>=\TABLE { font-size : x-small}\      ; * JMK60
         DARRAY.HTML<-1>=\-->\           ; * JMK60
         DARRAY.HTML<-1>=\</STYLE>\      ; * JMK60
         DARRAY.HTML<-1>=\<BODY>\        ; * JMK60
         DARRAY.HTML<-1>=\<TABLE BORDER="0" WIDTH="100%">\   ; * JMK60
         DARRAY.HTML<-1>=\<TR><TD ALIGN="CENTER"><FONT SIZE="2" COLOR="RED"><I>For best results, please print in landscape view.</I></FONT></TD></TR>\           ; * JMK60
         DARRAY.HTML<-1>=\</TABLE>\      ; * JMK60
         LNCOLOR=0                       ; * JMK60
      END                                ; * JMK60

*
* Initialize variables
*
      TAB=CHAR(9)
      DIVS=''
      VOUT=''
      LINE.COUNT = 3
      NAME.EXT = ''
      EXPAND.ACC = 0                     ; * SWB03
      COL.HEAD.ROW = 0                   ; * SWB03
*
* Open general files
*
*IF USER = 'NMEDDAUGH' THEN
*      OPEN '','ANA.FIX' TO F.FIX ELSE
*         CALL OPEN.ABORT2("ANA.FIX",PROG.NAME)
*         GOTO EXIT.PROGRAM
*      END
*END

      OPEN '','FB.BUILD.SPEC' TO F.BUILD.SPEC ELSE
         CALL OPEN.ABORT2("FB.BUILD.SPEC",PROG.NAME)
         GOTO EXIT.PROGRAM
      END

      OPEN '','FB.CUT.BACKS' TO F.CUT.BACKS ELSE
         CALL OPEN.ABORT2("FB.CUT.BACKS",PROG.NAME)
         GOTO EXIT.PROGRAM
      END
      OPEN '','ZIPS.CODES' TO F.ZIPS ELSE
         CALL OPEN.ABORT2("ZIPS",PROG.NAME)
         GOTO EXIT.PROGRAM
      END
      OPEN '','CAN.ZIP.CODES' TO F.CAN.ZIPS ELSE   ; * JMK35
         CALL OPEN.ABORT2("CAN.ZIP.CODES",PROG.NAME)         ; * JMK35
         GOTO EXIT.PROGRAM
      END                                ; * JMK35
      OPEN '','CLIENT.SCAC' TO F.CSCAC ELSE        ; * JMK14
         CALL OPEN.ABORT2("CLIENT.SCAC",PROG.NAME)           ; * JMK14
         GOTO EXIT.PROGRAM
      END                                ; * JMK14
      OPEN '','AR.SLSMAN.1000.1' TO F.SLSMAN ELSE  ; * JMK15
         CALL OPEN.ABORT2("AR.SLSMAN.1000.1",PROG.NAME)      ; * JMK15
         GOTO EXIT.PROGRAM
      END                                ; * JMK15
      OPEN '','UPSDATA' TO F.UPSDATA ELSE
         CALL OPEN.ABORT2('F.UPSDATA',PROG.NAME)
         GOTO EXIT.PROGRAM
      END

      READ LI.CODES FROM F.TABLES,'LI.CODES' ELSE
         CALL ELINE('Cannot read LI.CODES from FB.TABLES')
         GOTO EXIT.PROGRAM
      END
      READ AIR.CODES FROM F.TABLES,'AIR.CODES' ELSE          ; * JMK87
         CALL ELINE('Cannot read AIR.CODES from FB.TABLES')  ; * JMK87
         GOTO EXIT.PROGRAM               ; * JMK87
      END                                ; * JMK87
      READ INTL.CODES FROM F.TABLES,'INTL.CODES' ELSE        ; * JMK87
         CALL ELINE('Cannot read INTL.CODES from FB.TABLES')           ; * JMK87
         GOTO EXIT.PROGRAM               ; * JMK87
      END                                ; * JMK87
      READ OVR.CODES FROM F.TABLES,'OVRCHG.CODES' ELSE
         CALL ELINE('Cannot read OVRCHG.CODES from FB.TABLES')
         GOTO EXIT.PROGRAM
      END
      READ REJ.CODES FROM F.TABLES,'REJECT.CODES' ELSE       ; * JMK28
         CALL ELINE('Cannot read REJECT.CODES from FB.TABLES')         ; * JMK28
         GOTO EXIT.PROGRAM               ; * JMK28
      END                                ; * JMK28
      READ AFS.SERV.LEV FROM F.TABLES,'AIR.SERVLEV*BASE' ELSE
         CALL ELINE('Cannot read AIR.SERVLEV*BASE from FB.TABLES')
         GOTO EXIT.PROGRAM
      END
      IF VERSION='11' AND RPT.STYLE='H' THEN       ; * DFP01
         READ TCR.TXT FROM F.TABLES,'TCR.TXT' ELSE           ; * DFP01
            CALL ELINE('Cannot read TCR.TXT from FB.TABLES')           ; * DFP01
            GOTO EXIT.PROGRAM            ; * DFP01
         END                             ; * DFP01
         TCRTXT1=TCR.TXT<1>              ; * DFP01
         TCRTXT2=TCR.TXT<2>              ; * DFP01
         TCRTXT3=TCR.TXT<3>              ; * DFP01
      END                                ; * DFP01

      IF CLIENT='02275' AND VERSION='265' THEN     ; * JMK100
         OPEN '','FTP.LUND' TO F.FTP.LUND ELSE     ; * JMK100
            CALL OPEN.ABORT2("FTP.LUND",PROG.NAME)           ; * JMK100
            GOTO EXIT.PROGRAM
         END                             ; * JMK100
      END                                ; * JMK100

      IF CLIENT='01706' AND WHERE.FROM='FROM FB.3.1.NEW' THEN
         OPEN '','FTP.REXEL' TO F.FTP.REXEL ELSE
            CALL OPEN.ABORT2("FTP.REXEL",PROG.NAME)
            GOTO EXIT.PROGRAM
         END
      END
      IF CLIENT='2192' AND WHERE.FROM='FROM FB.3.1.NEW' THEN
         OPEN '','FTP.02192.REPORTS' TO F.FTP.02192 ELSE
            CALL OPEN.ABORT2("FTP.02192.REPORTS",PROG.NAME)
            GOTO EXIT.PROGRAM
         END
      END
      IF CLIENT='01067' AND WHERE.FROM='FROM FB.3.1.NEW' THEN          ; *DRF13
         OPEN '','FTP.SMA' TO F.FTP.SMA ELSE       ; * DRF13
            CALL OPEN.ABORT2("FTP.SMA",PROG.NAME)  ; * DRF13
            GOTO EXIT.PROGRAM            ; * DRF13
         END                             ; * DRF13
      END                                ; * DRF13
      IF CLIENT='02427' OR CLIENT='05654' OR CLIENT='06006' OR CLIENT='06007' THEN         ; * DRF12
         IF WHERE.FROM='FROM FB.3.1.NEW' THEN      ; * DRF12
            OPEN '','FTP.BLS_TO_210' TO F.FTP.BLS.TO.210 ELSE          ; * DRF12
               CALL OPEN.ABORT2("FTP.BLS.TO.210",PROG.NAME)  ; * DRF12
               GOTO EXIT.PROGRAM         ; * DRF12
            END                          ; * DRF12
         END                             ; * DRF12
      END                                ; * DRF12
      OPEN '','FB.TL.FSC' TO F.TL.FSC ELSE         ; * JMK33
         CALL OPEN.ABORT2("FB.TL.FSC",PROG.NAME)   ; * JMK33
         GOTO EXIT.PROGRAM
      END                                ; * JMK33
      OPEN '','PCIN' TO F.PCIN ELSE      ; * JMK33
         CALL OPEN.ABORT2("PCIN",PROG.NAME)        ; * JMK33
         GOTO EXIT.PROGRAM
      END                                ; * JMK33
      OPEN '','PCOUT' TO F.PCOUT ELSE    ; * JMK33
         CALL OPEN.ABORT2("PCOUT",PROG.NAME)       ; * JMK33
         GOTO EXIT.PROGRAM
      END                                ; * JMK33
      OPEN '','FB.MILEAGE' TO F.MILEAGE ELSE       ; * JMK33
         CALL OPEN.ABORT2("FB.MILEAGE",PROG.NAME)  ; * JMK33
         GOTO EXIT.PROGRAM
      END                                ; * JMK33

      OPEN '','FB.BC.FSC' TO F.NFSC ELSE           ; * JMK33
         CALL OPEN.ABORT2("FB.BC.FSC",PROG.NAME)   ; * JMK33
         GOTO EXIT.PROGRAM
      END                                ; * JMK33
      OPEN '','&SAVEDLISTS&' TO F.SL ELSE          ; * JMK52
         CALL OPEN.ABORT2("&SAVEDLISTS&",PROG.NAME)          ; * JMK52
         GOTO EXIT.PROGRAM
      END                                ; * JMK52
      OPEN '','EDI.CAR.ACNT.XREF' TO F.ECAX ELSE   ; * JMKXX
         CALL OPEN.ABORT2("EDI.CAR.ACNT.XREF",PROG.NAME)     ; * JMKXX
         GOTO EXIT.PROGRAM
      END                                ; * JMKXX
      OPEN '','FB.CARRIER.PAYEE' TO F.CARRIER.PAYEE ELSE     ; * JMK67
         CALL OPEN.ABORT2("FB.CARRIER.PAYEE",PROG.NAME)      ; * JMK67
         GOTO EXIT.PROGRAM
      END                                ; * JMK67
      OPEN '','UPSCOMMTBL' TO F.COMMTBL ELSE       ; * GRB
         CALL OPEN.ABORT2("UPSCOMMTBL",PROG.NAME)  ; * GRB
         GOTO EXIT.PROGRAM
      END                                ; * JMK67
      IF SLC.FRT THEN                    ; * JMK87 ; * JMK95
         OPEN '','SHV.FRT.DATA' TO F.SHV.FRT.DATA ELSE       ; * JMK87
            CALL OPEN.ABORT2("SHV.FRT.DATA.IMPORT",PROG.NAME)          ; * JMK87
            GOTO EXIT.PROGRAM
         END                             ; * JMK87
         OPEN '','SHV.FRT.DATA.HIST' TO F.SHV.FRT.DATA.HIST ELSE       ; * JMK87
            CALL OPEN.ABORT2("SHV.FRT.DATA.HIST",PROG.NAME)  ; * JMK87
            GOTO EXIT.PROGRAM
         END                             ; * JMK87
      END                                ; * JMK87
      IF SLC.ADJ THEN                    ; * JMK87 ; * JMK95
         OPEN '','SHV.ADJ.DATA' TO F.SHV.FRT.DATA ELSE       ; * JMK95
            CALL OPEN.ABORT2("SHV.ADJ.DATA",PROG.NAME)       ; * JMK95
            GOTO EXIT.PROGRAM
         END                             ; * JMK95
         OPEN '','SHV.ADJ.DATA.HIST' TO F.SHV.FRT.DATA.HIST ELSE       ; * JMK95
            CALL OPEN.ABORT2("SHV.ADJ.DATA.HIST",PROG.NAME)  ; * JMK95
            GOTO EXIT.PROGRAM
         END                             ; * JMK95
      END                                ; * JMK95

*
* Set the build version and pull the necessary information
*

      IF VIN<60> #"" THEN
         ID=PRFX:'*':VIN<60>:'*':VERSION           ; * JMK02
      END ELSE
         ID=PRFX:'*':CLIENT:'*':VERSION  ; * JMK02
      END

      MATREAD DSPECS FROM F.BUILD.SPEC,ID ELSE
         ID=PRFX:'**':VERSION            ; * JMK02
         MATREAD DSPECS FROM F.BUILD.SPEC,ID ELSE
            CALL ELINE('An ERROR occurred in BUILD.DF.SUB. Failed on DSPEC read. ID=':ID)
            GOTO EXIT.PROGRAM
         END
      END
      VERSION.DESC = DSPECS(1)
      ID='DF.SORT*':SORT
      READ D.SORT FROM F.TABLES,ID ELSE
         CALL ELINE('Sort Version ':SORT:' has not been setup.')
         GOTO EXIT.PROGRAM
      END
      ITEM.COUNT=DCOUNT(DSPECS(2),@VM)   ; * JMK100
      DARRAY=''                          ; * JMK100
      DARRAY.HTML=''                     ; * JMK100

      IF (CLIENT#'ALL' AND CLIENT#'AFS' AND CLIENT#'SCT' AND CLIENT#'UNI' AND CLIENT#'UFM' AND CLIENT#'LGI') THEN        ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
         CLIENT.ID=CLIENT
         MATREAD CLIENT.REC FROM F.CLIENTS,CLIENT.ID ELSE
            CALL ELINE('ERROR - BUILD.DF did not complete CLIENT.REC read.')
            GOTO EXIT.PROGRAM
         END
         CLIENT.NAME=CLIENT.REC(2)
         IF CLIENT.REC(316) = "1" THEN   ; * GRBXXX
            AIRGAS.FLG = 1
         END ELSE
            AIRGAS.FLG = 0
         END

         IF VERSION='111' THEN
            IF CLIENT.ID#CLIENT.REC(147) THEN
               PARENT.ID=CLIENT.REC(147)
               READV PARENT.NAME FROM F.CLIENTS,PARENT.ID,2 ELSE PARENT.NAME='Unknown Parent'
            END ELSE
               PARENT.ID=CLIENT.ID
               PARENT.NAME=CLIENT.NAME
            END
         END
         OPEN '','EDI.BILLS.HIST,':CLIENT.ID TO EDI.BILLS.HIST THEN    ; * JMK30
            NO.EDI.FILE=0                ; * JMK30
         END ELSE                        ; * JMK30
            NO.EDI.FILE=1                ; * JMK30
         END                             ; * JMK30

         OPEN '','FB.BOL.CRX,':CLIENT.ID TO F.BOL.CRX THEN   ; * NPR05
            BOL.CRX.OPENED = 1           ; * NPR05
         END ELSE                        ; * NPR05
            BOL.CRX.OPENED = 0           ; * NPR05
         END                             ; * NPR05
         OPEN '','FB.BOL.REFNO.XREF,':CLIENT.ID TO F.BOL.REFNO.XREF THEN         ; * NPR05
            BOL.CRX.REFNO.OPENED = 1     ; * NPR05
         END ELSE                        ; * NPR05
            BOL.CRX.REFNO.OPENED = 0     ; * NPR05
         END                             ; * NPR05

         IF ALL.RPT=1 THEN               ; * JMK78
            OPEN '','UPSDTL,':CLIENT.ID TO F.UPSDATA ELSE    ; * JMK78
               CALL OPEN.ABORT2('F.UPSDTL,':CLIENT.ID,PROG.NAME)       ; * JMK78
               GOTO EXIT.PROGRAM
            END                          ; * JMK78
         END                             ; * JMK78

         OPEN '',FILE TO FB.BILLS ELSE
            CALL OPEN.ABORT2(FILE:CLIENT.ID,PROG.NAME)
            GOTO EXIT.PROGRAM
         END
         VEND=CLIENT.REC(20)
         CUST=CLIENT.REC(21)
         ISLS=CLIENT.REC(114)            ; * JMK15
         READ ISLS.REC FROM F.SLSMAN,ISLS ELSE ISLS.REC=''   ; * JMK15
         ISLS.NAME=ISLS.REC<1>           ; * JMK15
         SSLS=CLIENT.REC(115)            ; * JMK15
         READ SSLS.REC FROM F.SLSMAN,SSLS ELSE SSLS.REC=''   ; * JMK15
         SSLS.NAME=SSLS.REC<1>           ; * JMK15

         IF VEND='Y' OR CUST='Y' THEN
            OPEN '','VEND.CUST,':CLIENT.ID TO F.VC ELSE
               F.VC=''
            END
         END ELSE
            F.VC = ''
         END

         DIVISION=CLIENT.REC(12)
         IF DIVISION='Y' THEN
            OPEN '','DIVISION.CODES,':CLIENT.ID TO F.DIVISION ELSE
               CALL OPEN.ABORT2("DIVISION.CODES,":CLIENT.ID,PROG.NAME)
               GOTO EXIT.PROGRAM
            END
            DIV.STMT='SSELECT DIVISION.CODES,':CLIENT.ID
            IF AUTO.EMAIL THEN DIV.STMT=DIV.STMT:' WITH 9'
            EXECUTE DIV.STMT PASSLIST CAPTURING OUTPUT
            DONE=0
            CNTR=0
            LOOP
               READNEXT DIV.ID ELSE DONE=1
            UNTIL DONE DO
               MATREAD DIV.REC FROM F.DIVISION,DIV.ID THEN
                  CNTR+=1
                  DIVS<1,CNTR>=DIV.ID'R%5'
                  DIVS<9,CNTR>=DIV.REC(9)
                  DIVS<11,CNTR>=DIV.REC(11)        ; * Division description
               END
            REPEAT
         END
         IF DIVISIONAL.ID#'ALL' AND DIVISION='Y' THEN
            READ DDIV FROM F.DIVISION,DIVISIONAL.ID THEN
               ZIP.VAR=DDIV<1>
               CALL FB.READ.ZIP(ZIP.VAR,CITY,STATE)
               CITY.STATE=CITY:', ':STATE
               DIV.DESC=DDIV<11>
            END ELSE                     ; * DRF03
               DIV.DESC='Unknown Division'         ; * DRF03
               CITY.STATE='Unknown City and State'           ; * DRF03
            END                          ; * DRF03
         END
      END
*************************************************************************
START.BUILD:***
*************************************************************************
* SELECT CLIENT FILE
*

      IF AUTO.EMAIL THEN
         IF TYPE.OF.REPORT='EMAIL' THEN
            IF HDG.ONLY#'E' THEN         ; * JMK100
               GOSUB DO.HEADINGS
            END                          ; * JMK100
            GOSUB SELECT.BILLS
            IF VERSION='115' AND DTL.CAPTURE THEN  ; * JMK51
               DTL.CAPTURE=0             ; * JMK51
               GO START.BUILD            ; * JMK51
            END                          ; * JMK51
            GOSUB CONTINUE.BUILD
         END ELSE
            IF TYPE.OF.REPORT='EMAIL-DIV' AND DIVISION THEN
               SEPARATE.DIVISIONS=1
               DIVISIONAL.ID='ALL'
               DIV.COUNT=0
               ZIP.VAR=''
               NUM.DIVS=DCOUNT(DIVS<1>,@VM)
               COUNTER.1=0
               CITY.STATE=''
               DIV.EMAIL.ADDR=''
               GOTO 800
            END
         END
         GOTO EXIT.PROGRAM
      END

      TEXT='Selecting Clients.'
      IF @TTY # "phantom" THEN           ; *GRB13
         CALL CENTER(TEXT,80)
         CRT @(0,18):TEXT:@(-3):
      END
*
      IF CL.LST='' THEN                  ; * JMK18
         EXECUTE "SELECT VOC 'FB.BILLS.HIST' *A7" RTNLIST CLIENT.LIST CAPTURING OUTPUT
      END ELSE                           ; * JMK18
         EXECUTE "GET-LIST ":CL.LST RTNLIST CLIENT.LIST CAPTURING OUTPUT
      END                                ; * JMK18
*
      ITEMS = @SELECTED
      IF @SELECTED < 1 THEN              ; * JCW02
         CALL ELINE('ERROR - No clients on file.')
         GOTO EXIT.PROGRAM
      END
      COUNTER.1=0
      PER.1=0

      IF CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN     ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
         IF HDG.ONLY#'E' THEN            ; * JMK100
            GOSUB DO.HEADINGS
         END                             ; * JMK100
         LOOP
            READNEXT CLIENT.ID FROM CLIENT.LIST ELSE CLIENT.ID='DONE'
            IF CLIENT.ID='DONE' ELSE
               MATREAD CLIENT.REC FROM F.CLIENTS,CLIENT.ID ELSE MAT CLIENT.REC=''
               IF CLIENT.REC(316) = "1" THEN       ; * GRBXXX
                  AIRGAS.FLG = 1
               END ELSE
                  AIRGAS.FLG = 0
               END
               BEGIN CASE                ; * JMK11
                  CASE CLIENT='AFS'      ; * JMK11

                     IF CLIENT.REC(92)='00002' OR CLIENT.REC(92)='00003' OR CLIENT.REC(92)='00004' OR CLIENT.REC(92)='00005' THEN GO SKIP.CLIENT       ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
                  CASE CLIENT='SCT'      ; * JMK11
                     IF CLIENT.REC(92)#'00002' THEN GO SKIP.CLIENT     ; * JMK11
                  CASE CLIENT='UNI'      ; * JMK65
                     IF CLIENT.REC(92)#'00003' THEN GO SKIP.CLIENT     ; * JMK65
                  CASE CLIENT='UFM'      ; * JMK85
                     IF CLIENT.REC(92)#'00004' THEN GO SKIP.CLIENT     ; * JMK85
                  CASE CLIENT='LGI'      ; * JMK86
                     IF CLIENT.REC(92)#'00005' THEN GO SKIP.CLIENT     ; * JMK86
                  CASE 1                 ; * JMK11
               END CASE                  ; * JMK11
               IF LOG.ONLY AND CLIENT.REC(93)#'Y' THEN
                  COUNTER.1=COUNTER.1+1
                  IF AUTO.EMAIL=0 THEN CALL PROG.BAR(20,COUNTER.1,ITEMS,PER.1)
                  GOTO SKIP.CLIENT
               END
               IF SALES.ACCESS#'ALL' THEN          ; * JMK04
                  SVC.SLS=CLIENT.REC(115)          ; * JMK04
                  LOCATE(SVC.SLS,SALES.ACCESS,1;SPOS) ELSE   ; * JMK04
                     GOTO SKIP.CLIENT    ; * JMK04
                  END                    ; * JMK04
               END                       ; * JMK04
            END
            IF CLIENT.ID[1,2]='99' THEN GO SKIP.CLIENT
            IF CLIENT.ID[1,2]='98' THEN GO SKIP.CLIENT

            IF CLIENT.ID='00000' AND (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') THEN GO SKIP.CLIENT          ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
            CLIENT.LAST.PROCESSED=CLIENT.REC(82)
         UNTIL CLIENT.ID='DONE' DO
            COUNTER.1=COUNTER.1+1

            IF (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') AND FILE.SEL=2 THEN  ; * IF all Clients and From History file ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
               IF CLIENT.LAST.PROCESSED='' THEN GO SKIP.CLIENT         ; ** No need to look if no bills were processed
               IF BEG.DATE > CLIENT.LAST.PROCESSED THEN GO SKIP.CLIENT           ; ** No need to look for Bills if BEG.DATE is Later than last processed
            END
            IF CLIENT.ID='FB.BILLS.HIST' THEN GO SKIP.CLIENT
            IF USER='brian' THEN
               IF (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') THEN    ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
                  IF VERSION#'8' AND CLIENT.ID[1,2]='99' THEN GO SKIP.CLIENT
                  IF CLIENT.ID[1,2]='98' THEN GO SKIP.CLIENT
                  IF CLIENT.REC(30)#'A' THEN GO SKIP.CLIENT
               END
            END ELSE
               IF VERSION#'8' AND CLIENT.ID[1,2]='99' THEN GO SKIP.CLIENT
            END

            IF CLIENT.REC(2)='' THEN
               CLIENT.NAME='*** Not On File ***'
            END ELSE
               CLIENT.NAME=CLIENT.REC(2)
            END
            IF AUTO.EMAIL ELSE
               IF @TTY # "phantom" THEN  ; *GRB13
                  CRT @(0,17):CLIENT.ID:" ":CLIENT.NAME:" - Now selecting freight bills":@(-4):
                  CALL PROG.BAR(20,COUNTER.1,ITEMS,PER.1)
               END
            END
            DIVISION=CLIENT.REC(12)      ; * JMK43
            IF DIVISION='Y' THEN         ; * JMK43
               OPEN '','DIVISION.CODES,':CLIENT.ID TO F.DIVISION ELSE  ; * JMK43
                  CALL OPEN.ABORT("DIVISION.CODES,":CLIENT.ID,PROG.NAME)         ; * JMK43
               END                       ; * JMK43
               DIV.STMT='SSELECT DIVISION.CODES,':CLIENT.ID  ; * JMK43
               IF AUTO.EMAIL THEN DIV.STMT=DIV.STMT:' WITH 9'          ; * JMK43
               EXECUTE DIV.STMT PASSLIST RTNLIST DIV.LIST CAPTURING OUTPUT       ; * JMK43
               DONE=0                    ; * JMK43
               CNTR=0                    ; * JMK43
               LOOP                      ; * JMK43
                  READNEXT DIV.ID FROM DIV.LIST ELSE DONE=1  ; * JMK43
               UNTIL DONE DO             ; * JMK43
                  MATREAD DIV.REC FROM F.DIVISION,DIV.ID THEN          ; * JMK43
                     CNTR+=1             ; * JMK43
                     DIVS<1,CNTR>=DIV.ID'R%5'      ; * JMK43
                     DIVS<9,CNTR>=DIV.REC(9)       ; * JMK43
                     DIVS<11,CNTR>=DIV.REC(11)     ; * Division description ; * JMK43
                  END                    ; * JMK43
               REPEAT                    ; * JMK43
            END                          ; * JMK43
            IF DIVISIONAL.ID#'ALL' AND DIVISION='Y' THEN     ; * JMK43
               READ DDIV FROM F.DIVISION,DIVISIONAL.ID THEN  ; * JMK43
                  ZIP.VAR=DDIV<1>        ; * JMK43
                  CALL FB.READ.ZIP(ZIP.VAR,CITY,STATE)       ; * JMK43
                  CITY.STATE=CITY:', ':STATE       ; * JMK43
                  DIV.DESC=DDIV<11>      ; * JMK43
               END                       ; * JMK43
            END                          ; * JMK43

            VEND=CLIENT.REC(20)
            CUST=CLIENT.REC(21)
            IF CLIENT.ID#CLIENT.REC(147) THEN
               PARENT.ID=CLIENT.REC(147)
               READV PARENT.NAME FROM F.CLIENTS,PARENT.ID,2 ELSE PARENT.NAME='Unknown Parent'
            END ELSE
               PARENT.ID=CLIENT.ID
               PARENT.NAME=CLIENT.NAME
            END
            ISLS=CLIENT.REC(114)         ; * JMK15
            READ ISLS.REC FROM F.SLSMAN,ISLS ELSE ISLS.REC=''          ; * JMK15
            ISLS.NAME=ISLS.REC<1>        ; * JMK15
            SSLS=CLIENT.REC(115)         ; * JMK15
            READ SSLS.REC FROM F.SLSMAN,SSLS ELSE SSLS.REC=''          ; * JMK15
            SSLS.NAME=SSLS.REC<1>        ; * JMK15
            IF SLC.FRT OR SLC.ADJ THEN   ; * JMK92

               BEGIN CASE                ; * JMK101
                  CASE CLIENT.REC(30) # "A"        ; * GRB10
                     GO SKIP.CLIENT      ; * GRB10
                  CASE SLC.FRT AND BEG.DATE=END.DATE         ; * JMK101
                     IF CLIENT.REC(241)#'P' THEN   ; * JMK101
                        GO SKIP.CLIENT   ; * JMK101
                     END                 ; * JMK101
                  CASE 1                 ; * JMK101
                     IF CLIENT.REC(241)#'Y' THEN   ; * JMK101
                        GO SKIP.CLIENT   ; * JMK101
                     END                 ; * JMK101
               END CASE                  ; * JMK101
            END                          ; * JMK92

            IF VEND='Y' OR CUST='Y' THEN
               OPEN '','VEND.CUST,':CLIENT.ID TO F.VC ELSE
                  F.VC=''
               END
            END ELSE
               F.VC = ''
            END
            OPEN '','EDI.BILLS.HIST,':CLIENT.ID TO EDI.BILLS.HIST THEN           ; * JMK30
               NO.EDI.FILE=0             ; * JMK30
            END ELSE                     ; * JMK30
               NO.EDI.FILE=1             ; * JMK30
            END                          ; * JMK30

            OPEN '','FB.BOL.CRX,':CLIENT.ID TO F.BOL.CRX THEN          ; * NPR05
               BOL.CRX.OPENED = 1        ; * NPR05
            END ELSE                     ; * NPR05
               BOL.CRX.OPENED = 0        ; * NPR05
            END                          ; * NPR05
            OPEN '','FB.BOL.REFNO.XREF,':CLIENT.ID TO F.BOL.REFNO.XREF THEN      ; * NPR05
               BOL.CRX.REFNO.OPENED = 1  ; * NPR05
            END ELSE                     ; * NPR05
               BOL.CRX.REFNO.OPENED = 0  ; * NPR05
            END                          ; * NPR05

            IF ALL.RPT=1 THEN            ; * JMK78
               OPEN '','UPSDTL,':CLIENT.ID TO F.UPSDATA ELSE           ; * JMK78
                  CALL OPEN.ABORT('F.UPSDTL,':CLIENT.ID,PROG.NAME)     ; * JMK78
               END                       ; * JMK78
            END                          ; * JMK78

            OPEN '','FB.BILLS.HIST,':CLIENT.ID TO FB.BILLS THEN

               IF FILE.SEL=1 OR FILE.SEL=4 OR FILE.SEL=5 THEN          ; * JMK72
                  FILE='FB.BILLS,':CLIENT.ID       ; * JMK72
               END ELSE                  ; * JMK72
                  FILE='FB.BILLS.HIST,':CLIENT.ID  ; * JMK72
               END                       ; * JMK72
               GOSUB SELECT.BILLS
            END

SKIP.CLIENT:***
         REPEAT
         IF VERSION='115' AND DTL.CAPTURE THEN     ; * JMK51
            DTL.CAPTURE=0                ; * JMK51
            GO START.BUILD               ; * JMK51
         END                             ; * JMK51
         GOSUB CONTINUE.BUILD
      END ELSE
800:     IF SEPARATE.DIVISIONS AND DIVISIONAL.ID='ALL' THEN
            DIV.COUNT=0
            ZIP.VAR=''
            NUM.DIVS=DCOUNT(DIVS<1>,@VM)
            IF NUM.DIVS = "" THEN NUM.DIVS = 0
            ITEMS=NUM.DIVS
            LOOP
               DIV.COUNT +=1
               COUNTER.1 +=1
            UNTIL DIV.COUNT > NUM.DIVS
               DIV.ID = DIVS<1,DIV.COUNT>
               READ DDIV FROM F.DIVISION, DIV.ID THEN
                  ZIP.VAR = DDIV<1>
                  CALL FB.READ.ZIP(ZIP.VAR,CITY,STATE)
               END ELSE
                  CITY='' ; STATE=''
               END
               IF CITY='' OR STATE='' THEN
                  CITY.STATE=''
               END ELSE
                  CITY.STATE=CITY:', ': STATE
               END
               IF HDG.ONLY#'E' THEN      ; * JMK100
                  GOSUB DO.HEADINGS
               END                       ; * JMK100
               IF AUTO.EMAIL ELSE
                  IF @TTY # "phantom" THEN         ; *GRB13
                     CRT @(0,17):CLIENT.ID:" ":CLIENT.NAME:" ":"Division: ":DIV.ID:"- Now selecting freight bills":@(-4):
                     CALL PROG.BAR(20,COUNTER.1,ITEMS,PER.1)
                  END
               END
               IF DIV.EMAIL.ADDR = '' THEN NEW.EMAIL.ADDR = DDIV<9>
               GOSUB SELECT.BILLS
               IF VERSION='115' AND DTL.CAPTURE THEN         ; * JMK51
                  DTL.CAPTURE=0          ; * JMK51
                  GO START.BUILD         ; * JMK51
               END                       ; * JMK51
               GOSUB CONTINUE.BUILD
SKIP.DIVISION: ***
            REPEAT
         END ELSE
            IF HDG.ONLY#'E' THEN         ; * JMK100
               GOSUB DO.HEADINGS
            END                          ; * JMK100
            GOSUB SELECT.BILLS
            IF VERSION='115' AND DTL.CAPTURE THEN  ; * JMK51
               DTL.CAPTURE=0             ; * JMK51
               GO START.BUILD            ; * JMK51
            END                          ; * JMK51
            GOSUB CONTINUE.BUILD
         END
      END
********************************************************************
EXIT.PROGRAM:*** End
*******************************************************************
* Begin GRB01
      VIN1=''
      VIN1<1> = UPL.VIN<2>
      VIN1<2> = USER
      VIN1<3> = SYSTEM(18)
      VIN1<4> = "E"
*****      CALL PROGTRACK(VIN1,VOUT1)
* End GRB01
      RETURN
******************************************************************************
DO.HEADINGS:***
****************************************************************************8

      BEGIN CASE                         ; * JMK11
         CASE CLIENT='ALL'               ; * JMK11
            DATA.SUBSET=0                ; * JMK11
         CASE CLIENT='AFS'               ; * JMK11
            DATA.SUBSET=0                ; * JMK11
         CASE CLIENT='SCT'               ; * JMK11
            DATA.SUBSET=0                ; * JMK11
         CASE CLIENT='UNI'               ; * JMK65
            DATA.SUBSET=0                ; * JMK65
         CASE CLIENT='UFM'               ; * JMK85
            DATA.SUBSET=0                ; * JMK85
         CASE CLIENT='LGI'               ; * JMK86
            DATA.SUBSET=0                ; * JMK86
         CASE 1                          ; * JMK11
            DATA.SUBSET=(CARRIER#'ALL') OR (MODE#'ALL') OR (CUT.BACK.CODE#'') OR (MISROUTE.INFO#'N') OR (OVERCHARGE.INFO#'N') OR (LOGISTICS.INFO#'N') OR (DISCOUNT.INFO#'N') OR DUP.ONLY OR (CARRIER='ALL' AND MODE#'ALL') OR (LCC.INFO#'N')     ; * JMK11
      END CASE                           ; * JMK11
      COL.COUNT=DCOUNT(DSPECS(2),@VM)    ; * JMK60
      DARRAY=''

      IF RPT.STYLE='H' THEN              ; * JMK60
         IF VERSION='11' THEN            ; * DFP01
            DARRAY.HTML<-1>=\<TABLE BORDER="5" COLS="5" WIDTH="100%" FRAME="BOX" RULES="NONE">\      ; * JMK60 ; * DFP01
            DARRAY.HTML<-1>=\<COLGROUP>\           ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="CENTER" WIDTH="100">\  ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="LEFT" WIDTH="15%">\    ; * JMK60 ; * DFP01
            DARRAY.HTML:=\<COL ALIGN="CENTER" WIDTH="50%">\  ; * JMK60 ; * DFP01
            DARRAY.HTML:=\<COL ALIGN="CENTER" WIDTH="25%">\  ; * JMK60 ; * DFP01
            DARRAY.HTML:=\<COL ALIGN="RIGHT" WIDTH="10%">\   ; * JMK60 ; * DFP01
         END ELSE                        ; * DFP01
            DARRAY.HTML<-1>=\<TABLE BORDER="5" COLS="4" WIDTH="100%" FRAME="BOX" RULES="NONE">\      ; * JMK60
            DARRAY.HTML<-1>=\<COLGROUP>\           ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="CENTER" WIDTH="100">\  ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="LEFT" WIDTH="20%">\    ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="CENTER" WIDTH="60%">\  ; * JMK60
            DARRAY.HTML:=\<COL ALIGN="RIGHT" WIDTH="20%">\   ; * JMK60
         END                             ; * DFP01
         DARRAY.HTML:=\</COLGROUP>\      ; * JMK60
         DARRAY.HTML<-1>='<TR><TD><IMG SRC="http://www.afs.net/images/AFS_Logo_For_Letterhead_Use_Only.png" BORDER="0" WIDTH="125" HEIGHT="95" ALT="AFS Logistics, LLC" ALIGN="center"></TD>'  ; * JMK60
         DARRAY.HTML:=\<TD ALIGN="CENTER"><FONT SIZE="4">\   ; * JMK60
      END                                ; * JMK60
      BEGIN CASE                         ; * JMK11
         CASE CLIENT='ALL'               ; * JMK11
            IF LOG.ONLY THEN
               DARRAY<1>='File for All Logistics Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\All Logistics Clients \   ; * JMK60
               END                       ; * JMK60
            END ELSE
               DARRAY<1>='File for ALL Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\ALL Clients \   ; * JMK60
               END                       ; * JMK60
            END
         CASE CLIENT='AFS'               ; * JMK11
            IF LOG.ONLY THEN
               DARRAY<1>='File for AFS Logistics Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\AFS Logistics Clients \   ; * JMK60
               END                       ; * JMK60
            END ELSE
               DARRAY<1>='File for AFS Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\AFS Clients \   ; * JMK60
               END                       ; * JMK60
            END
         CASE CLIENT='SCT'               ; * JMK11
            IF LOG.ONLY THEN
               DARRAY<1>='File for Scott Logistics Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\Scott Logistics Clients \           ; * JMK60
               END                       ; * JMK60
            END ELSE
               DARRAY<1>='File for Scott Clients '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML<-1>=\Scott Clients \           ; * JMK60
               END                       ; * JMK60
            END
         CASE CLIENT='UNI'               ; * JMK65
            IF LOG.ONLY THEN             ; * JMK65
               DARRAY<1>='File for Unitrans Logistics Clients '        ; * JMK65
               IF RPT.STYLE='H' THEN     ; * JMK65
                  DARRAY.HTML<-1>=\Unitrans Logistics Clients \        ; * JMK65
               END                       ; * JMK65
            END ELSE                     ; * JMK65
               DARRAY<1>='File for Unitrans Clients '        ; * JMK65
               IF RPT.STYLE='H' THEN     ; * JMK65
                  DARRAY.HTML<-1>=\Unitrans Clients \        ; * JMK65
               END                       ; * JMK65
            END                          ; * JMK65
         CASE CLIENT='UFM'               ; * JMK85
            IF LOG.ONLY THEN             ; * JMK85
               DARRAY<1>='File for UFM Logistics Clients '   ; * JMK85
               IF RPT.STYLE='H' THEN     ; * JMK85
                  DARRAY.HTML<-1>=\UFM Logistics Clients \   ; * JMK85
               END                       ; * JMK85
            END ELSE                     ; * JMK85
               DARRAY<1>='File for UFM Clients '   ; * JMK85
               IF RPT.STYLE='H' THEN     ; * JMK85
                  DARRAY.HTML<-1>=\UFM Clients \   ; * JMK85
               END                       ; * JMK85
            END                          ; * JMK85
         CASE CLIENT='LGI'               ; * JMK86
            IF LOG.ONLY THEN             ; * JMK86
               DARRAY<1>='File for Logica Logistics Clients '          ; * JMK86
               IF RPT.STYLE='H' THEN     ; * JMK86
                  DARRAY.HTML<-1>=\Logica Logistics Clients \          ; * JMK86
               END                       ; * JMK86
            END ELSE                     ; * JMK86
               DARRAY<1>='File for Logica Clients '          ; * JMK86
               IF RPT.STYLE='H' THEN     ; * JMK86
                  DARRAY.HTML<-1>=\Logica Clients \          ; * JMK86
               END                       ; * JMK86
            END                          ; * JMK86
         CASE 1                          ; * JMK11
            DARRAY<1>='File for Client ':CLIENT:' ':CLIENT.NAME:' '
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML<-1>=CHANGE(CLIENT.NAME,'&','&amp;'):\<BR>(\:CLIENT:\) \         ; * JMK60
            END                          ; * JMK60
            IF SEPARATE.DIVISIONS THEN
               IF DIVISIONAL.ID = 'ALL' THEN
                  DARRAY<1> :='for division ':DIVS<1,DIV.COUNT>:' ':DIVS<11,DIV.COUNT>:' ':CITY.STATE:' '
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<BR>for division \:DIVS<1,DIV.COUNT>:\ \:CHANGE(DIVS<11,DIV.COUNT>,'&','&amp;'):\ \:CITY.STATE:\ \        ; * JMK60
                  END                    ; * JMK60
               END ELSE
                  DARRAY<1> :='for division ':DIVISIONAL.ID:' ':DIV.DESC:' ':CITY.STATE:' '
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<BR>for division \:DIVISIONAL.ID:\ \:CHANGE(DIV.DESC,'&','&amp;'):\ \:CITY.STATE:\ \  ; * JMK60
                  END                    ; * JMK60
               END
            END ELSE                     ; * DS001
               IF DIVISIONAL.ID # 'ALL' THEN       ; * DS001
                  DARRAY<1> :='for divisions ':VIN<55>:' '
               END
            END                          ; * DS001
      END CASE                           ; * JMK11

      IF RPT.STYLE='H' THEN              ; * JMK60
         DARRAY.HTML:=\</FONT></TD>\     ; * JMK60
         DARRAY.HTML:=\<TD ALIGN="CENTER"><FONT SIZE="7">\   ; * JMK60
         DARRAY.HTML:=VERSION.DESC       ; * JMK60
         IF D.SORT<1>#'' THEN            ; * JMK60
            IF NUM(D.SORT<1>) THEN       ; * JMK60
               DARRAY.HTML:=\<BR>\:D.SORT<2>       ; * JMK60
            END                          ; * JMK60
         END                             ; * JMK60
         DARRAY.HTML:=\</FONT>\          ; * JMK60
         DARRAY.HTML:=\<BR><FONT SIZE="4">\        ; * JMK60
      END                                ; * JMK60
      IF CARRIER='ALL' THEN
         DARRAY<1>=DARRAY<1>:'For ALL Carriers '
         IF RPT.STYLE='H' THEN           ; * JMK60
            DARRAY.HTML:=\For ALL Carriers \       ; * JMK60
         END                             ; * JMK60
         IF MODE='ALL' THEN
            DARRAY<1>=DARRAY<1>:'For ALL Modes '
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\For ALL Modes \       ; * JMK60
            END                          ; * JMK60
         END ELSE
            READV MODE.DESC FROM F.TRANSPORT,MODE,1 ELSE MODE.DESC='Unknown Mode'
            DARRAY<1>=DARRAY<1>:'For Mode ':MODE:' ':MODE.DESC:' '
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\For Mode \:MODE:\ \:CHANGE(MODE.DESC,'&','&amp;'):\ \         ; * JMK60
            END                          ; * JMK60
         END
      END ELSE
         IF CARRIER = 'FEDEX' THEN       ; * JCW04
            DARRAY<1>=DARRAY<1>:'For FedEx Air (00015) and FedEx Ground (01075) '          ; * JCW04
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\For FedEx Air (00015) and FedEx Ground (01075) \    ; * JMK60
            END                          ; * JMK60
         END ELSE
            IF CARRIER = 'UPSDTL' THEN   ; * JCW04
               DARRAY<1>=DARRAY<1>:'For ALL Carriers '       ; * JCW04
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\For ALL Carriers \           ; * JMK60
               END                       ; * JMK60
            END ELSE
               READV CARRIER.NAME FROM F.CARRIERS,CARRIER,1 ELSE CARRIER.NAME='Unknown Carrier'
               DARRAY<1>=DARRAY<1>:'For Carrier ':CARRIER:' ':CARRIER.NAME:' '
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\For Carrier \:CARRIER:\ \:CHANGE(CARRIER.NAME,'&','&amp;'):\ \       ; * JMK60
               END                       ; * JMK60
            END
         END
      END
      DARRAY<1>=DARRAY<1>:'Between ':BEG.DATE'D2/':' and ':END.DATE'D2/':' '
      IF RPT.STYLE='H' THEN              ; * JMK60
         DARRAY.HTML:=\<BR>Between \:BEG.DATE'D2/':\ and \:END.DATE'D2/':\ \     ; * JMK60
      END                                ; * JMK60

      IF INCLUDE.IOT # 'N' THEN          ; * JCW01
         IF INCLUDE.IOT = 'I' THEN       ; * JCW01
            DARRAY<1>=DARRAY<1>:'Including only '  ; * JCW01
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\<BR>Including only \  ; * JMK60
            END                          ; * JMK60
         END ELSE                        ; * JCW01
            DARRAY<1>=DARRAY<1>:'Excluding '       ; * JCW01
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\<BR>Excluding \       ; * JMK60
            END                          ; * JMK60
         END                             ; * JCW01
         BEGIN CASE                      ; * JCW01
            CASE IOT.INFO = 'I'          ; * JCW01
               DARRAY<1>=DARRAY<1>:'Inbound '      ; * JCW01
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\Inbound \          ; * JMK60
               END                       ; * JMK60
            CASE IOT.INFO = 'O'          ; * JCW01
               DARRAY<1>=DARRAY<1>:'Outbound '     ; * JCW01
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\Outbound \         ; * JMK60
               END                       ; * JMK60
            CASE IOT.INFO = 'T'          ; * JCW01
               DARRAY<1>=DARRAY<1>:'Third Party '  ; * JCW01
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\Third Party \      ; * JMK60
               END                       ; * JMK60
         END CASE                        ; * JCW01
      END                                ; * JCW01
      DARRAY<1>=DARRAY<1>:'Using Version ': VERSION : ' - ':VERSION.DESC : ' '
      IF D.SORT<1>#'' THEN
         IF NUM(D.SORT<1>) THEN
            DARRAY<1>=DARRAY<1>:D.SORT<2>
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=D.SORT<2>    ; * JMK60
            END                          ; * JMK60
         END
      END
      DARRAY<1>=DARRAY<1>:' on ':DATE()'D2/'
      IF DATA.SUBSET THEN
         DARRAY<1>=DARRAY<1>:'   This report may represent a subset of all data and SHOULD NOT be used for account balancing.'
         IF RPT.STYLE='H' THEN           ; * JMK60
            DARRAY.HTML:=\<BR><FONT SIZE="1">(This report has active data filters and SHOULD NOT be used for account balancing.)\  ; * JMK60
         END                             ; * JMK60
      END
      IF RPT.STYLE='H' THEN              ; * JMK60
         DARRAY.HTML:=\</FONT></TD>\     ; * JMK60
         IF VERSION='11' THEN            ; * DFP01
            DARRAY.HTML:=\<TD ALIGN="CENTER">\     ; * DFP01
            DARRAY.HTML:=\<FONT SIZE="2" COLOR="RED">\       ; * DFP01
            DARRAY.HTML:=TCRTXT1         ; * DFP01
            DARRAY.HTML:=\<BR>\          ; * DFP01
            DARRAY.HTML:=TCRTXT2         ; * DFP01
            DARRAY.HTML:=\</FONT></TD>\  ; * DFP01
         END                             ; * DFP01
         DARRAY.HTML:=\<TD ALIGN="RIGHT"><FONT SIZE="4">\    ; * JMK60
         DARRAY.HTML:=DATE()'D4/'        ; * JMK60
         DARRAY.HTML:=\</FONT></TD></TR>\          ; * JMK60
         DARRAY.HTML:=\</TABLE>\         ; * JMK60
         DARRAY.HTML<-1>=\<TABLE BORDER="2" COLS="\:COL.COUNT:\" WIDTH="100%">\  ; * JMK60
         DARRAY.HTML<-1>=\<COLGROUP ALIGN="LEFT">\           ; * JMK60
         FOR CCNT=1 TO COL.COUNT         ; * JMK60
            HDG=OCONV(DSPECS(2)<1,CCNT>,'MCU')     ; * JMK60
            CNV=DSPECS(6)<1,CCNT>        ; * JMK60
            BEGIN CASE                   ; * JMK60
               CASE CNV='D2/'            ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE CNV='D4/'            ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE CNV[1,2]='MD'        ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60

               CASE CNV[1,2]='BC'        ; * JMK61 ; * JMK63
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK61

               CASE CNV[1,2]='FC'        ; * JMK60 ; * JMK63
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60

               CASE CNV[1,2]='TC'        ; * JMK60 ; * JMK63
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE CNV='MOPAY'          ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE CNV='LOPAY'          ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE HDG='WEIGHT'         ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE HDG='WT'             ; * JMK60
                  DARRAY.HTML:=\<COL ALIGN="RIGHT">\         ; * JMK60
               CASE 1                    ; * JMK60
                  DARRAY.HTML:=\<COL>\   ; * JMK60
            END CASE                     ; * JMK60
         NEXT CCNT                       ; * JMK60
         DARRAY.HTML:=\</COLGROUP>\      ; * JMK60
         LNCOLOR=LNCOLOR=0               ; * JMK60
         IF LNCOLOR=1 THEN               ; * JMK60
            DARRAY.HTML<-1>=\<TR BGCOLOR="white">\           ; * JMK60
         END ELSE                        ; * JMK60
            DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\       ; * JMK60
         END                             ; * JMK60
      END                                ; * JMK60
      COL.HEAD.ROW = 3                   ; * SWB03
      IF VERSION='111' THEN
         DARRAY<3,-1>='Parent #'
         DARRAY<3,-1>='Parent Name'
         DARRAY<3,-1>='Client #'
         DARRAY<3,-1>='Client Name'
         IF RPT.STYLE='H' THEN           ; * JMK60
            DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Parent #</FONT></TH>\          ; * JMK60
            DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Parent Name</FONT></TH>\       ; * JMK60
            DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client #</FONT></TH>\          ; * JMK60
            DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client Name</FONT></TH>\       ; * JMK60
         END                             ; * JMK60
      END ELSE
         IF SLC.FRT OR SLC.ADJ THEN      ; * JMK87
            DARRAY<3,-1>='Client #'      ; * JMK87
         END ELSE                        ; * JMK87
            IF VERSION='22' THEN         ; * JMK15
               DARRAY<3,-1>='Client #'   ; * JMK15
               DARRAY<3,-1>='Client Name'          ; * JMK15
               DARRAY<3,-1>='Initial Salesrep'     ; * JMK15
               DARRAY<3,-1>='Service Salesrep'     ; * JMK15
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client #</FONT></TH>\    ; * JMK60
                  DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client Name</FONT></TH>\           ; * JMK60
                  DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Initial Salesrep</FONT></TH>\      ; * JMK60
                  DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Service Salesrep</FONT></TH>\      ; * JMK60
               END                       ; * JMK60
            END ELSE                     ; * JMK15

               IF CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN      ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
                  DARRAY<3,-1>='Client #'
                  DARRAY<3,-1>='Client Name'
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client #</FONT></TH>\           ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Client Name</FONT></TH>\        ; * JMK60
                  END                    ; * JMK60
               END
               IF CLIENT # 'ALL' AND VERSION = 681 THEN      ; * GRBXX
                  DARRAY<3,-1>='Client #'
                  DARRAY<3,-1>='Client Name'

               END
            END                          ; * JMK15
         END                             ; * JMK87
      END
      USRFLD=''                          ; * JMK12
      ITEM.COUNT=DCOUNT(DSPECS(2),@VM)
      FOR I = 1 TO ITEM.COUNT
         IF CLIENT='01706' THEN          ; * JMKXXX
            IF VERSION='677' OR VERSION='522' THEN           ; * JMKXXX
               IF DSPECS(2)<1,I>='Division' THEN DSPECS(2)<1,I>='Branch'         ; * JMKXXX
               IF DSPECS(2)<1,I>='Region' THEN DSPECS(2)<1,I>='Division'         ; * JMKXXX
            END                          ; * JMKXXX
         END                             ; * JMKXXX
         NEW.HEAD=0
         IF DSPECS(4)<1,I>=7 AND DSPECS(3)<1,I>='FB' THEN

            IF (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') AND LOG.ONLY THEN NEW.HEAD=1   ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86

            IF (CLIENT#'ALL' AND CLIENT#'AFS' AND CLIENT#'SCT' AND CLIENT#'UNI' AND CLIENT#'UFM' AND CLIENT#'LGI') THEN  ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
               IF CLIENT.REC(93)='Y' THEN NEW.HEAD=1         ; * Logistics Client
            END
         END
         IF NEW.HEAD THEN
            BEGIN CASE                   ; * JMK39
               CASE CLIENT='01524'       ; * JMK39
                  DARRAY<3,-1>='Benchmark Charge'  ; * JMK39
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Benchmark Charge</FONT></TH>\   ; * JMK60
                  END                    ; * JMK60
               CASE CLIENT='01524'       ; * JMK39
                  DARRAY<3,-1>='Benchmark Charge'  ; * JMK39
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Benchmark Charge</FONT></TH>\   ; * JMK60
                  END                    ; * JMK60
               CASE 1                    ; * JMK39

                  DARRAY<3,-1>='Gross Charge'      ; * JMK38
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Gross Charge</FONT></TH>\       ; * JMK60
                  END                    ; * JMK60
            END CASE                     ; * JMK39
         END ELSE
            IF CLIENT.REC(191)#'' THEN   ; * JMK12
               BEGIN CASE                ; * JMK12
                  CASE CLIENT.REC(191)<1,1>#'' AND DSPECS(2)<1,I>='USER FIELD 1 (UF1)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,1>:' (UF1)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,1>,'&','&amp;'):\ (UF1)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<1>=I         ; * JMK12

                  CASE CLIENT.REC(191)<1,2>#'' AND DSPECS(2)<1,I>='USER FIELD 2 (UF2)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,2>:' (UF2)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,2>,'&','&amp;'):\ (UF2)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<2>=I         ; * JMK12
                  CASE CLIENT.REC(191)<1,3>#'' AND DSPECS(2)<1,I>='USER FIELD 3 (UF3)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,3>:' (UF3)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,3>,'&','&amp;'):\ (UF3)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<3>=I         ; * JMK12
                  CASE CLIENT.REC(191)<1,4>#'' AND DSPECS(2)<1,I>='USER FIELD 4 (UF4)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,4>:' (UF4)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,4>,'&','&amp;'):\ (UF4)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<4>=I         ; * JMK12
                  CASE CLIENT.REC(191)<1,5>#'' AND DSPECS(2)<1,I>='USER FIELD 5 (UF5)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,5>:' (UF5)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,5>,'&','&amp;'):\ (UF5)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<5>=I         ; * JMK12
                  CASE CLIENT.REC(191)<1,6>#'' AND DSPECS(2)<1,I>='USER FIELD 6 (UF6)'     ; * JMK12; * JMK16
                     DARRAY<3,-1>=CLIENT.REC(191)<1,6>:' (UF6)'        ; * JMK12 ; * JMK16
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(CLIENT.REC(191)<1,6>,'&','&amp;'):\ (UF6)</FONT></TH>\      ; * JMK60
                     END                 ; * JMK60
                     USRFLD<6>=I         ; * JMK12
                  CASE 1                 ; * JMK12
                     DARRAY<3,-1>=DSPECS(2)<1,I>   ; * JMK12
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(DSPECS(2)<1,I>,'&','&amp;'):\</FONT></TH>\        ; * JMK60
                     END                 ; * JMK60
               END CASE                  ; * JMK12
            END ELSE                     ; * JMK12
               DARRAY<3,-1>=DSPECS(2)<1,I>
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">\:CHANGE(DSPECS(2)<1,I>,'&','&amp;'):\</FONT></TH>\    ; * JMK60
               END                       ; * JMK60
            END                          ; * JMK12
         END
      NEXT I
      IF VERSION='115' AND DTL.ARRAY#'' THEN       ; * JMK51
         NDVAL=DCOUNT(DTL.ARRAY<1>,@VM)  ; * JMK51
         FOR DVAL=1 TO NDVAL             ; * JMK51
            DCNT=DTL.ARRAY<2,DVAL>       ; * JMK51
            IF DCNT>0 THEN               ; * JMK51
               FOR DCOL=1 TO DCNT        ; * JMK51
                  DARRAY<3,-1>='Dtl Code'          ; * JMK51
                  DARRAY<3,-1>='Dtl Desc'          ; * JMK51
                  DARRAY<3,-1>='Dtl Amt'           ; * JMK51
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Dtl Code</FONT></TH>\           ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Dtl Desc</FONT></TH>\           ; * JMK60
                     DARRAY.HTML:=\<TH ALIGN="CENTER"><FONT SIZE="2">Dtl Amt</FONT></TH>\  ; * JMK60
                  END                    ; * JMK60
               NEXT DCOL                 ; * JMK51
            END                          ; * JMK51
         NEXT DVAL                       ; * JMK51
         DTL.CAPTURE=0                   ; * JMK51
      END                                ; * JMK51

*
* Remove heading from this table from Alcon
*
                                         ; * JMK50
      IF RPT.STYLE='H' THEN              ; * JMK60
         DARRAY.HTML:=\</TR>\            ; * JMK60
      END                                ; * JMK60
      IF SLC.FRT OR SLC.ADJ THEN         ; * JMK87
         OBEG.DATE=BEG.DATE'D4/'         ; * JMK87
         OEND.DATE=END.DATE'D4/'         ; * JMK87
         OTIME=CHANGE(OCONV(TIME(),'MTS'),':','')  ; * JMK92
         IF SLC.FRT THEN                 ; * JMK87
            RECORD.NAME='SHV-':OBEG.DATE[7,4]:OBEG.DATE[1,2]:OBEG.DATE[4,2]:'-':OEND.DATE[7,4]:OEND.DATE[1,2]:OEND.DATE[4,2]:'-':OTIME:'-FRT.XLS'      ; * JMK87 ; * JMK92
         END                             ; * JMK87
         IF SLC.ADJ THEN                 ; * JMK87
         END                             ; * JMK87
         READ DARRAY FROM F.SHV.FRT.DATA,RECORD.NAME ELSE    ; * JMK87
            DARRAY=DARRAY<3>             ; * JMK87
         END                             ; * JMK87
      END                                ; * JMK87
      RETURN

*****************************************************************************
SELECT.BILLS:***
************************************************************************

      IF AUTO THEN
         UP.STMT='SELECT FB.UNPROCESS,':CLIENT:' WITH FILE.NAME = "FB.BILLS,':CLIENT:'"'   ; *JMK117
         IF SEPARATE.DIVISIONS THEN
            IF DIVISIONAL.ID = 'ALL' THEN
               UP.STMT := 'AND WITH FB.DIV = "':DIVS<1,DIV.COUNT>:'" '
            END ELSE
               UP.STMT := 'AND WITH FB.DIV = "':DIVISIONAL.ID:'" '
            END
         END
         UP.STMT:=' ITEM.NAME'           ; * JMK117
         EXECUTE UP.STMT PASSLIST CAPTURING OUTPUT           ; * JMK117
*DFIF USER='DAVID' THEN CALL ELINE('UP.STMT':UP.STMT)
      END ELSE                           ; * JMK24
         IF FILE = 'FB.BILLS.HIST,':CLIENT.ID AND SLC.ADJ=0 THEN       ; * JMK24 ; * JMK92
            IF FILE.SEL#'6' THEN         ; * DRF02
               IF VERSION # '600' OR (VERSION = '600' AND REJ.INFO='E') AND VERSION # '26' THEN      ; * SWB02
*Rejected never pay bills are not included in FB.PROC.DATE.XREF so for version 600, FB.PROC.DATE.XREF   ; * SWB02
*can only be used if the user chose to Exclued Rejected Bills, which is probably not what the user will normally do   ; * SWB02
                  IF CLIENT.ID#'00000' AND REJ.INFO#'I' THEN           ; * JMK25 ; * JMK28
                     STMT='SELECT FB.PROC.DATE.XREF,':CLIENT.ID:' WITH DATE >= "':OCONV(BEG.DATE,'D2/'):'" AND <= "':OCONV(END.DATE,'D2/'):'"'         ; * JMK24
                     EXECUTE STMT RTNLIST CAPTURING RESULTS  ; * JMK24
*DFIF USER='DAVID' THEN CALL ELINE('STMT':STMT)

                     IF @SELECTED > 0 THEN         ; * JCW02
                        STMT='QSELECT FB.PROC.DATE.XREF,':CLIENT.ID    ; * JMK24
                        EXECUTE STMT PASSLIST CAPTURING RESULTS        ; * JMK24
*DFIF USER='DAVID' THEN CALL ELINE('STMT':STMT)
                     END ELSE            ; * JMK24

                        RETURN           ; * JCW02
                     END                 ; * JMK24
                  END                    ; * JMK25
               END                       ; * SWB02
            END                          ; * DRF02
         END                             ; * JMK24
      END

      IF FILE = 'FB.BILLS,':CLIENT.ID THEN
         STMT='SSELECT ':FILE:' WITH 30 GE "':OCONV(BEG.DATE,'D2/')
         STMT=STMT:'" AND WITH 30 LE "':OCONV(END.DATE,'D2/'):'"'
         IF VERSION # '600' THEN         ; * SWB02
            IF CLIENT.ID[1,2]#'99' THEN
               IF FILE.SEL=1 THEN
                  STMT=STMT:' AND WITH 39 = "O"'
               END
               IF REJ.INFO#'I' THEN      ; * JMK28
                  STMT=STMT:' AND WITH 39 # "R"'
               END                       ; * JMK28
            END ELSE
               IF REJ.INFO#'I' THEN      ; * JMK28
                  STMT=STMT:' AND WITH 39 # "R"'
               END                       ; * JMK28
            END
         END                             ; * SWB02
      END ELSE
         STMT='SSELECT ':FILE:' WITH 37 GE "':OCONV(BEG.DATE,'D2/')
         STMT=STMT:'" AND WITH 37 LE "':OCONV(END.DATE,'D2/'):'"'
         IF FILE.SEL='6' THEN            ; * DRF02
            STMT='SSELECT ':FILE:' WITH 30 GE "':OCONV(BEG.DATE,'D2/')           ; * DRF02
            STMT=STMT:'" AND WITH 30 LE "':OCONV(END.DATE,'D2/'):'"'   ; * DRF02
            STMT=STMT:' AND WITH 37  = ""'         ; * DRF02
         END                             ; * DRF02
         IF VERSION # '600' THEN         ; * SWB02
            IF REJ.INFO#'I' THEN         ; * JMK28
               STMT=STMT:' AND WITH 39 # "R"'
            END                          ; * JMK28
         END                             ; * SWB02
         IF VERSION = '37' THEN          ; * DRF10
            STMT=STMT:' AND WITH CHECK.BANK = "E" "R"'       ; * DRF10
         END                             ; * DRF10
* Begin GRB09
         IF VERSION = "26" THEN
            STMT='SSELECT ':FILE:' WITH 37 GE "':OCONV(BEG.DATE,'D2/')
****            STMT='SSELECT ':FILE:' WITH 95 GE "':OCONV(BEG.DATE,'D2/')
            STMT=STMT:'" AND WITH 37 LE "':OCONV(END.DATE,'D2/'):'"'
****            STMT=STMT:'" AND WITH 95 LE "':OCONV(END.DATE,'D2/'):'"'
***            STMT = STMT:' AND WITH 61 AND WITH 66'
         END
* End GRB09
         IF SLC.ADJ THEN                 ; * JMK92
            STMT='SSELECT FB.BILLS.HIST,':CLIENT.ID          ; * JMK92
            STMT:=' WITH ANY 37 # ""'    ; * JMK92
            STMT:=' AND WITH 86 > 37'    ; * JMK92
            STMT:=' AND WITH 86 GE "':OCONV(BEG.DATE,'D2/'):'"'        ; * JMK92
            STMT:=' AND WITH 86 LE "':OCONV(END.DATE,'D2/'):'"'        ; * JMK92
         END                             ; * JMK92
      END

      IF CLIENT='10356' AND CARRIER='01075' ELSE
         IF ALL.RPT=1 AND CARRIER='UPSDTL' ELSE    ; * JMK61 ; * JMK78
            BEGIN CASE                   ; * JCW04
               CASE CARRIER = 'FEDEX'    ; * JCW04
                  STMT=STMT:' AND WITH CARRIER# = "00015" "01075"'     ; * JCW04
               CASE CARRIER # 'ALL'      ; * JCW04
                  STMT=STMT:' AND WITH CARRIER# = "':CARRIER:'"'       ; * JCW04
               CASE 1                    ; * JCW04
                  IF CLIENT[1,2]='99' THEN
                     IF CARRIER='ALL' AND MODE#'ALL' THEN STMT=STMT:' AND WITH CARRIER.MODE = "':MODE:'"'
                  END ELSE
                     IF CARRIER='ALL' AND MODE#'ALL' THEN STMT=STMT:' AND WITH 21 = "':MODE:'"'
                  END
            END CASE
         END                             ; * JMK61
      END
      BEGIN CASE
         CASE MISROUTE.INFO = 'I'
            STMT=STMT:' AND WITH 63 # "0"'         ; * JMK01

            IF CLIENT.ID # '00891' THEN STMT:= ' AND MR.OVG.AMT GT "0"'
         CASE MISROUTE.INFO = 'E'
            STMT=STMT:' AND WITH 63 = "0"'         ; * JMK01
            IF CLIENT.ID # '00891' THEN STMT:= ' OR MR.OVG.AMT LT "0"'
         CASE MISROUTE.INFO = '-'
            STMT=STMT:' AND WITH 63 # "0"'         ; * JMK01
            STMT:= ' AND MR.OVG.AMT LT "0"'
         CASE MISROUTE.INFO = 'B'
            STMT=STMT:' AND WITH 63 # "0"'         ; * JMK01
      END CASE
      BEGIN CASE                         ; * JMK01
         CASE LCC.INFO = 'I'             ; * JMK01
            STMT=STMT:' AND WITH 143 # "" AND WITH 143 > "0"'          ; * JMK01 ; * JMK24
         CASE LCC.INFO = 'E'             ; * JMK01
            STMT=STMT:' AND WITH 143 = "" OR WITH 143 <= "0"'          ; * JMK01 ; * JMK24
      END CASE                           ; * JMK01
      IF OVERCHARGE.INFO = 'I' THEN STMT=STMT:' AND WITH OVC.AND.OVC.COMM AND WITH OVC.AND.OVC.COMM # "0" '
      IF OVERCHARGE.INFO = 'E' THEN STMT=STMT:' AND WITH 11 AND WITH 11 GE "-0.01" '
      IF INCLUDE.IOT # 'N' THEN          ; * JCW01
         BEGIN CASE                      ; * JCW01
            CASE INCLUDE.IOT = 'I'       ; * JCW01
               STMT = STMT:'AND WITH 2 = '         ; * JCW01
            CASE INCLUDE.IOT = 'E'       ; * JCW01
               STMT = STMT:'AND WITH 2 # '         ; * JCW01
         END CASE                        ; * JCW01
         BEGIN CASE                      ; * JCW01
            CASE IOT.INFO = 'I'          ; * JCW01
               STMT = STMT:'"I" '        ; * JCW01
            CASE IOT.INFO = 'O'          ; * JCW01
               STMT = STMT:'"O" '        ; * JCW01
            CASE IOT.INFO = 'T'          ; * JCW01
               STMT = STMT:'"T" '        ; * JCW01
         END CASE                        ; * JCW01
      END                                ; * JCW01

      IF LOGISTICS.INFO = 'I' THEN STMT=STMT:' AND WITH 12 AND WITH 12 LT "-0.01" '
      IF LOGISTICS.INFO = 'E' THEN STMT=STMT:' AND WITH 12 AND WITH 12 GE "-0.01" '
      IF DISCOUNT.INFO = 'I' THEN STMT=STMT:' AND WITH 10 AND WITH 10 LT "-0.01" '
      IF DISCOUNT.INFO = 'E' THEN STMT=STMT:' AND WITH 10 AND WITH 10 GE "-0.01" '
      IF TL.INFO = 'I' THEN STMT=STMT:' AND WITH 8 GT "600.00" AND WITH CPM GE "1.25"'     ; * JMK19
      IF EBILL.INFO = 'I' THEN STMT:=' AND WITH EBILL = "1"'           ; * JMK22
      IF EBILL.INFO = 'E' THEN STMT:=' AND WITH EBILL = "0"'           ; * JMK22
      IF REJ.INFO = 'I' THEN STMT:=' AND WITH 39 = "R"'      ; * JMK28
      IF REJ.INFO = 'E' THEN STMT:=' AND WITH 39 # "R"'      ; * JMK28

      BEGIN CASE                         ; * SWB02
         CASE CUT.BACK.CODE = 'E'        ; * SWB02
            STMT := ' AND WITH VAR.DESC.YN = "N" '           ; * SWB02
         CASE CUT.BACK.CODE = 'I'        ; * SWB02
            STMT := ' AND WITH VAR.DESC.YN = "Y" '           ; * SWB02
         CASE CUT.BACK.CODE # ''         ; * SWB02
            IF CUT.DESC#'' THEN
               X=COUNT(CUT.DESC,'~')
               IF X GT 0 THEN
                  FOR I=1 TO X
                     LN='[':FIELD(CUT.DESC,'~',I):']'
                     STMT = STMT:' AND WITH 41 = "':LN:'" '
                  NEXT I
                  IF FIELD(CUT.DESC,'~',X+1) NE '' THEN
                     LN='[':FIELD(CUT.DESC,'~',X+1):']'
                     STMT = STMT:' AND WITH 41 = "':LN:'" '
                  END
               END ELSE
                  LN='[':CUT.DESC:']'
                  STMT = STMT:' AND WITH 41 = "':LN:'" '     ; * SWB02
               END
            END
         CASE 1                          ; * SWB02
      END CASE                           ; * SWB02
      IF DUP.ONLY THEN
         STMT=STMT:' AND WITH VERSION GT "0" '
      END ELSE
         STMT=STMT:' AND WITH VERSION = "0" '
      END
      IF DIVISIONAL.ID # 'ALL' AND DIVISIONAL.ID.CNT > 1 THEN          ; * DS001
         STMT := ' AND WITH DIV = ':VIN<55>        ; * DS001
      END                                ; * DS001
      IF SEPARATE.DIVISIONS THEN
         IF DIVISIONAL.ID = 'ALL' THEN
            STMT := 'AND WITH DIV = "':DIVS<1,DIV.COUNT>:'" '
         END ELSE
            STMT := 'AND WITH DIV = "':DIVISIONAL.ID:'" '
         END
      END
      IF ACCESS.ONLY = 'I' THEN          ; * NPR07
         STMT = STMT:' AND WITH FB.ACCESS = "1"'   ; * NPR07
      END                                ; * NPR07
      IF BD.ONLY = 'I' THEN STMT:=' AND WITH PRO = "[BD"'    ; * JMK86
      IF BD.ONLY = 'E' THEN STMT:=' AND WITH PRO # "[BD"'    ; * JMK86
      IF FILE.SEL='4' THEN
         STMT='SSELECT ':FILE:' WITH 39 = "O" AND WITH 14 = "" AND WITH VERSION = "0"'
      END
      IF ALL.RPT=1 THEN                  ; * JMK78
         IF CARRIER='UPSDTL' THEN        ; * JMK78
            STMT=STMT:' AND WITH UPS.EBILL # "1"'  ; * JMK78
         END                             ; * JMK78
         STMT=STMT:' BY CARRIER BY 94 '  ; * JMK78
      END                                ; * JMK78

      IF CLIENT='01127' THEN
         STMT=STMT:' BY CARRIER BY 94 '
      END

      IF D.SORT<1>#'' THEN
         IF NUM(D.SORT<1>) THEN
            LN = 'BY ':D.SORT<1>
            STMT=STMT:LN
         END
      END
      IF VERSION='522' THEN
         LN = 'BY-DSND LCC.SORT'
         STMT=STMT:LN
      END
      IF WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' THEN      ; * JMK02
         STMT='SSELECT FB.BILLS.HIST,':CLIENT.ID:' WITH @ID = '        ; * JMK02
         NVAL=DCOUNT(FBLIST,@VM)         ; * JMK02
         FOR VAL=1 TO NVAL               ; * JMK02
            IF FBLIST<1,VAL>#'' THEN     ; * JMK02
               STMT:='"':FBLIST<1,VAL>:'"'         ; * JMK02
            END                          ; * JMK02
         NEXT VAL                        ; * JMK02
         IF VERSION='677' THEN
            STMT:=' BY-DSND MRS.SORT'
         END
         IF VERSION='522' THEN
            STMT:=' BY-DSND LCC.SORT'
         END
         JMK.MESSAGE<1,-1>=STMT          ; * JMK03
      END                                ; * JMK02
      IF OCONV(USER,'MCU')='DAVID' THEN
         CRT @(0,23)
         CRT @(0,23):STMT
         CRT
      END

      STMT=STMT:' BY CARRIER BY CARRIER# BY 2 BY 1 BY PRO'
      IF WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' THEN      ; * JMK03
         EXECUTE STMT PASSLIST RTNLIST BILLS.LIST CAPTURING OUTPUT     ; * JMK03
*DFIF USER='DAVID' THEN CALL ELINE('STMT':STMT)
      END ELSE                           ; * JMK03
         IF SAMPLE.ONE='Y' THEN          ; * JMK27
            STMT:=' SAMPLE 1'            ; * JMK27
         END                             ; * JMK27
         EXECUTE STMT PASSLIST RTNLIST BILLS.LIST CAPTURING OUTPUT
*DFIF USER='DAVID' THEN CALL ELINE('STMT':STMT)
      END                                ; * JMK03

      JMK.MESSAGE<1,-1>=OUTPUT           ; * JMK03
      JMK.MESSAGE<1,-1>=@SELECTED        ; * JMK03
                                         ; * JMK27
      IF @SELECTED > 0 ELSE              ; * JCW02

         IF ALL.RPT=1 AND CARRIER='UPSDTL' THEN    ; * JMK78
            GOTO CONTINUE.UPS.BUILD      ; * JMK78
         END                             ; * JMK78

         IF (CLIENT#'ALL' AND CLIENT#'AFS' AND CLIENT#'SCT' AND CLIENT#'UNI' AND CLIENT#'UFM' AND CLIENT#'LGI') THEN     ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
            IF SEPARATE.DIVISIONS AND DIVISIONAL.ID = 'ALL' THEN GOTO SKIP.DIVISION
* CALL ELINE('No transactions on file. (SELECT In BUILD.DF.SUB).')
            GOTO EXIT.PROGRAM
         END
      END
      NUM.BILLS = @SELECTED

      SHOULD.SUBTOTAL = D.SORT<4>
      IF CLIENT='05495' AND VERSION='263' THEN SHOULD.SUBTOTAL=0
      IF CLIENT='05813' AND VERSION='772' THEN SHOULD.SUBTOTAL=0
      OLD.SUBDATA = 'FIRST-ONE'
      SUBDATA = ''
      SUBTOTAL = ''
      TOTAL = ''
      SUB.ATTR = D.SORT<1>
      COUNTER.2=0
      PER.2 = 0
      DONE=0
      TEMP.ID=''
      ****    TEMP.REC=''
      MAX.ACC.CNT=0                      ; * SWB03
      BILL.ACC.CNT=0                     ; * SWB03
      LAST.ACC.COL=''                    ; * SWB03

*
* Get next item to process
*

      LOOP
         READNEXT PRO.ID FROM BILLS.LIST ELSE DONE = 1

      UNTIL DONE DO
         COUNTER.2=COUNTER.2+1
         IF SAMPLE.ONE='Y' AND COUNTER.2>1 THEN    ; * JMK27
            CLEARSELECT BILLS.LIST       ; * JMK27
            RETURN                       ; * JMK27
         END                             ; * JMK27
         LINE=''
         NO.EDI=0
         MATREAD PRO.REC FROM FB.BILLS,PRO.ID THEN

GET.BILL:   *

            IF AUTO.EMAIL=0 THEN CALL PROG.BAR(22,COUNTER.2,NUM.BILLS,PER.2)
            IF CLIENT='02275' AND VERSION='265' THEN         ; * JMK100
               IF PRO.REC(16)='' THEN CONTINUE     ; * JMK100
            END                          ; * JMK100
            ST.VALID=0
            IF ST.LIST#'' THEN           ; * JMK47
               PRO.ORIG.ST = PRO.REC(25)           ; * JMK47
               LOCATE PRO.ORIG.ST IN ST.LIST<1> SETTING OSTPOS THEN ST.VALID=1   ; * JMK47
               PRO.DEST.ST = PRO.REC(26)           ; * JMK47
               LOCATE PRO.DEST.ST IN ST.LIST<1> SETTING DSTPOS THEN ST.VALID=1   ; * JMK47
               IF ST.VALID=0 THEN CONTINUE         ; * JMK47
            END                          ; * JMK47
            PRV.PRO.REC=''               ; * JMK86
            CARRIER.NO=FIELD(PRO.ID,'*',1)         ; * JMK86
            IF SLC.FRT OR SLC.ADJ THEN   ; * JMK87
               IF CARRIER.NO='00015' THEN CONTINUE           ; * JMK87
               IF CARRIER.NO='00041' THEN CONTINUE           ; * JMK87
               ***    IF CLIENT.ID#'01401' AND CARRIER.NO='00365' THEN CONTINUE         ; * JMK87
               IF CARRIER.NO='01075' THEN CONTINUE           ; * JMK87
               IF CARRIER.NO='01312' THEN CONTINUE           ; * JMK87
               IF INDEX(PRO.REC(53),'LOGICA',1) THEN CONTINUE          ; * JMK102
            END                          ; * JMK87
            PRO.NO=FIELD(PRO.ID,'*',2)   ; * JMK86
            SEQ.NO=FIELD(PRO.ID,'*',3)   ; * JMK86
            PRV.PRO.ID=CARRIER.NO:'*':PRO.NO[1,LEN(PRO.NO)-2]:'*':SEQ.NO         ; * JMK86
            READ PRV.PRO.REC FROM FB.BILLS,PRV.PRO.ID ELSE PRV.PRO.REC=''        ; * JMK86

            FROM.STACK = '' ; TO.STACK = ''        ; * Only for client 01334 Hussey for now   ; * NPR02
            IF STACK.LIST#'' THEN        ; * NPR02
               STACK.VALID=0
               FROM.STACK = PRO.REC(68)  ; * NPR02
               LOCATE FROM.STACK IN STACK.LIST<1> SETTING OSTPOS THEN STACK.VALID=1        ; * NPR02
               TO.STACK = PRO.REC(96)    ; * NPR02
               LOCATE TO.STACK IN STACK.LIST<1> SETTING DSTPOS THEN STACK.VALID=1          ; * NPR02
               IF STACK.VALID=0 THEN CONTINUE      ; * NPR02
            END                          ; * NPR02

            ORIG.EDI.ID = PRO.REC(88)    ; * JCW03

            IF ORIG.EDI.ID # '' AND NO.EDI.FILE=0 THEN       ; * JCW03 ; * JMK30
               CALL PARSE.EDI.ID(ORIG.EDI.ID, CLIENT.ID, EDI.HIST.ID)  ; * JCW03
               READ EDI.REC FROM EDI.BILLS.HIST, EDI.HIST.ID ELSE NO.EDI = 1     ; * JCW03

            END ELSE
               NO.EDI=1
            END
            FB.DIV.ID=''                 ; * JMK93
            MAT FB.DIV.REC=''            ; * JMK93
            IF DIVISION='Y' THEN         ; * JMK93
               FB.DIV.ID=PRO.REC(9)      ; * JMK93
               MATREAD FB.DIV.REC FROM F.DIVISION,FB.DIV.ID ELSE MAT FB.DIV.REC=''         ; * JMK93
            END                          ; * JMK93
            CARRIER.ID=OCONV(PRO.ID,'G0*1')
            PRO.NUM=OCONV(PRO.ID,'G1*1')
            IF CLIENT='01127' AND CARRIER='01075' THEN
               IF CARRIER.ID='00015' OR CARRIER.ID='01075' THEN
                  IF PRO.NUM[1,11] MATCHES "1N'-'3N'-'5N" THEN
                     GOTO OWEN.REPEAT
                  END
               END
               IF CARRIER.ID='00365' THEN
                  INV.KEYED=1
                  IF PRO.REC(3)#PRO.REC(4) THEN
                     INV.KEYED=0
                  END
                  IF PRO.REC(6)+0#0 THEN
                     INV.KEYED=0
                  END
                  AIR.PRO=PRO.NUM
                  AIR.PRO=CHANGE(AIR.PRO,'AD','')
                  AIR.PRO=CHANGE(AIR.PRO,'BD','')
                  IF INDEX(AIR.PRO,'/',1) THEN
                     AIR.PRO=OCONV(AIR.PRO,'G0/1')
                  END
                  IF LEN(AIR.PRO) > 9 THEN
                     INV.KEYED=0
                  END
                  IF INV.KEYED THEN
                     GOTO OWEN.REPEAT
                  END
               END
            END
            IF CLIENT.ID='01127' AND CARRIER.ID='01075' AND CARRIER#'01075' THEN
               IF PRO.NUM[1,11] MATCHES "1N'-'3N'-'5N" ELSE
                  IF TEMP.ID='' THEN
                     GOSUB ASSIGN.TEMP.REC
                  END
                  IF TEMP.ID#PRO.REC(94) THEN
                     TEMP.ID=PRO.ID
                     MAT PRO.REC= MAT TEMP.REC
                     IF PRO.REC(10)+0#0 THEN
                        PRO.REC(29)='D'
                        PRO.REC(41)<1,1>='Service Failures'
                     END
                     IF PRO.REC(11)+0#0 THEN
                        PRO.REC(29)=PRO.REC(29):'O'
                        PRO.REC(41)<1,2>='Service Failures'
                     END
                     IF PRO.REC(12)+0#0 THEN
                        PRO.REC(29)=PRO.REC(29):'C'
                     END
                     MAT TEMP.REC=''
                     PRO.ID='01075*':PRO.REC(94):'*0'
                     NO.EDI=1
                  END ELSE
                     TEMP.REC(7)=TEMP.REC(7)+PRO.REC(7)
                     TEMP.REC(8)=TEMP.REC(8)+PRO.REC(8)
                     TEMP.REC(10)=TEMP.REC(10)+PRO.REC(10)
                     TEMP.REC(11)=TEMP.REC(11)+PRO.REC(11)
                     TEMP.REC(12)=TEMP.REC(12)+PRO.REC(12)
                     TEMP.REC(13)=TEMP.REC(13)+PRO.REC(13)
                     TEMP.REC(42)=TEMP.REC(42)+PRO.REC(42)
                     TEMP.REC(43)=TEMP.REC(43)+PRO.REC(43)
                     TEMP.REC(44)=TEMP.REC(44)+PRO.REC(44)
                     NUM.OF.VALUE=DCOUNT(PRO.REC(33),@VM)
                     FOR XX = 1 TO NUM.OF.VALUE
                        TEMP.REC(32)<1,XX>=TEMP.REC(32)<1,XX>+PRO.REC(32)<1,XX>
                        TEMP.REC(33)<1,XX>=TEMP.REC(33)<1,XX>+PRO.REC(33)<1,XX>
                     NEXT XX
                     NUM.OF.VALUE=DCOUNT(PRO.REC(151),@VM)
                     TEMP.REC(151)='FSC'
                     FOR XX = 1 TO NUM.OF.VALUE
                        IF PRO.REC(151)<1,XX>='FSC' OR PRO.REC(151)<1,XX>='FUEL' THEN
                           TEMP.REC(152)=TEMP.REC(152)+PRO.REC(152)<1,XX>
                        END
                     NEXT XX
                     GOTO OWEN.REPEAT
                  END
               END
            END
            IF TEMP.REC(1) #'' THEN
               TEMP.ID=PRO.ID
               MAT PRO.REC= MAT TEMP.REC
               MAT TEMP.REC=''
               IF PRO.REC(10)+0#0 THEN
                  PRO.REC(29)='D'
                  PRO.REC(41)<1,1>='Service Failures'
               END
               IF PRO.REC(11)+0#0 THEN
                  PRO.REC(29)=PRO.REC(29):'O'
                  PRO.REC(41)<1,2>='Service Failures'
               END
               IF PRO.REC(12)+0#0 THEN
                  PRO.REC(29)=PRO.REC(29):'C'
               END
               PRO.ID='01075*':PRO.REC(94):'*0'
               NO.EDI=1
            END
            MSR.COST=PRO.REC(8)+PRO.REC(44)        ; * JMK53

            IF PRO.REC(63) GT MSR.COST AND CLIENT.ID # '00891' AND MISROUTE.INFO#'-' AND MISROUTE.INFO#'B' THEN          ; * JMK53
               PRO.REC(63) = 0
               PRO.REC(69) = ''
               PRO.REC(22) = ''
               PRO.REC(23) = ''
            END
            IF SUB.ATTR#'' THEN
               BEGIN CASE
                  CASE SUB.ATTR='CARRIER.NAME'
                     READV CARRIER.NAME FROM F.CARRIERS,OCONV(PRO.ID,'G0*1'),1 ELSE CARRIER.NAME='Unknown'
                     SUBDATA = CARRIER.NAME
                  CASE SUB.ATTR='CARRIER.ID'
                     SUBDATA = OCONV(PRO.ID,'G0*1')
                  CASE NUM(SUB.ATTR)
                     SUBDATA = PRO.REC(SUB.ATTR)
                  CASE 1
                     SUBDATA = ""
               END CASE
               IF SUBDATA#OLD.SUBDATA THEN
                  IF SHOULD.SUBTOTAL AND OLD.SUBDATA#'FIRST-ONE' THEN
                     DARRAY<-1> = SUBTOTAL
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        LNCOLOR=LNCOLOR=0          ; * JMK60
                        IF LNCOLOR=1 THEN          ; * JMK60
                           DARRAY.HTML<-1>=\<TR BGCOLOR="white">\      ; * JMK60
                        END ELSE         ; * JMK60
                           DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\  ; * JMK60
                        END              ; * JMK60
                        FOR CCNT=1 TO COL.COUNT    ; * JMK60
                           BEGIN CASE    ; * JMK60
                              CASE SUB.ATTR='CARRIER.NAME'   ; * JMK60
                                 IF OCONV(DSPECS(2)<1,CCNT>,'MCU')='CARRIER NAME' THEN     ; * JMK60
                                    DARRAY.HTML:=\<TD><I>\:CHANGE(SUBTOTAL<1,CCNT>,'&','&amp;'):\</I></TD>\    ; * JMK60
                                 END ELSE          ; * JMK60
                                    IF SUBTOTAL<1,CCNT>#'' THEN        ; * JMK60
                                       CONVERSION=DSPECS(6)<1,CCNT>    ; * JMK60
                                       BEGIN CASE  ; * JMK60

                                          CASE CONVERSION[1,2]='BC'    ; * JMK61 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK61

                                          CASE CONVERSION[1,2]='FC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK60

                                          CASE CONVERSION[1,2]='TC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='MOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='LOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,1]='D'     ; * COUNT OF DATES ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD0'),'MD0,'):\</TD>\           ; * JMK60
                                          CASE CONVERSION[1,2]='MD'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,2]='MR'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE 1   ; * JMK60
                                             IF SUBTOTAL<1,CCNT>='' THEN         ; * JMK60
                                                DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\         ; * JMK60
                                             END ELSE        ; * JMK60
                                                DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\     ; * JMK60
                                             END   ; * JMK60
                                       END CASE    ; * JMK60
                                    END ELSE       ; * JMK60
                                       DARRAY.HTML:=\<TD>&nbsp;</TD>\  ; * JMK60
                                    END  ; * JMK60
                                 END     ; * JMK60
                              CASE SUB.ATTR='CARRIER.ID'     ; * JMK60
                                 IF OCONV(DSPECS(2)<1,CCNT>,'MCU')='CARRIER#' THEN         ; * JMK60
                                    DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\           ; * JMK60
                                 END ELSE          ; * JMK60
                                    IF SUBTOTAL<1,CCNT>#'' THEN        ; * JMK60
                                       CONVERSION=DSPECS(6)<1,CCNT>    ; * JMK60
                                       BEGIN CASE  ; * JMK60

                                          CASE CONVERSION[1,2]='BC'    ; * JMK61 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK61

                                          CASE CONVERSION[1,2]='FC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK60

                                          CASE CONVERSION[1,2]='TC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='MOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='LOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,1]='D'     ; * COUNT OF DATES ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD0'),'MD0,'):\</TD>\           ; * JMK60
                                          CASE CONVERSION[1,2]='MD'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,2]='MR'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE 1   ; * JMK60
                                             IF SUBTOTAL<1,CCNT>='' THEN         ; * JMK60
                                                DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\         ; * JMK60
                                             END ELSE        ; * JMK60
                                                DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\     ; * JMK60
                                             END   ; * JMK60
                                       END CASE    ; * JMK60
                                    END ELSE       ; * JMK60
                                       DARRAY.HTML:=\<TD>&nbsp;</TD>\  ; * JMK60
                                    END  ; * JMK60
                                 END     ; * JMK60
                              CASE 1     ; * JMK60
                                 IF ATTR = SUB.ATTR THEN     ; * JMK60
                                    IF SUBTOTAL<1,CCNT>#'' THEN        ; * JMK60
                                       CONVERSION=DSPECS(6)<1,CCNT>    ; * JMK60
                                       BEGIN CASE  ; * JMK60

                                          CASE CONVERSION[1,2]='BC'    ; * JMK61 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK61

                                          CASE CONVERSION[1,2]='FC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\           ; * JMK60

                                          CASE CONVERSION[1,2]='TC'    ; * JMK60 ; * JMK63
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='MOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION='LOPAY'      ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,1]='D'     ; * COUNT OF DATES ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD0'),'MD0,'):\</TD>\           ; * JMK60
                                          CASE CONVERSION[1,2]='MD'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE CONVERSION[1,2]='MR'    ; * JMK60
                                             DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                                          CASE 1   ; * JMK60
                                             IF SUBTOTAL<1,CCNT>='' THEN         ; * JMK60
                                                DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\         ; * JMK60
                                             END ELSE        ; * JMK60
                                                DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\     ; * JMK60
                                             END   ; * JMK60
                                       END CASE    ; * JMK60
                                    END ELSE       ; * JMK60
                                       DARRAY.HTML:=\<TD>&nbsp;</TD>\  ; * JMK60
                                    END  ; * JMK60
                                 END     ; * JMK60
                           END CASE      ; * JMK60
                        NEXT CCNT        ; * JMK60
                        DARRAY.HTML:=\</TR>\       ; * JMK60
                     END                 ; * JMK60
                  END
                  OLD.SUBDATA = SUBDATA
                  SUBTOTAL = ''
               END
            END

            CARRIER.ID=OCONV(PRO.ID,'G0*1')
            READV CARRIER.MODE FROM F.CARRIERS,CARRIER.ID,44 THEN
               IF PRO.REC(21)#'' THEN CARRIER.MODE=PRO.REC(21)
               READ TR.REC FROM F.TRANSPORT,CARRIER.MODE ELSE
                  TR.REC=''
               END
            END ELSE
               TR.REC=''
            END
            SERV.LEV = ''
            SERV.LEV.ID = "AIR.SERVLEV*":CARRIER.ID
            READ SERV.LEV FROM F.TABLES,SERV.LEV.ID ELSE SERV.LEV = ''

            IF VEND='Y' OR CUST='Y' THEN           ; * JMK29
               IF (PRO.REC(17) MATCHES "5N" OR PRO.REC(17) MATCHES "6N") AND PRO.REC(17) # '' AND CLIENT[1,2]#'99' THEN
                  VC.ID = PRO.REC(17)
                  READ VC.REC FROM F.VC,VC.ID ELSE
                     VC.REC = PRO.REC(17)
                  END
               END ELSE
                  VC.REC = PRO.REC(17)
               END
            END ELSE
               VC.REC = PRO.REC(17)
            END                          ; * JMK29
            IF RPT.STYLE='H' THEN        ; * JMK60
               LNCOLOR=LNCOLOR=0         ; * JMK60
               IF LNCOLOR=1 THEN         ; * JMK60
                  DARRAY.HTML<-1>=\<TR BGCOLOR="white">\     ; * JMK60
               END ELSE                  ; * JMK60
                  DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\           ; * JMK60
               END                       ; * JMK60
            END                          ; * JMK60
            IF VERSION='111' THEN
               LINE<1>=PARENT.ID:@VM:PARENT.NAME:@VM:CLIENT.ID:@VM:CLIENT.NAME:@VM
               IF RPT.STYLE='H' THEN     ; * JMK60
                  DARRAY.HTML:=\<TD>\:PARENT.ID:\</TD><TD>\:CHANGE(PARENT.NAME,'&','&amp;'):\</TD><TD>\:CLIENT.ID:\</TD><TD>\:CHANGE(CLIENT.NAME,'&','&amp;'):\</TD>\      ; * JMK60
               END                       ; * JMK60
            END ELSE
               IF SLC.FRT OR SLC.ADJ THEN          ; * JMK87
                  LINE<1>=CLIENT.ID:@VM  ; * JMK87
               END ELSE                  ; * JMK87

                  IF VERSION='22' THEN   ; * JMK15
                     LINE<1>=CLIENT.ID:@VM:CLIENT.NAME:@VM:ISLS.NAME:@VM:SSLS.NAME:@VM     ; * JMK15
                     IF RPT.STYLE='H' THEN         ; * JMK60
                        DARRAY.HTML:=\<TD>\:CLIENT.ID:\</TD><TD>\:CHANGE(CLIENT.NAME,'&','&amp;'):\</TD><TD>\:ISLS.NAME:\</TD><TD>\:CHANGE(SSLS.NAME,'&','&amp;'):\</TD>\  ; * JMK60
                     END                 ; * JMK60
                  END ELSE               ; * JMK15

                     IF (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') THEN        ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
                        LINE<1>=CLIENT.ID:@VM:CLIENT.NAME:@VM
                        IF RPT.STYLE='H' THEN      ; * JMK60
                           DARRAY.HTML:=\<TD>\:CLIENT.ID:\</TD><TD>\:CHANGE(CLIENT.NAME,'&','&amp;'):\</TD>\   ; * JMK60
                        END              ; * JMK60
                     END
                  END                    ; * JMK15
               END                       ; * JMK87
            END

            IF VERSION = "681" THEN      ; *GRBXX
               LINE<1>=CLIENT.ID:@VM:CLIENT.NAME:@VM
            END

            IF SUM(PRO.REC(152))#PRO.REC(8)+0 THEN           ; * JMK37
               PRO.REC(151)=''           ; * JMK37
               PRO.REC(152)=''           ; * JMK37
            END                          ; * JMK37
                                         ; * JMK33 ; * JMK59 ; * DFP01
            IF PRO.REC(21)=6 AND INDEX(PRO.REC(151),'FSC',1)=0 AND INDEX(PRO.REC(151),'FUEL',1)=0 AND PRO.REC(8)+0#0 AND VERSION#'11' THEN   ; * JMK33 ; * JMK59 ; * DFP01
               IF CLIENT.ID#'01015' AND CARRIER.ID#'32353' THEN        ; * DRF21
                  TL.VIN=''              ; * JMK33
                  TL.VIN<1>=PRO.REC(1)   ; * JMK33
                  TL.VIN<2>=PRO.REC(6)   ; * JMK33
                  TL.VIN<5>=0            ; * JMK33
                  TL.VIN<6>=PRO.REC(8)   ; * JMK33
                  TL.VIN<7>=PRO.REC(3)   ; * JMK33
                  TL.VIN<8>=PRO.REC(4)   ; * JMK33
                  TL.VIN<9>=CLIENT.ID    ; * JMK33
                  TL.VIN<10>=CARRIER.ID  ; * JMK33
                  TL.VOUT=''             ; * JMK33

                  CALL CALC.TL.FSC(TL.VIN,TL.VOUT,F.NFSC,F.TABLES,F.TL.FSC,F.PCIN,F.PCOUT,F.MILEAGE,F.ZIPS,F.CAN.ZIPS)   ; * JMK33 ; * JMK35

                  EST.FSC.PERC=TL.VOUT<1>+0        ; * JMK33
                  EST.FSC.AMT=TL.VOUT<2>+0         ; * JMK33
                  EST.FRT.AMT=TL.VOUT<3>+0         ; * JMK33
                  IF PRO.REC(151)='' THEN          ; * JMK33
                     PRO.REC(151)<1,1>='FRT'       ; * JMK33
                     PRO.REC(152)<1,1>=EST.FRT.AMT           ; * JMK33
                     PRO.REC(151)<1,2>='EFS'       ; * JMK33
                     PRO.REC(152)<1,2>=EST.FSC.AMT           ; * JMK33
                  END ELSE               ; * JMK33
                     LOCATE 'FRT' IN PRO.REC(151) SETTING FRTPOS THEN  ; * JMK33
                        PRO.REC(152)<1,FRTPOS>=EST.FRT.AMT   ; * JMK33
                     END ELSE            ; * JMK33
                        LOCATE 'BASE' IN PRO.REC(151) SETTING FRTPOS THEN        ; * JMK59
                           PRO.REC(152)<1,FRTPOS>=EST.FRT.AMT          ; * JMK59
                        END ELSE         ; * JMK59
                           INS 'FRT' BEFORE PRO.REC(151)<1,FRTPOS>     ; * JMK33
                           INS EST.FRT.AMT BEFORE PRO.REC(152)<1,FRTPOS>
                        END              ; * JMK33
                     END                 ; * JMK59
                     LOCATE 'FSC' IN PRO.REC(151) SETTING FSCPOS THEN  ; * JMK33
                        PRO.REC(152)<1,FSCPOS>=EST.FSC.AMT   ; * JMK33
                     END ELSE            ; * JMK33
                        LOCATE 'FUEL' IN PRO.REC(151) SETTING FSCPOS THEN        ; * JMK59
                           PRO.REC(152)<1,FSCPOS>=EST.FSC.AMT          ; * JMK59
                        END ELSE         ; * JMK59
                           INS 'EFS' BEFORE PRO.REC(151)<1,FSCPOS>     ; * JMK33
                           INS EST.FSC.AMT BEFORE PRO.REC(152)<1,FSCPOS>         ; * JMK33
                        END              ; * JMK33
                     END                 ; * JMK59
                  END                    ; * JMK33
                  FRT.ARRAY=''           ; * JMK33
                  MIS.ARRAY=''           ; * JMK33
                  NVAL=DCOUNT(PRO.REC(151),@VM)    ; * JMK33
                  FOR VAL=1 TO NVAL      ; * JMK33
                     TRAN.TYPE=PRO.REC(151)<1,VAL>           ; * JMK33
                     BEGIN CASE          ; * JMK33
                        CASE TRAN.TYPE='FRT' OR TRAN.TYPE='MIN' OR TRAN.TYPE='DEF' OR TRAN.TYPE='BASE'         ; * JMK33
                           NXT.VAL=DCOUNT(FRT.ARRAY<1>,@VM)+1          ; * JMK33
                           FOR ATT=1 TO 2          ; * JMK33
                              FRT.ARRAY<ATT,NXT.VAL>=PRO.REC(150)+ATT<1,VAL>     ; * JMK33
                           NEXT ATT      ; * JMK33
                        CASE 1           ; * JMK33
                           LOCATE(TRAN.TYPE,MIS.ARRAY,1;MPOS) THEN     ; * JMK33


                              MIS.ARRAY<2,MPOS>+=PRO.REC(152)<1,VAL>+0           ; * JMK33
                           END ELSE      ; * JMK33
                              NXT.VAL=DCOUNT(MIS.ARRAY<1>,@VM)+1       ; * JMK33
                              FOR ATT=1 TO 2       ; * JMK33
                                 MIS.ARRAY<ATT,NXT.VAL>=PRO.REC(150)+ATT<1,VAL>  ; * JMK33
                              NEXT ATT   ; * JMK33
                           END           ; * JMK33
                     END CASE            ; * JMK33
                  NEXT VAL               ; * JMK33
                  PRO.REC(153)=FRT.ARRAY<1>        ; * JMK33
                  PRO.REC(157)=FRT.ARRAY<2>        ; * JMK33
                  PRO.REC(159)=MIS.ARRAY<1>        ; * JMK33
                  PRO.REC(163)=MIS.ARRAY<2>        ; * JMK33
               END                       ; * DRF21
            END                          ; * JMK33
            IF VERSION='115' AND DTL.CAPTURE THEN  ; * JMK51
               BDTL.ARRAY=''             ; * JMK51
               NDVAL=DCOUNT(PRO.REC(151),@VM)      ; * JMK51
               FOR DVAL=1 TO NDVAL       ; * JMK51
                  DCODE=PRO.REC(151)<1,DVAL>       ; * JMK51
                  LOCATE DCODE IN BDTL.ARRAY<1> BY 'AL' SETTING DPOS ELSE        ; * JMK51
                     INS DCODE BEFORE BDTL.ARRAY<1,DPOS>     ; * JMK51
                     INS 0 BEFORE BDTL.ARRAY<2,DPOS>         ; * JMK51
                  END                    ; * JMK51
                  BDTL.ARRAY<2,DPOS>+=1  ; * JMK51
               NEXT DVAL                 ; * JMK51
               NDVAL=DCOUNT(BDTL.ARRAY<1>,@VM)     ; * JMK51
               FOR DVAL=1 TO NDVAL       ; * JMK51
                  DCODE=BDTL.ARRAY<1,DVAL>         ; * JMK51
                  DCNT=BDTL.ARRAY<2,DVAL>          ; * JMK51
                  LOCATE DCODE IN DTL.ARRAY<1> BY 'AL' SETTING DPOS ELSE         ; * JMK51
                     INS DCODE BEFORE DTL.ARRAY<1,DPOS>      ; * JMK51
                     INS 0 BEFORE DTL.ARRAY<2,DPOS>          ; * JMK51
                  END                    ; * JMK51
                  IF DCNT > DTL.ARRAY<2,DPOS> THEN           ; * JMK51
                     DTL.ARRAY<2,DPOS>=DCNT        ; * JMK51
                  END                    ; * JMK51
               NEXT DVAL                 ; * JMK51
               CONTINUE                  ; * JMK51
            END
            IF SLC.ADJ THEN              ; * JMK87
               IF PRO.REC(7)='1' AND PRO.REC(8)='0' AND PRO.REC(11)='-1' THEN    ; * JMK87
                  PRO.REC(7)='0'         ; * JMK87
                  PRO.REC(11)='0'        ; * JMK87
               END                       ; * JMK87
            END                          ; * JMK87
            BILL.ACC.CNT=0               ; * SWB03
            **      ITEM=''
            T.FILE =''
            T.ATTR=''
            SAVE.CLASS = ''              ; * NKH01
            FOR I = 1 TO ITEM.COUNT

**
               IF DSPECS(12)<1,I>#'' THEN          ; * JMK47
                  FORMULA=DSPECS(12)<1,I>          ; * JMK47
                  FORMULA.LEN=LEN(FORMULA)         ; * JMK47
                  COL=''                 ; * JMK47
                  OPR=''                 ; * JMK47
                  OPR.TOT=0              ; * JMK47
                  CHR.POS=0              ; * JMK47
                  LOOP                   ; * JMK47
                     CHR.POS+=1          ; * JMK47
                     CHR=FORMULA[CHR.POS,1]        ; * JMK47
                  UNTIL CHR.POS > FORMULA.LEN DO   ; * JMK47
                     BEGIN CASE          ; * JMK47
                        CASE CHR='+'     ; * JMK47
                           LOCATE COL IN DSPECS(11) SETTING OPRVAL THEN          ; * JMK47

                              IF CLIENT='ALL' OR CLIENT='SCT' OR CLIENT='AFS' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN OPRVAL+=2           ; * JMK47 ; * JMK65 ; * JMK85 ; * JMK86
                              OPR.AMT=LINE<1,OPRVAL>         ; * JMK47
                              IF OPR#'' THEN       ; * JMK47
                                 BEGIN CASE        ; * JMK47
                                    CASE OPR='+' ; OPR.TOT=OPR.TOT+OPR.AMT       ; * JMK47
                                    CASE OPR='-' ; OPR.TOT=OPR.TOT-OPR.AMT       ; * JMK47
                                    CASE OPR='*' ; OPR.TOT=OPR.TOT*OPR.AMT       ; * JMK47
                                    CASE OPR='/' ; OPR.TOT=OPR.TOT/OPR.AMT       ; * JMK47
                                 END CASE          ; * JMK47
                                 COL=''  ; * JMK47
                              END ELSE   ; * JMK47
                                 OPR.TOT=OPR.AMT   ; * JMK47
                              END        ; * JMK47
                           END           ; * JMK47
                           OPR='+'       ; * JMK47
                        CASE CHR='-'     ; * JMK47
                           LOCATE COL IN DSPECS(11) SETTING OPRVAL THEN          ; * JMK47

                              IF CLIENT='ALL' OR CLIENT='SCT' OR CLIENT='AFS' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN OPRVAL+=2           ; * JMK47 ; * JMK65 ; * JMK85 ; * JMK86
                              OPR.AMT=LINE<1,OPRVAL>         ; * JMK47
                              IF OPR#'' THEN       ; * JMK47
                                 BEGIN CASE        ; * JMK47
                                    CASE OPR='+' ; OPR.TOT=OPR.TOT+OPR.AMT       ; * JMK47
                                    CASE OPR='-' ; OPR.TOT=OPR.TOT-OPR.AMT       ; * JMK47
                                    CASE OPR='*' ; OPR.TOT=OPR.TOT*OPR.AMT       ; * JMK47
                                    CASE OPR='/' ; OPR.TOT=OPR.TOT/OPR.AMT       ; * JMK47
                                 END CASE          ; * JMK47
                              END ELSE   ; * JMK47
                                 OPR.TOT=OPR.AMT   ; * JMK47
                                 COL=''  ; * JMK47
                              END        ; * JMK47
                           END           ; * JMK47
                           OPR='-'       ; * JMK47
                        CASE CHR='*'     ; * JMK47
                           LOCATE COL IN DSPECS(11) SETTING OPRVAL THEN          ; * JMK47

                              IF CLIENT='ALL' OR CLIENT='SCT' OR CLIENT='AFS' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN OPRVAL+=2           ; * JMK47 ; * JMK65 ; * JMK85 ; * JMK86
                              OPR.AMT=LINE<1,OPRVAL>         ; * JMK47
                              IF OPR#'' THEN       ; * JMK47
                                 BEGIN CASE        ; * JMK47
                                    CASE OPR='+' ; OPR.TOT=OPR.TOT+OPR.AMT       ; * JMK47
                                    CASE OPR='-' ; OPR.TOT=OPR.TOT-OPR.AMT       ; * JMK47
                                    CASE OPR='*' ; OPR.TOT=OPR.TOT*OPR.AMT       ; * JMK47
                                    CASE OPR='/' ; OPR.TOT=OPR.TOT/OPR.AMT       ; * JMK47
                                 END CASE          ; * JMK47
                                 COL=''  ; * JMK47
                              END ELSE   ; * JMK47
                                 OPR.TOT=OPR.AMT   ; * JMK47
                              END        ; * JMK47
                           END           ; * JMK47
                           OPR='*'       ; * JMK47
                        CASE CHR='/'     ; * JMK47
                           LOCATE COL IN DSPECS(11) SETTING OPRVAL THEN          ; * JMK47
                              IF CLIENT='ALL' OR CLIENT='SCT' OR CLIENT='AFS' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN OPRVAL+=2           ; * JMK47 ; * JMK65 ; * JMK85 ; * JMK86
                              OPR.AMT=LINE<1,OPRVAL>         ; * JMK47
                              IF OPR#'' THEN       ; * JMK47
                                 BEGIN CASE        ; * JMK47
                                    CASE OPR='+' ; OPR.TOT=OPR.TOT+OPR.AMT       ; * JMK47
                                    CASE OPR='-' ; OPR.TOT=OPR.TOT-OPR.AMT       ; * JMK47
                                    CASE OPR='*' ; OPR.TOT=OPR.TOT*OPR.AMT       ; * JMK47
                                    CASE OPR='/' ; OPR.TOT=OPR.TOT/OPR.AMT       ; * JMK47
                                 END CASE          ; * JMK47
                                 COL=''  ; * JMK47
                              END ELSE   ; * JMK47
                                 OPR.TOT=OPR.AMT   ; * JMK47
                              END        ; * JMK47
                           END           ; * JMK47
                           OPR='/'       ; * JMK47
                        CASE CHR=''      ; * JMK47
                        CASE 1           ; * JMK47
                           COL:=CHR      ; * JMK47
                     END CASE            ; * JMK47
                  REPEAT                 ; * JMK47
                  LOCATE COL IN DSPECS(11) SETTING OPRVAL THEN         ; * JMK47
                     IF CLIENT='ALL' OR CLIENT='SCT' OR CLIENT='AFS' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI' THEN OPRVAL+=2          ; * JMK47 ; * JMK65 ; * JMK85 ; * JMK86
                     OPR.AMT=LINE<1,OPRVAL>        ; * JMK47
                     IF OPR#'' THEN      ; * JMK47
                        BEGIN CASE       ; * JMK47
                           CASE OPR='+' ; OPR.TOT=OPR.TOT+OPR.AMT      ; * JMK47
                           CASE OPR='-' ; OPR.TOT=OPR.TOT-OPR.AMT      ; * JMK47
                           CASE OPR='*' ; OPR.TOT=OPR.TOT*OPR.AMT      ; * JMK47
                           CASE OPR='/' ; OPR.TOT=OPR.TOT/OPR.AMT      ; * JMK47
                        END CASE         ; * JMK47
                        COL=''           ; * JMK47
                     END ELSE            ; * JMK47
                        OPR.TOT=OPR.AMT  ; * JMK47
                     END                 ; * JMK47
                  END                    ; * JMK47
                  ITEM=OPR.TOT           ; * JMK47
               END ELSE                  ; * JMK47
                  VAL=DSPECS(5)<1,I>
                  ATTR=DSPECS(4)<1,I>

                  IF CLIENT='01418' THEN           ; * JMK26
                     FNAME=DSPECS(2)<1,I>          ; * JMK26
                     IF FNAME='Expense 1' OR FNAME='Exp Amt1' THEN     ; * JMK26
                        VAL=6            ; * JMK26 ; * JMK58
                        FOR XVAL=1 TO 5 WHILE VAL=6          ; * JMK26 ; * JMK58
                           EXP.CODE=PRO.REC(31)<1,XVAL>
                           IF EXP.CODE='350119' OR EXP.CODE='360119' OR EXP.CODE='605401' THEN VAL=XVAL        ; * - INBOUND OR OUTBOUND FREIGHT
                        NEXT XVAL        ; * JMK26
                     END                 ; * JMK26
                     IF FNAME='Expense 2' OR FNAME='Exp Amt2' THEN     ; * JMK26
                        VAL=6            ; * JMK26 ; * JMK58
                        FOR XVAL=1 TO 5 WHILE VAL=6          ; * JMK26 ; * JMK58
                           EXP.CODE=PRO.REC(31)<1,XVAL>
                           IF EXP.CODE='380120' THEN VAL=XVAL          ; * - HAZARDOUS MATERIAL
                           IF EXP.CODE='382301' THEN VAL=XVAL          ; * JMK26 - HAZARDOUS MATERIAL
                        NEXT XVAL        ; * JMK26
                     END                 ; * JMK26
                     IF FNAME='Expense 3' OR FNAME='Exp Amt3' THEN     ; * JMK26
                        VAL=6            ; * JMK26 ; * JMK58
                        FOR XVAL=1 TO 5 WHILE VAL=6          ; * JMK26 ; * JMK58
                           EXP.CODE=PRO.REC(31)<1,XVAL>
                           IF EXP.CODE='380130' THEN VAL=XVAL          ; * - FSC
                        NEXT XVAL        ; * JMK26
                     END                 ; * JMK26
                     IF FNAME='Expense 4' OR FNAME='Exp Amt4' THEN     ; * JMK58
                        VAL=6            ; * JMK58
                        FOR XVAL=1 TO 5 WHILE VAL=6          ; * JMK58
                           EXP.CODE=FIELD(PRO.REC(31)<1,XVAL>,'-',3)   ; * JMK58
                           IF EXP.CODE='535401' THEN VAL=XVAL          ; * JMK58 - SERVICE CHARGE
                        NEXT XVAL        ; * JMK58
                     END                 ; * JMK58
                  END                    ; * JMK26
                  IF ATTR#0 THEN
                     PRO.FLG=0           ; * JMK104
                     BEGIN CASE
                        CASE DSPECS(3)<1,I>='FB'
                           IF VAL='' THEN
                              ITEM=PRO.REC(ATTR)
                              IF VERSION = "752" OR VERSION = "753" THEN
                                 IF ATTR = "19" THEN
                                    IF NOT(NUM(ITEM)) THEN

                                       ITEM = 0
                                    END
                                 END
                              END

                              IF CLIENT='02138' AND VERSION='526' THEN           ; * DRF04
                                 IF ATTR=11 THEN ITEM=ITEM*-1          ; * DRF04
                              END        ; * DRF04
                           END ELSE
                              BEGIN CASE           ; * JMK05
                                 CASE VAL='L'      ; * JMK05
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK05
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK05
                                    ITEM=''        ; * JMK07
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(PRO.REC(R.ATTR),@VM)  ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       LOCATE(R.VAL,PRO.REC(R.ATTR),1;RPOS) THEN           ; * JMK05
                                          FOR DCNT=1 TO NDCNT          ; * JMK84
                                             IF PRO.REC(R.ATTR)<1,DCNT>=R.VAL THEN         ; * JMK84
                                                ITEM+=PRO.REC(ATTR)<1,DCNT>      ; * JMK84
                                             END   ; * JMK84
                                          NEXT DCNT          ; * JMK84
                                       END         ; * JMK05
                                    NEXT ITM       ; * JMK08
                                 CASE VAL='S'      ; * JMK06
                                    ITEM=SUM(PRO.REC(ATTR))  ; * JMK06
                                 CASE VAL='E'      ; * JMK08
                                    ITEM=SUM(PRO.REC(ATTR))  ; * JMK08
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK08
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK08
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(PRO.REC(R.ATTR),@VM)  ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       FOR DCNT=1 TO NDCNT   ; * JMK84
                                          IF PRO.REC(R.ATTR)<1,DCNT>=R.VAL THEN  ; * JMK84
                                             ITEM-=PRO.REC(ATTR)<1,DCNT>         ; * JMK84
                                          END      ; * JMK84
                                       NEXT DCNT   ; * JMK84
                                    NEXT ITM       ; * JMK08
                                 CASE VAL = "D"    ; * this will calc the diff of the two previous columns  ;* GRB06
                                    COLUMN.CNT = DCOUNT(LINE,@VM)
                                    ITEM = (LINE<1,COLUMN.CNT-2> - LINE<1,COLUMN.CNT-1>)   ; * GRB06
                                 CASE 1  ; * JMK05
                                    ITEM=PRO.REC(ATTR)<1,VAL>
                                    IF SLC.FRT AND ATTR = 152 AND ITEM = "CWT" THEN ITEM = 0         ; * GRB12
                                    IF ATTR='8' AND VAL='63' THEN
                                       IF PRO.REC(63)+0#0 THEN
                                          ITEM=(PRO.REC(8)+PRO.REC(44))-PRO.REC(63)        ; * JMK48
                                       END ELSE
                                          ITEM=0
                                       END
                                    END
                                    IF SLC.FRT OR SLC.ADJ THEN         ; * JMK87
                                       IF ATTR='5' OR ATTR='16' OR ATTR='183' OR ATTR='0' THEN
                                          CONVERT '"' TO '' IN ITEM
                                          CONVERT '=' TO '' IN ITEM
                                       END
                                       IF ATTR='74' AND PRO.REC(151)<1,VAL>#'FRT' THEN ITEM=''       ; * JMK106
                                       IF ATTR='75' AND PRO.REC(151)<1,VAL>#'FRT' THEN ITEM=''       ; * JMK106
                                    END  ; * JMK87
                              END CASE   ; * JMK05
                           END
                           IF CLIENT.REC(13)#'Y' THEN
                              IF ATTR='5' OR ATTR='31' OR ATTR='32' OR ATTR='33' THEN
                                 ITEM=''
                              END
                           END

                           IF COMM.ACCESS='N' THEN           ; * JMK04
                              BEGIN CASE           ; * JMK04
                                 CASE ATTR >= 42 AND ATTR <= 44        ; * JMK04
                                    ITEM = 'NA'    ; * JMK04
                                 CASE ATTR >= 10 AND ATTR <= 12        ; * JMK04
                                    ITEM = 'NA'    ; * JMK04
                                 CASE ATTR >= 34 AND ATTR <= 36        ; * JMK04
                                    ITEM = 'NA'
                              END CASE   ; * JMK04
                           END           ; * JMK04
                        CASE DSPECS(3)<1,I>='FBP'  ; * JMK86
                           IF VAL='' THEN          ; * JMK86
                              ITEM=PRV.PRO.REC<ATTR>         ; * JMK86
                           END ELSE      ; * JMK86
                              BEGIN CASE           ; * JMK86
                                 CASE VAL='L'      ; * JMK86
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK86
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK86
                                    ITEM=''        ; * JMK86
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK86
                                    NDCNT=DCOUNT(PRV.PRO.REC<R.ATTR>,@VM)        ; * JMK86
                                    FOR ITM=1 TO NITMS       ; * JMK86
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK86
                                       LOCATE(R.VAL,PRV.PRO.REC,R.ATTR;RPOS) THEN          ; * JMK86
                                          FOR DCNT=1 TO NDCNT          ; * JMK86
                                             IF PRV.PRO.REC<R.ATTR,DCNT>=R.VAL THEN        ; * JMK86
                                                ITEM+=PRV.PRO.REC<ATTR,DCNT>     ; * JMK86
                                             END   ; * JMK86
                                          NEXT DCNT          ; * JMK86
                                       END         ; * JMK86
                                    NEXT ITM       ; * JMK86
                                 CASE VAL='S'      ; * JMK86
                                    ITEM=SUM(PRV.PRO.REC<ATTR>)        ; * JMK86
                                 CASE VAL='E'      ; * JMK86
                                    ITEM=SUM(PRV.PRO.REC<ATTR>)        ; * JMK86
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK86
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK86
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK86
                                    NDCNT=DCOUNT(PRV.PRO.REC<R.ATTR>,@VM)        ; * JMK86
                                    FOR ITM=1 TO NITMS       ; * JMK86
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK86
                                       FOR DCNT=1 TO NDCNT   ; * JMK86
                                          IF PRV.PRO.REC<R.ATTR,DCNT>=R.VAL THEN           ; * JMK86
                                             ITEM-=PRV.PRO.REC<ATTR,DCNT>        ; * JMK86
                                          END      ; * JMK86
                                       NEXT DCNT   ; * JMK86
                                    NEXT ITM       ; * JMK86
                                 CASE 1  ; * JMK86
                                    ITEM=PRV.PRO.REC<ATTR,VAL>         ; * JMK86
                                    IF ATTR='8' AND VAL='63' THEN      ; * JMK86
                                       IF PRV.PRO.REC<63>+0#0 THEN     ; * JMK86
                                          ITEM=(PRV.PRO.REC<8>+PRV.PRO.REC<44>)-PRV.PRO.REC<63>      ; * JMK86
                                       END ELSE    ; * JMK86
                                          ITEM=0   ; * JMK86
                                       END         ; * JMK86
                                    END  ; * JMK86
                              END CASE   ; * JMK86
                           END           ; * JMK86
                           IF CLIENT.REC(13)#'Y' THEN        ; * JMK86
                              IF ATTR='5' OR ATTR='31' OR ATTR='32' OR ATTR='33' THEN      ; * JMK86
                                 ITEM=''           ; * JMK86
                              END        ; * JMK86
                           END           ; * JMK86

                           IF COMM.ACCESS='N' THEN           ; * JMK86
                              BEGIN CASE           ; * JMK86
                                 CASE ATTR >= 42 AND ATTR <= 44        ; * JMK86
                                    ITEM = 'NA'    ; * JMK86
                                 CASE ATTR >= 10 AND ATTR <= 12        ; * JMK86
                                    ITEM = 'NA'    ; * JMK86
                                 CASE ATTR >= 34 AND ATTR <= 36        ; * JMK86
                                    ITEM = 'NA'    ; * JMK86
                              END CASE   ; * JMK86
                           END           ; * JMK86
                        CASE DSPECS(3)<1,I>='EDI'
                           IF NOT(NO.EDI) THEN
                              * Begin NKH02
                              NEW.ITEM = ''
                              IF CLIENT.ID = '05589' THEN
                                 IF CARRIER.ID = '00018' OR CARRIER.ID = '00453' OR CARRIER.ID = '01002' OR CARRIER.ID = '00014' THEN        ; * NKH03
                                    IF ATTR = '9' THEN
                                       N.COUNT = DCOUNT(EDI.REC<9>,',')
                                       FOR N = 1 TO N.COUNT
                                          N.ITEM = TRIM(FIELD(EDI.REC<9>,',',N,1))
                                          IF N.ITEM[1,2] # "WH" THEN
                                             IF NEW.ITEM = '' THEN
                                                NEW.ITEM = N.ITEM
                                             END ELSE
                                                NEW.ITEM := ',':N.ITEM
                                             END
                                          END
                                       NEXT N
                                       EDI.REC<9> = NEW.ITEM
                                    END
                                 END     ; * NKH03
                              END
                              * End NKH02
                              IF VAL='' THEN
                                 ITEM=EDI.REC<ATTR>
                              END ELSE
                                 BEGIN CASE        ; * JMK05
                                    CASE VAL='L'   ; * JMK05
                                       R.ATTR=DSPECS(13)<1,I>          ; * JMK05
                                       R.LST=TRIM(DSPECS(14)<1,I>)     ; * JMK05
                                       ITEM=''     ; * JMK07
                                       NITMS=DCOUNT(R.LST,' ')         ; * JMK08
                                       NDCNT=DCOUNT(EDI.REC<R.ATTR>,@VM)         ; * JMK84
                                       FOR ITM=1 TO NITMS    ; * JMK08
                                          R.VAL=FIELD(R.LST,' ',ITM)   ; * JMK08
                                          LOCATE(R.VAL,EDI.REC,R.ATTR;RPOS) THEN           ; * JMK05

                                             FOR DCNT=1 TO NDCNT       ; * JMK84
                                                IF EDI.REC<R.ATTR,DCNT>=R.VAL THEN         ; * JMK84
                                                   ITEM+=EDI.REC<ATTR,DCNT>      ; * JMK84
                                                END          ; * JMK84
                                             NEXT DCNT       ; * JMK84
                                          END      ; * JMK05
                                       NEXT ITM    ; * JMK08
                                    CASE VAL='S'   ; * JMK06
                                       ITEM=SUM(EDI.REC<ATTR>)         ; * JMK06
                                    CASE VAL='E'   ; * JMK08
                                       ITEM=SUM(EDI.REC<ATTR>)         ; * JMK08
                                       R.ATTR=DSPECS(13)<1,I>          ; * JMK08
                                       R.LST=TRIM(DSPECS(14)<1,I>)     ; * JMK08
                                       NITMS=DCOUNT(R.LST,' ')         ; * JMK08
                                       NDCNT=DCOUNT(EDI.REC<R.ATTR>,@VM)         ; * JMK84
                                       FOR ITM=1 TO NITMS    ; * JMK08
                                          R.VAL=FIELD(R.LST,' ',ITM)   ; * JMK08

                                          FOR DCNT=1 TO NDCNT          ; * JMK84
                                             IF EDI.REC<R.ATTR,DCNT>=R.VAL THEN  ; * JMK84
                                                ITEM-=EDI.REC<ATTR,DCNT>         ; * JMK84
                                             END   ; * JMK84
                                          NEXT DCNT          ; * JMK84
                                       NEXT ITM    ; * JMK08
                                       ITEM=SUM.CHG-ITEM
                                    CASE 1         ; * JMK05
                                       ITEM=EDI.REC<ATTR,VAL>
                                 END CASE          ; * JMK05
                              END
                           END ELSE
                              ITEM=''
                           END
                        CASE DSPECS(3)<1,I>='TR'
                           IF VAL='' THEN
                              ITEM=TR.REC<ATTR>
                           END ELSE
                              BEGIN CASE           ; * JMK05
                                 CASE VAL='L'      ; * JMK05
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK05
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK05
                                    ITEM=''        ; * JMK07
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(TR.REC<R.ATTR>,@VM)   ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       LOCATE(R.VAL,TR.REC,R.ATTR;RPOS) THEN     ; * JMK05
                                          FOR DCNT=1 TO NDCNT          ; * JMK84
                                             IF TR.REC<R.ATTR,DCNT>=R.VAL THEN   ; * JMK84
                                                ITEM+=TR.REC<ATTR,DCNT>          ; * JMK84
                                             END   ; * JMK84
                                          NEXT DCNT          ; * JMK84
                                       END         ; * JMK05
                                    NEXT ITM       ; * JMK08
                                 CASE VAL='S'      ; * JMK06
                                    ITEM=SUM(TR.REC<ATTR>)   ; * JMK06
                                 CASE VAL='E'      ; * JMK08
                                    SUM.CHG=SUM(TR.REC<ATTR>)          ; * JMK08
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK08
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK08
                                    ITEM=''        ; * JMK07
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(TR.REC<R.ATTR>,@VM)   ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       FOR DCNT=1 TO NDCNT   ; * JMK84
                                          IF TR.REC<R.ATTR,DCNT>=R.VAL THEN      ; * JMK84
                                             ITEM-=TR.REC<ATTR,DCNT>   ; * JMK84
                                          END      ; * JMK84
                                       NEXT DCNT   ; * JMK84
                                    NEXT ITM       ; * JMK08
                                    ITEM=SUM.CHG-ITEM
                                 CASE 1  ; * JMK05
                                    ITEM=TR.REC<ATTR,VAL>
                              END CASE   ; * JMK05
                           END
                        CASE DSPECS(3)<1,I>='VC'
                           IF VAL='' THEN
                              ITEM=VC.REC<ATTR>
                           END ELSE
                              BEGIN CASE           ; * JMK05
                                 CASE VAL='L'      ; * JMK05
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK05
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK05
                                    ITEM=''        ; * JMK07
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(VC.REC<R.ATTR>,@VM)   ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       LOCATE(R.VAL,VC.REC,R.ATTR;RPOS) THEN     ; * JMK05
                                          FOR DCNT=1 TO NDCNT          ; * JMK84
                                             IF VC.REC<R.ATTR,DCNT>=R.VAL THEN   ; * JMK84
                                                ITEM+=VC.REC<ATTR,DCNT>          ; * JMK84
                                             END   ; * JMK84
                                          NEXT DCNT          ; * JMK84
                                       END         ; * JMK05
                                    NEXT ITM       ; * JMK08
                                 CASE VAL='S'      ; * JMK06
                                    ITEM=SUM(VC.REC<ATTR>)   ; * JMK06
                                 CASE VAL='E'      ; * JMK08
                                    SUM.CHG=SUM(VC.REC<ATTR>)          ; * JMK08
                                    R.ATTR=DSPECS(13)<1,I>   ; * JMK08
                                    R.LST=TRIM(DSPECS(14)<1,I>)        ; * JMK08
                                    ITEM=''        ; * JMK07
                                    NITMS=DCOUNT(R.LST,' ')  ; * JMK08
                                    NDCNT=DCOUNT(VC.REC<R.ATTR>,@VM)   ; * JMK84
                                    FOR ITM=1 TO NITMS       ; * JMK08
                                       R.VAL=FIELD(R.LST,' ',ITM)      ; * JMK08
                                       FOR DCNT=1 TO NDCNT   ; * JMK84
                                          IF VC.REC<R.ATTR,DCNT>=R.VAL THEN      ; * JMK84
                                             ITEM-=VC.REC<ATTR,DCNT>   ; * JMK84
                                          END      ; * JMK84
                                       NEXT DCNT   ; * JMK84
                                    NEXT ITM       ; * JMK08
                                    ITEM=SUM.CHG-ITEM
                                 CASE 1  ; * JMK05
                                    ITEM=VC.REC<ATTR,VAL>
                              END CASE   ; * JMK05
                           END
                     END CASE
                  END ELSE
                     ITEM=PRO.ID
                     PRO.FLG=1           ; * JMK104
                  END
                  AUDIT.TIME = ""        ; * NPR01
                  AUDIT.DATE = ""        ; * NPR01
                  AUDITED.BY = PRO.REC(89)
                  CONVERSION=DSPECS(6)<1,I>
                  IF CLIENT.REC(191)#'' THEN       ; * JMK12
                     IF USRFLD<1>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,1>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,1>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                     IF USRFLD<2>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,2>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,2>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                     IF USRFLD<3>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,3>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,3>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                     IF USRFLD<4>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,4>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,4>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                     IF USRFLD<5>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,5>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,5>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                     IF USRFLD<6>=I THEN           ; * JMK12
                        IF CLIENT.REC(193)<1,6>='D' THEN CONVERSION='D2/'        ; * JMK12
                        IF CLIENT.REC(193)<1,6>='C' THEN CONVERSION='MD2'        ; * JMK12
                     END                 ; * JMK12
                  END                    ; * JMK12
                  IF CONVERSION#'' THEN

                     BEGIN CASE          ; * JMK14
                           * Begin NKH04
                        CASE CONVERSION = 'IMG'
                           IMG.VIN = ''
                           IMG.VIN<1> = CLIENT.ID
                           IMG.VIN<2> = PRO.REC(280)
                           IMG.VOUT = ''
                           CALL GET.IMG.SCAN.DATE(IMG.VIN,IMG.VOUT)
                           ITEM = OCONV(IMG.VOUT<1>,'D2/')
                           * End NKH04
                        CASE CONVERSION='PCS' AND DSPECS(3)<1,I>='EDI'           ; * JMK36
                           IF NOT(NO.EDI) THEN     ; * JMK36
                              ITEM=SUM(EDI.REC<56>)+SUM(EDI.REC<103>)  ; * JMK36
                           END ELSE      ; * JMK36
                              ITEM=''    ; * JMK36
                           END           ; * JMK36
                        CASE CONVERSION='CSCAC'    ; * JMK14
                           CSCAC.ID=CLIENT.ID:'*':CARRIER.ID           ; * JMK14
                           READ CSCAC.REC FROM F.CSCAC,CSCAC.ID ELSE CSCAC.REC=''          ; * JMK14
                           ITEM=CSCAC.REC<1>       ; * JMK14
                           IF ITEM='' THEN
                              READ CARR.REC FROM F.CARRIERS,CARRIER.ID ELSE CARR.REC=''
                              ITEM=CARR.REC<12>
                              IF ITEM='' THEN
                                 ITEM=CARR.REC<1>[1,5]
                              END
                           END
                        CASE CONVERSION='BSRC'     ; * SWB01
                           IF ITEM='' THEN         ; * SWB01
                              ITEM='UNKNOWN'       ; * SWB01
                           END ELSE      ; * SWB01
                              BOL.SRC.ID='BOL.SRC*':ITEM     ; * SWB01
                              READV ITEM FROM F.TABLES, BOL.SRC.ID,1 ELSE ITEM='UNKNOWN'   ; * SWB01
                           END           ; * SWB01
                           ITEM=ITEM<1>  ; * SWB01
                        CASE CONVERSION='ISLS'     ; * JMK46
                           ITEM=ISLS     ; * JMK46
                        CASE CONVERSION='SSLS'     ; * JMK46
                           ITEM=SSLS     ; * JMK46
                        CASE CONVERSION='ISLSN'    ; * JMK46
                           ITEM=ISLS.NAME          ; * JMK46
                        CASE CONVERSION='SSLSN'    ; * JMK46
                           ITEM=SSLS.NAME          ; * JMK46
                        CASE CONVERSION='MILES'    ; * JMK93
                           IF ITEM+0=0 THEN        ; * JMK93
                              IF PRO.REC(3)#'99999' AND PRO.REC(4)#'99999' THEN  ; * JMK93
                                 PCM.VIN=''        ; * JMK93
                                 PCM.VIN<1>='BOTH'           ; * JMK93
                                 PCM.VIN<2>=CH.NUM           ; * JMK93
                                 IF PRO.REC(18)#'' THEN      ; * JMK93
                                    PCM.VIN<3>=PRO.REC(3):@VM:PRO.REC(18):@VM:PRO.REC(4)   ; * JMK93
                                 END ELSE          ; * JMK93
                                    PCM.VIN<3>=PRO.REC(3):@VM:PRO.REC(4)         ; * JMK93
                                 END     ; * JMK93
                                 PCM.VIN<4>='0'    ; * JMK93
                                 PCM.VIN<5>="Reporter"       ; * JMK93
                                 PCM.VIN<6>=""     ; * JMK93
                                 PCM.VIN<7>='1'    ; * JMK93
                                 PCM.VIN<8>=CLIENT           ; * JMK93
                                 PCM.VIN<9>=CARRIER          ; * JMK93
                                 PCM.VOUT=''       ; * JMK93
                                 CALL PCMILER.BETA(PCM.VIN,PCM.VOUT,F.PCIN,F.PCOUT,F.MILEAGE)        ; * JMK93
                                 ITEM=PCM.VOUT<1>'R0'        ; * JMK93
                              END        ; * JMK93
                           END           ; * JMK93
                        CASE CONVERSION='AUDTM' OR CONVERSION='AUDDT'  ; * NPR01
                           ITEM = ""     ; * NPR01
                           N.USERS = DCOUNT(PRO.REC(84),@VM)           ; * NPR01
                           FOR I.USER = N.USERS TO 1 STEP -1           ; * NPR01
                              W.USER = PRO.REC(84)<1,I.USER>           ; * NPR01
                              IF W.USER = AUDITED.BY THEN    ; * NPR01
                                 AUDIT.TIME = PRO.REC(85)<1,I.USER>    ; * NPR01
                                 AUDIT.DATE = PRO.REC(86)<1,I.USER>    ; * NPR01
                                 EXIT    ; * NPR01
                              END        ; * NPR01
                           NEXT I.USER   ; * NPR01
                           IF CONVERSION='AUDTM' THEN        ; * NPR01
                              IF AUDIT.TIME NE "" THEN ITEM = OCONV(AUDIT.TIME,"MTS")      ; * NPR01
                           END           ; * NPR01
                           IF CONVERSION='AUDDT' THEN        ; * NPR01
                              IF AUDIT.DATE NE "" THEN ITEM = OCONV(AUDIT.DATE,"D2/")      ; * NPR01
                           END           ; * NPR01
                        CASE CONVERSION='EDI'      ; * JMK20
                           ITEM='PPR'    ; * JMK22
                           IF PRO.REC(88)#'' OR PRO.REC(53)[1,12]='EBILL.IMPORT' THEN      ; * JMK22
                              IF PRO.REC(295)='' THEN        ; * DRF22
                                 ITEM='EDI'        ; * JMK22
                              END        ; * DRF22
                           END           ; * JMK22
                        CASE CONVERSION='MC/N' AND ATTR='60' AND REJ.INFO='I'    ; * JMK28
                           ITEM=OCONV(ITEM<1,1,1>,CONVERSION)          ; * JMK28
                        CASE CONVERSION = "R#4"
                           ITEM = ITEM CONVERSION  ; * GRB03
                        CASE CONVERSION='D2/' AND ATTR='60' AND REJ.INFO='I'     ; * JMK28
                           ITEM=OCONV(ITEM<1,1,2>,CONVERSION)          ; * JMK28
                        CASE CONVERSION='MC/N' AND ATTR='62' AND REJ.INFO='I'    ; * JMK28
                           ITEM=OCONV(ITEM<1,1,1>,CONVERSION)          ; * JMK28
                        CASE CONVERSION='D2/' AND ATTR='62' AND REJ.INFO='I'     ; * JMK28
                           ITEM=OCONV(ITEM<1,1,2>,CONVERSION)          ; * JMK28
                        CASE CONVERSION[1,2]='BC'  ; * JMK61 ; * JMK63
                           IF CONVERSION[3,1]='+' OR CONVERSION[3,1]='-' THEN    ; * JMK63
                              IF CONVERSION[3,1]='-' THEN    ; * JMK63
                                 FACTOR=1.00-TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END ELSE   ; * JMK63
                                 FACTOR=1.00+TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END        ; * JMK63
                              ITEM=OCONV(PRO.REC(7)*FACTOR,'MD2Z')     ; * JMK63
                           END ELSE      ; * JMK63
                              ITEM=OCONV(PRO.REC(7),'MD2Z')  ; * JMK61 ; * JMK63
                           END           ; *JMK63
                        CASE CONVERSION[1,2]='TC'  ; * JMK47 ; * JMK63
                           IF CONVERSION[3,1]='+' OR CONVERSION[3,1]='-' THEN    ; * JMK63
                              IF CONVERSION[3,1]='-' THEN    ; * JMK63
                                 FACTOR=1.00-TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END ELSE   ; * JMK63
                                 FACTOR=1.00+TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END        ; * JMK63
                              ITEM=OCONV((PRO.REC(8)+PRO.REC(42)+PRO.REC(43)+PRO.REC(44)+PRO.REC(165))*FACTOR,'MD2Z')    ; * JMK63
                           END ELSE      ; * JMK63
                              ITEM=OCONV(PRO.REC(8)+PRO.REC(42)+PRO.REC(43)+PRO.REC(44)+PRO.REC(165),'MD2Z')   ; * JMK47
                           END           ; * JMK63
                        CASE CONVERSION = 'CORE'
                           ITEM=OCONV(PRO.REC(7)+PRO.REC(10)+PRO.REC(11),'MD2Z')           ; * NPR99
                        CASE CONVERSION[1,2]='FC'  ; * JMK47 ; * JMK63
                           IF CONVERSION[3,1]='+' OR CONVERSION[3,1]='-' THEN    ; * JMK63
                              IF CONVERSION[3,1]='-' THEN    ; * JMK63
                                 FACTOR=1.00-TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END ELSE   ; * JMK63
                                 FACTOR=1.00+TRIM(CONVERSION[4,999]'R26')        ; * JMK63
                              END        ; * JMK63
                              ITEM=OCONV((PRO.REC(8)+PRO.REC(44)+PRO.REC(165))*FACTOR,'MD2Z')        ; * JMK63
                           END ELSE      ; * JMK63
                              * Begin GRB07
                              IF VERSION = 11 THEN
                                 ITEM=OCONV(PRO.REC(8)+PRO.REC(44)+PRO.REC(43)+PRO.REC(165),'MD2Z')  ; * JMK47
                              END ELSE
                                 ITEM=OCONV(PRO.REC(8)+PRO.REC(44)+PRO.REC(165),'MD2Z')    ; * JMK47
                              END
                              * End GRB07
                           END           ; * JMK63
                        CASE CONVERSION='LOPAY'
                           FCOST=PRO.REC(8)+PRO.REC(44)+PRO.REC(165)
                           LCCAMT=PRO.REC(143)
                           LOPAY=FCOST-LCCAMT
                           IF LOPAY<0 THEN LOPAY=0
                           IF LCCAMT+0=0 THEN LOPAY=0
                           ITEM=OCONV(LOPAY,'MD2Z')
                        CASE CONVERSION='MOPAY'
                           FCOST=PRO.REC(8)+PRO.REC(44)+PRO.REC(165)
                           MSRAMT=PRO.REC(63)
                           MOPAY=FCOST-MSRAMT
                           IF MOPAY<0 THEN MOPAY=0
                           IF MSRAMT+0=0 THEN MOPAY=0
                           ITEM=OCONV(MOPAY,'MD2Z')
                        CASE CONVERSION='SVCAD'
                           AP.SVC=PRO.REC(221)<1,1>
                           UNAP.SVC=PRO.REC(220)<1,1>
                           IF AP.SVC+0=0 OR UNAP.SVC+0=0 THEN
                              SVCADV='N/A'
                           END ELSE
                              SVCADV=AP.SVC-UNAP.SVC
                           END
                           ITEM=SVCADV
                        CASE CONVERSION='QUOTE'    ; * JMK49
                           IF ITEM#'' THEN         ; * JMK49
                              ITEM='=':QUOTE(ITEM)           ; * JMK49
                           END           ; * JMK49
                        CASE CONVERSION='PAYEE' AND CLIENT='30032'     ; * JMK67
                           FB.CARRIER.PAYEE.ID='30032*':PRO.REC(20):'*':PRO.REC(9)         ; * JMK67
                           READ FB.CARRIER.PAYEE.REC FROM F.CARRIER.PAYEE,FB.CARRIER.PAYEE.ID ELSE FB.LOC.REC=''         ; * JMK67
                           ITEM=FB.CARRIER.PAYEE.REC<1,1>    ; * JMK67
                        CASE CONVERSION='BDU'      ; * NPR05
                           AFS.BOL=TRIM(PRO.REC(240))        ; * JMK96
                           IF AFS.BOL=' ' THEN AFS.BOL=''    ; * JMK96
                           IF AFS.BOL NE "" THEN ITEM = "Y" ELSE ITEM = "N"      ; *NPR06 BOL data used for keying bill ; * JMK96

                           IF ITEM = "N" THEN
                              IF BOL.CRX.OPENED AND BOL.CRX.REFNO.OPENED THEN
                                 N.BOL = DCOUNT(PRO.REC(16),@VM)
                                 FOR BLN = 1 TO N.BOL
                                    ID.BOL = TRIM(PRO.REC(16)<1,BLN>)  ; * JMK96
                                    IF ID.BOL=' ' THEN ID.BOL=''       ; * JMK96
                                    IF ID.BOL='NONE' THEN ID.BOL=''    ; * JMK96
                                    IF ID.BOL='' THEN GO NEXT.BLN      ; * JMK96
                                    M.BOL.REC = ''
                                    READ M.BOL.REC FROM F.BOL.CRX, ID.BOL THEN
                                       ITEM = "Y"
                                       IF ITEM = "Y" THEN BLN = N.BOL
                                    END ELSE
                                       ID.BOL.REFNO = ID.BOL
                                       READ AFS.BOL.XREF.REC FROM F.BOL.REFNO.XREF, ID.BOL.REFNO THEN
                                          NBL = DCOUNT(AFS.BOL.XREF.REC<1>,@VM)
                                          IF NBL = 1 THEN
                                             ID.BOL = AFS.BOL.XREF.REC<1,1>
                                             READ M.BOL.REC FROM F.BOL.CRX, ID.BOL THEN
                                                ITEM = "Y"
                                                IF ITEM = "Y" THEN BLN = N.BOL
                                             END
                                          END ELSE
                                             FOR IBL = 1 TO NBL
                                                W.ID.BOL = AFS.BOL.XREF.REC<1,IBL>
                                                READ M.BOL.REC FROM F.BOL.CRX, W.ID.BOL THEN
                                                   ITEM = "Y"
                                                   IBL = NBL
                                                   BLN = N.BOL
                                                END

                                             NEXT IBL
                                          END
                                       END
                                    END
NEXT.BLN:                           *                               ; * JMK96
                                 NEXT BLN
                              END
                           END
                        CASE CONVERSION='REJCT'
                           YY=1
                           ZZ=1
                           REJECT.REASON=''
                           REJECT.DATE=''
NEXT.REJECTIONS:           ***
                           REJECT.REASON=''
                           REJECT.DATE=''
                           BEGIN CASE
                              CASE PRO.REC(60)<1,YY,2> # '' AND PRO.REC(62)<1,ZZ,2> # ''
                                 IF PRO.REC(60)<1,YY,2> < PRO.REC(62)<1,ZZ,2> THEN
                                    LOCATE PRO.REC(59)<1,YY> IN REJ.CODES<1> SETTING POS THEN
                                       REJECT.REASON=REJ.CODES<2,POS>
                                    END ELSE
                                       REJECT.REASON='---Unknown---'
                                    END
                                    IF OCONV(REJECT.REASON,'MCU')[1,3]='REM' THEN
                                       YY=YY+1
                                       GOTO NEXT.REJECTIONS
                                    END ELSE
                                       REJECT.DATE=PRO.REC(60)<1,YY,2>
                                    END
                                 END ELSE
                                    IF OCONV(PRO.REC(61)<1,ZZ>,'MCU')[1,3]='REM' THEN
                                       ZZ=ZZ+1
                                       GOTO NEXT.REJECTIONS
                                    END ELSE
                                       REJECT.REASON=PRO.REC(61)<1,ZZ>
                                       REJECT.DATE=PRO.REC(62)<1,ZZ,2>
                                    END
                                 END
                              CASE PRO.REC(60)<1,YY,2> # ''
                                 LOCATE PRO.REC(59)<1,YY> IN REJ.CODES<1> SETTING POS THEN
                                    REJECT.REASON=REJ.CODES<2,POS>
                                 END ELSE
                                    REJECT.REASON='---Unknown---'
                                 END
                                 IF OCONV(REJECT.REASON,'MCU')[1,3]='REM' THEN
                                    YY=YY+1
                                    GOTO NEXT.REJECTIONS
                                 END ELSE
                                    REJECT.DATE=PRO.REC(60)<1,YY,2>
                                 END
                              CASE PRO.REC(62)<1,ZZ,2> # ''
                                 IF OCONV(PRO.REC(61)<1,ZZ>,'MCU')[1,3]='REM' THEN
                                    ZZ=ZZ+1
                                    GOTO NEXT.REJECTIONS
                                 END ELSE
                                    REJECT.REASON=PRO.REC(61)<1,ZZ>
                                    REJECT.DATE=PRO.REC(62)<1,ZZ,2>
                                 END
                           END CASE
                           IF ATTR='59' OR ATTR='61' THEN
                              ITEM=REJECT.REASON
                           END
                           IF ATTR='60' OR ATTR='62' THEN
                              IF REJECT.DATE#'' THEN
                                 ITEM=OCONV(REJECT.DATE,'D2/')
                              END ELSE
                                 ITEM=REJECT.DATE
                              END
                           END
                           IF ATTR='59' AND VERSION = '600' AND PRO.REC(39) # 'R' THEN     ; * SWB02
*For version 600, show the Reject Reason only if the bill is a Reject Never Pay
                              ITEM=''    ; * SWB02
                           END           ; * SWB02
                        CASE CONVERSION='CNA'      ; * JMK57
                           ITEM='N/A'    ; * JMK57
                        CASE CONVERSION='GS_TX'
                           IF CLIENT.REC(81)='C' THEN
                              ITEM=PRO.REC(125)'R26'
                           END ELSE
                              ITEM=PRO.REC(129)'R26'
                           END
                        CASE CONVERSION='HS_TX'
                           IF CLIENT.REC(81)='C' THEN
                              ITEM=PRO.REC(126)'R26'
                           END ELSE
                              ITEM=PRO.REC(130)'R26'
                           END
                        CASE CONVERSION='PS_TX'
                           IF CLIENT.REC(81)='C' THEN
                              ITEM=PRO.REC(127)'R26'
                           END ELSE
                              ITEM=PRO.REC(131)'R26'
                           END
                        CASE CONVERSION='QS_TX'
                           IF CLIENT.REC(81)='C' THEN
                              ITEM=PRO.REC(128)'R26'
                           END ELSE
                              ITEM=PRO.REC(132)'R26'
                           END
                        CASE CONVERSION='ACCCD'    ; * SWB03
*This adds 5 columns for each Accessorial code on the Freight Bill
                           BEG.ACC.COL = I         ; * Set the beginning column to the current value of the loop variable ; * SWB03
                           EXPAND.ACC = 1          ; * SWB03
                           ACC.CODES=PRO.REC(70)   ; * SWB03
                           ACC.AMTS=PRO.REC(77)    ; * SWB03
                           ACC.CNT=DCOUNT(ACC.CODES, @VM)    ; * SWB03
                           FOR AC = 1 TO ACC.CNT   ; * SWB03
                              ITEM=ACC.CODES<1,AC>           ; * SWB03
                              IF ITEM # '' THEN    ; * SWB03
                                 IF (PRO.REC(21)='12' AND ITEM # 'BASE' AND ITEM # 'FUEL') OR (PRO.REC(21)='8' AND ITEM # '1' AND ITEM # '2' AND ITEM # '4') OR (ITEM # 'FRT' AND ITEM # 'FSC') THEN     ; * SWB05
                                    GOSUB HANDLE.LI.CODES    ; * SWB03
                                    IF BILL.ACC.CNT > 0 THEN LINE := @VM         ; * SWB03
                                    LINE := ITEM:@VM:T.FILE.ITEM:@VM:OCONV(ACC.AMTS<1,AC>, 'MD2')    ; * SWB03
                                    BILL.ACC.CNT += 1        ; * SWB03
                                 END     ; * SWB03
*The variable LINE is being built in this loop including ITEM and 2 other 'columns'
*of info. To keep the Accessorial Code (the contents of ITEM) from being appeneded
*AGAIN, null ITEM in each iteration of the loop when it is NOT null
*so it won't be re-appended near the bottom of the I loop
                                 ITEM = ''         ; * SWB05
                              END        ; * SWB03
                           NEXT AC       ; * SWB03
*Since bills were selected that have Accessorials in field 70 and 151, if none are found in 70 other than FRT
*and FSC, skip this bill
                           IF BILL.ACC.CNT = 0 THEN GOTO OWEN.REPEAT   ; * SWB03
                           IF BILL.ACC.CNT > MAX.ACC.CNT THEN          ; * SWB03
                              MAX.ACC.CNT = BILL.ACC.CNT     ; * SWB03
                              LAST.ACC.COL = BEG.ACC.COL + (MAX.ACC.CNT * 5)     ; * SWB03
                           END           ; * SWB03
                        CASE CONVERSION='G.1'
                           GB = OCONV(ITEM,CONVERSION)
                           GB1 =ICONV(GB,"D")
                           GB2 = OCONV(GB1,"D2/")
                           ITEM = GB2
                        CASE 1
                           ITEM=OCONV(ITEM,CONVERSION)
                     END CASE            ; * JMK14

                  END

                  IF CLIENT.ID='02427' THEN        ; * JMK104 ; * JMK105
                     IF CARRIER.ID='00050' THEN    ; * JMK105
                        IF ITEM=PRO.NUM THEN       ; * JMK104
                           CKVIN=''      ; * JMK104
                           CKVOUT=''     ; * JMK104
                           CKVIN<2>='MOD10'        ; * JMK104
                           CKVIN<3>=ITEM[1,8]      ; * JMK104
                           CALL CHECK.DIGIT(CKVIN,CKVOUT)    ; * JMK104
                           IF CKVOUT<2>#'' THEN    ; * JMK104
                              ITEM:=CKVOUT<2>      ; * JMK104
                           END           ; * JMK104
                        END              ; * JMK104
                     END                 ; * JMK105
                     * Begin GRB15
                     IF CARRIER.ID='00018' AND PRO.REC(2) = "O" THEN
                        IF ITEM=PRO.NUM THEN
                           CKVIN=''
                           CKVOUT=''
                           CKVIN<2>='MOD7'
                           CKVIN<3>=ITEM[1,10]
                           CALL CHECK.DIGIT(CKVIN,CKVOUT)
                           IF CKVOUT<2>#'' THEN
                              ITEM:=CKVOUT<2>
                           END
                        END
                     END
                     * End GRB15

* Begin NKH05
*                     IF CARRIER.ID='00687' THEN    ; * JMK105
*                        IF ITEM=PRO.NUM THEN       ; * JMK105
*                           CKVIN=''      ; * JMK105
*                           CKVOUT=''     ; * JMK105
*                           CKVIN<2>='RETL'         ; * JMK105
*                           CKVIN<3>=ITEM[1,10]     ; * JMK105
*                          CALL CHECK.DIGIT(CKVIN,CKVOUT)    ; * JMK105
*                           IF CKVOUT<2>#'' THEN    ; * JMK105
*                              ITEM:=CKVOUT<2>      ; * JMK105
*                           END           ; * JMK105
*                        END              ; * JMK105
*                     END                 ; * JMK105
* End NKH05
                  END                    ; * JMK105
                  IF DSPECS(7)<1,I>#'' THEN
                     T.FILE=DSPECS(7)<1,I>
                     T.FILE.ITEM=''
                     BEGIN CASE
                        CASE T.FILE='CS'
                           ZIP.VAR=ITEM
                           BEGIN CASE
                              CASE ZIP.VAR MATCHES '5N'
                              CASE ZIP.VAR MATCHES '1A1N1A1N1A1N'
                              CASE ZIP.VAR MATCHES '1N1A1N1A1N1A'
                              CASE 1 ; ZIP.VAR=''
                           END CASE
                           IF ZIP.VAR='' THEN
                              T.FILE.ITEM=''
                           END ELSE
                              CALL FB.READ.ZIP(ZIP.VAR,CITY,STATE)
                              T.FILE.ITEM=CITY:", ":STATE
                           END
                        CASE T.FILE='CSZ'
                           ZIP.VAR=ITEM
                           BEGIN CASE
                              CASE ZIP.VAR MATCHES '5N'
                              CASE ZIP.VAR MATCHES '1A1N1A1N1A1N'
                              CASE ZIP.VAR MATCHES '1N1A1N1A1N1A'
                              CASE 1 ; ZIP.VAR=''
                           END CASE
                           IF ZIP.VAR='' THEN
                              T.FILE.ITEM=''
                           END ELSE
                              CALL FB.READ.ZIP(ZIP.VAR,CITY,STATE)
                              CS.ATTR=DSPECS(8)<1,I>
                              CS.VAL=DSPECS(9)<1,I>
                              IF CS.ATTR = 1 OR CS.ATTR = 2 THEN T.FILE.ITEM = CITY : @AM : STATE
                           END
                        CASE T.FILE='CA'
                           READ T.FILE.ITEM FROM F.CARRIERS,ITEM ELSE T.FILE.ITEM=''
                        CASE T.FILE = "BOL"
                           ITEM = ""
                           **        IF USER='DAVID' OR  USER = "GBINO" THEN CALL ELINE('PRESS BREAK')
                           READ T.FILE.ITEM FROM F.BOL.CRX, PRO.REC(ATTR) ELSE T.FILE.ITEM = ''
                        CASE T.FILE='CL'
                           READ T.FILE.ITEM FROM F.CLIENTS,CLIENT.ID ELSE T.FILE.ITEM=''   ; * JMK45
                        CASE T.FILE='DV'
                           IF DIVISION='Y' THEN
                              READ T.FILE.ITEM FROM F.DIVISION,ITEM ELSE T.FILE.ITEM=''
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='DVZ'
                           IF DIVISION='Y' THEN
                              READ T.FILE.ITEM FROM F.DIVISION,ITEM ELSE T.FILE.ITEM=''
                              ITEM=T.FILE.ITEM<1>
                              READ T.FILE.ITEM FROM F.ZIPS, ITEM ELSE  ; * JMK35
                                 READ T.FILE.ITEM FROM F.CAN.ZIPS, ITEM ELSE T.FILE.ITEM=''          ; * JMK35
                              END        ; * JMK35
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='FB.TRANSPORT'
                           READ T.FILE.ITEM FROM F.TRANSPORT,ITEM ELSE T.FILE.ITEM=''
                        CASE T.FILE='LI.CODES'
                           GOSUB HANDLE.LI.CODES   ; * SWB03
                        CASE T.FILE='CHG.CODES'    ; * JMK87
                           T.FILE.ITEM=''          ; * JMK87
                           IF ITEM#'' THEN         ; * JMK87
                              T.FILE.ITEM='OTH'    ; * JMK87
                              BEGIN CASE           ; * JMK87
                                 CASE PRO.REC(21)='12'       ; * JMK87
                                    LOCATE ITEM IN AIR.CODES<1> SETTING POS THEN           ; * JMK87
                                       T.FILE.ITEM=AIR.CODES<5,POS>    ; * JMK87
                                    END  ; * JMK87
                                 CASE PRO.REC(21)='8'        ; * JMK87
                                    LOCATE ITEM IN INTL.CODES<1> SETTING POS THEN          ; * JMK87
                                       T.FILE.ITEM=INTL.CODES<5,POS>   ; * JMK87
                                    END  ; * JMK87
                                 CASE 1
                                    LOCATE ITEM IN LI.CODES<1> SETTING POS THEN  ; * JMK87
                                       T.FILE.ITEM=LI.CODES<5,POS>     ; * JMK87
                                    END  ; * JMK87
                              END CASE   ; * JMK87
                           END           ; * JMK87
                        CASE T.FILE='CHG.DESC'     ; * JMK87
                           T.FILE.ITEM=''          ; * JMK87
                           IF ITEM#'' THEN         ; * JMK87
                              T.FILE.ITEM='OTH'    ; * JMK87
                              BEGIN CASE           ; * JMK87
                                 CASE PRO.REC(21)='12'       ; * JMK87
                                    LOCATE ITEM IN AIR.CODES<1> SETTING POS THEN           ; * JMK87
                                       T.FILE.ITEM=AIR.CODES<2,POS>    ; * JMK87
                                    END  ; * JMK87
                                 CASE PRO.REC(21)='8'        ; * JMK87
                                    LOCATE ITEM IN INTL.CODES<1> SETTING POS THEN          ; * JMK87
                                       T.FILE.ITEM=INTL.CODES<2,POS>   ; * JMK87
                                    END  ; * JMK87
                                 CASE 1
                                    LOCATE ITEM IN LI.CODES<1> SETTING POS THEN  ; * JMK87
                                       T.FILE.ITEM=LI.CODES<2,POS>     ; * JMK87
                                    END  ; * JMK87
                              END CASE   ; * JMK87
                           END           ; * JMK87
                        CASE T.FILE='OVRCHG.CODES'
                           IF ITEM#'' THEN
                              LOCATE ITEM IN OVR.CODES<1> SETTING POS THEN
                                 T.FILE.ITEM=OVR.CODES<2,POS>
                              END ELSE
                                 T.FILE.ITEM='---Unknown---'
                              END
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='REJ.CODES'    ; * JMK28
                           IF ITEM#'' THEN         ; * JMK28
                              LOCATE ITEM IN REJ.CODES<1> SETTING POS THEN       ; * JMK28
                                 T.FILE.ITEM=REJ.CODES<2,POS>          ; * JMK28
                              END ELSE   ; * JMK28
                                 T.FILE.ITEM='---Unknown---'           ; * JMK28
                              END        ; * JMK28
                           END ELSE      ; * JMK28
                              T.FILE.ITEM=''       ; * JMK28
                           END           ; * JMK28
                        CASE T.FILE='SERV.LEV'
                           IF ITEM#'' THEN
                              LOCATE ITEM IN SERV.LEV<1> SETTING POS THEN
                                 T.FILE.ITEM=SERV.LEV<2,POS>
                              END ELSE
                                 T.FILE.ITEM='---Unknown---'
                              END
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='AFS.SERV.LEV'
                           IF ITEM#'' THEN
                              LOCATE ITEM IN SERV.LEV<1> SETTING POS THEN
                                 T.ITEM=SERV.LEV<3,POS>
                                 LOCATE T.ITEM IN AFS.SERV.LEV<1> SETTING POS THEN
                                    T.FILE.ITEM=AFS.SERV.LEV<2,POS>
                                 END ELSE
                                    T.FILE.ITEM=T.ITEM:' is not in BASE'
                                 END
                              END ELSE
                                 T.FILE.ITEM='---Unknown---'
                              END
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='VC'           ; * JMK56
                           IF VEND='Y' OR CUST='Y' THEN      ; * JMK29
                              READ T.FILE.ITEM FROM F.VC,ITEM ELSE T.FILE.ITEM=''          ; * JMK56
                           END ELSE      ; * JMK56
                              T.FILE.ITEM=''       ; * JMK56
                           END           ; * JMK56
                        CASE T.FILE='FB.COUNTRIES'           ; * JMK999
                           OPEN '',T.FILE TO FILE.NAME THEN
                              READ T.FILE.ITEM FROM FILE.NAME,ITEM ELSE T.FILE.ITEM=''
                           END ELSE
                              T.FILE.ITEM=''
                           END
                        CASE T.FILE='SHIPPER'      ; * JMK93
                           T.FILE.ITEM=''          ; * JMK93
                           IOT=PRO.REC(2)          ; * JMK93
                           EDI=0         ; * JMK93
                           IF PRO.REC(88)#'' OR PRO.REC(53)[1,12]='EBILL.IMPORT' THEN      ; * JMK93
                              EDI=1      ; * JMK93
                           END           ; * JMK93
                           BEGIN CASE    ; * JMK93
                              CASE EDI   ; * JMK93
                                 T.FILE.ITEM<1>=EDI.REC<19>  ; * JMK93
                                 T.FILE.ITEM<2>=EDI.REC<21>  ; * JMK93
                              CASE IOT='I'         ; * JMK93
                                 T.FILE.ITEM<1>=VC.REC<1>    ; * JMK93
                                 T.FILE.ITEM<2>=VC.REC<3,1>  ; * JMK93
                              CASE IOT='O'         ; * JMK93
                                 IF TRIM(FB.DIV.REC(11))='' THEN       ; * JMK93
                                    T.FILE.ITEM<1>=CLIENT.NAME         ; * JMK93
                                 END ELSE          ; * JMK93
                                    T.FILE.ITEM<1>=FB.DIV.REC(11)      ; * JMK93
                                    IF NUM(T.FILE.ITEM<1>) THEN        ; * JMK93
                                       T.FILE.ITEM<1>=CLIENT.NAME:' ':FB.DIV.REC(11)       ; * JMK93
                                    END  ; * JMK93
                                 END     ; * JMK93
                                 IF TRIM(FB.DIV.REC(14))='' THEN       ; * JMK93
                                    T.FILE.ITEM<2>=CLIENT.REC(3)       ; * JMK93
                                 END ELSE          ; * JMK93
                                    T.FILE.ITEM<2>=FB.DIV.REC(14)      ; * JMK93
                                 END     ; * JMK93
                              CASE 1     ; * JMK93
                                 T.FILE.ITEM<1>=CLIENT.NAME  ; * JMK93
                                 T.FILE.ITEM<2>=CLIENT.REC(3)<1,1>     ; * JMK93
                           END CASE      ; * JMK93
                        CASE T.FILE='CONSIGNEE'    ; * JMK93
                           T.FILE.ITEM=''          ; * JMK93
                           IOT=PRO.REC(2)          ; * JMK93
                           EDI=0         ; * JMK93
                           IF PRO.REC(88)#'' OR PRO.REC(53)[1,12]='EBILL.IMPORT' THEN      ; * JMK93
                              EDI=1      ; * JMK93
                           END           ; * JMK93
                           BEGIN CASE    ; * JMK93
                              CASE EDI   ; * JMK93
                                 T.FILE.ITEM<1>=EDI.REC<28>  ; * JMK93
                                 T.FILE.ITEM<2>=EDI.REC<30>  ; * JMK93
                              CASE IOT='I'         ; * JMK93
                                 IF TRIM(FB.DIV.REC(11))='' THEN       ; * JMK93
                                    T.FILE.ITEM<1>=CLIENT.NAME         ; * JMK93
                                 END ELSE          ; * JMK93
                                    T.FILE.ITEM<1>=FB.DIV.REC(11)      ; * JMK93
                                    IF NUM(T.FILE.ITEM<1>) THEN        ; * JMK93
                                       T.FILE.ITEM<1>=CLIENT.NAME:' ':FB.DIV.REC(11)       ; * JMK93
                                    END  ; * JMK93
                                 END     ; * JMK93
                                 IF TRIM(FB.DIV.REC(14))='' THEN       ; * JMK93
                                    T.FILE.ITEM<2>=CLIENT.REC(3)       ; * JMK93
                                 END ELSE          ; * JMK93
                                    T.FILE.ITEM<2>=FB.DIV.REC(14)      ; * JMK93
                                 END     ; * JMK93
                              CASE IOT='O'         ; * JMK93
                                 T.FILE.ITEM<1>=VC.REC<1>    ; * JMK93
                                 T.FILE.ITEM<2>=VC.REC<3,1>  ; * JMK93
                              CASE 1     ; * JMK93
                                 T.FILE.ITEM<1>=CLIENT.NAME  ; * JMK93
                                 T.FILE.ITEM<2>=CLIENT.REC(3)          ; * JMK93
                           END CASE      ; * JMK93
                     END CASE
                     T.VAL=DSPECS(9)<1,I>
                     T.ATTR=DSPECS(8)<1,I>
                     IF T.ATTR#0 THEN
                        IF T.VAL#'' THEN
                           ITEM=T.FILE.ITEM<T.ATTR,T.VAL>
                        END ELSE
                           ITEM=T.FILE.ITEM<T.ATTR>
                           IF ITEM='' AND T.ATTR = 12 AND T.FILE='CA' THEN       ; * Don't Allow Blank SCAC
                              ITEM=T.FILE.ITEM<1>[1,5]
                           END
                        END
                     END
                  END
                  IF DSPECS(10)<1,I> THEN
                     IF USER='david' AND NOT(NUM(ITEM)) THEN
                     END
                     BEGIN CASE
                        CASE VERSION='11' AND CLIENT='01830' AND I=COL.COUNT-2   ; * JMK61
                           SUBTOTAL<1,I> += 1      ; * JMK61
                           TOTAL<1,I> += 1         ; * JMK61

                        CASE VERSION='11' AND CLIENT='01832' AND I=COL.COUNT-2   ; * JMK61
                           SUBTOTAL<1,I> += 1      ; * JMK61
                           TOTAL<1,I> += 1         ; * JMK61
                        CASE VERSION='11' AND CLIENT='01870' AND I=COL.COUNT-2   ; * JMK61
                           SUBTOTAL<1,I> += 1      ; * JMK61
                           TOTAL<1,I> += 1         ; * JMK61
                        CASE VERSION='11' AND CLIENT#'01830' AND CLIENT#'01832' AND CLIENT#'01870' AND I=COL.COUNT-1     ; * JMK60 ; * JMK61
                           SUBTOTAL<1,I> += 1      ; * JMK60
                           TOTAL<1,I> += 1         ; * JMK60
                        CASE NOT(NUM(ITEM))
                        CASE 1
                           SUBTOTAL<1,I> += ITEM
                           TOTAL<1,I> += ITEM
                     END CASE
                  END
                  BEGIN CASE
                     CASE SUB.ATTR='CARRIER.NAME'
                        IF OCONV(DSPECS(2)<1,I>,'MCU')='CARRIER NAME' THEN
                           SUBTOTAL<1,I> = OLD.SUBDATA:' Total'
                           TOTAL<1,I> = 'Grand Total '
                        END
                     CASE SUB.ATTR='CARRIER.ID'
                        IF OCONV(DSPECS(2)<1,I>,'MCU')='CARRIER#' THEN
                           SUBTOTAL<1,I> = OLD.SUBDATA:' Total'
                           TOTAL<1,I> = 'Grand Total '
                        END
                     CASE 1
                        IF ATTR = SUB.ATTR THEN
                           SUBTOTAL<1,I> = OLD.SUBDATA:' Total'
                           TOTAL<1,I> = 'Grand Total '
                        END
                  END CASE
                  ITEM=CHANGE(ITEM,@VM,' ')
                  ITEM=TRIM(ITEM)
*Begin TAG01
                  BEGIN CASE
                     CASE ATTR=16
                        ITEM=ITEM[1,100]
                     CASE ATTR=6 AND ITEM = ''
                        ITEM = 0
                     CASE ATTR=9
                        ITEM=ITEM[1,255]
                     CASE ATTR=213
                        ITEM=ITEM[1,250]
                     CASE ATTR=19 AND ITEM='ERROR'
                        ITEM=0
                     CASE ATTR = 41 AND DSPECS(3)<1,I>='FB'  ; * GRB08
                        ITEM=ITEM[1,250]           ; * GRB08
                     CASE 1
                        ITEM=ITEM[1,50]
                  END CASE
                  IF T.FILE = 'BOL' AND T.ATTR = 36 THEN
                     ITEM = OCONV(ITEM,"MR2")
                  END



*End TAG01
                  IF CONVERSION#'QUOTE' THEN       ; * JMK49
                     ITEM=CHANGE(ITEM,'"','')      ; * JMK10
                  END                    ; * JMK49

                  CHECK.CHAR=0           ; * JMK17
                  IF WHERE.FROM='FROM FB.3.1.NEW' AND USING.NEW.MACRO THEN CHECK.CHAR=1    ; * JMK17
                  IF WHERE.FROM='FROM FB.2.3.NW' AND USING.NEW.MACRO THEN CHECK.CHAR=1     ; * JMK17
                  IF WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' AND RPT.STYLE#'H' THEN CHECK.CHAR=1   ; * DRF01 ; * JMK91

                  IF CLIENT.ID='02427' THEN CHECK.CHAR=1     ; * JMK103
                  IF CHECK.CHAR AND RPT.STYLE # 'H' THEN     ; * JMK17
                     IF NOT(SLC.FRT) THEN
                        ADD.CHAR=0
                        BEGIN CASE
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=0) AND (CONVERSION='G1*1')           ; * Pro #
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=5) AND (CONVERSION='')     ; * Expense Code
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=16) AND (CONVERSION='')    ; * BOL
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=183) AND (CONVERSION='')   ; * User Field 1
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=184) AND (CONVERSION='')   ; * User Field 2
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=185) AND (CONVERSION='')   ; * User Field 3
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=186) AND (CONVERSION='')   ; * User Field 4
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=187) AND (CONVERSION='')   ; * User Field 5
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=188) AND (CONVERSION='')   ; * User Field 6
                              ADD.CHAR=1
                           CASE (DSPECS(3)<1,I>='FB') AND (ATTR=240) AND (CONVERSION='')   ; * AFS BOL #
                              ADD.CHAR=1
                        END CASE

                        IF ADD.CHAR AND RPT.STYLE#'H' THEN   ; * JMK08
                           BEGIN CASE    ; * JMK40
                              CASE CLIENT.REC(239)='?'       ; * JMK40
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM='?':ITEM  ; * JMK40
                                 END     ; * JMK49
                              CASE CLIENT.REC(239)='!'       ; * JMK40
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM='!':ITEM  ; * JMK40
                                 END     ; * JMK49
                              CASE CLIENT.REC(239)='#'       ; * JMK40
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM='#':ITEM  ; * JMK40
                                 END     ; * JMK49
                              CASE CLIENT.REC(239)='~'       ; * JMK40
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM='~':ITEM  ; * JMK40
                                 END     ; * JMK49
                              CASE CLIENT.REC(239)="'"       ; * JMK49GRB02
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM="'":ITEM  ; * JMK49
                                 END     ; * JMK49
                              CASE 1     ; * JMK40
                                 IF ITEM#'' THEN   ; * JMK49
                                    ITEM='=':QUOTE(ITEM)     ; * JMK40
                                 END
                           END CASE      ; * JMK40
                        END              ; * JMK40
                     END
                  END                    ; * JMK40

               END                       ; * JMK47

               IF CONVERSION = "ORD#" AND CLIENT.ID = "01630" THEN     ; * GRB05
                  T.DAT = CHANGE(PRO.REC(ATTR),@VM,',')
                  ORD.CHK = FIELD(T.DAT,'-',1)
                  ORD.CHK2 = FIELD(T.DAT,'/',1)
                  BEGIN CASE
                     CASE LEN(ORD.CHK) GT 6
                        ITEM = ''
                     CASE LEN(T.DAT) = 5 OR LEN(T.DAT) = 6
                        IF NUM(T.DAT) THEN
                           ITEM = T.DAT
                        END
                     CASE LEN(ORD.CHK) = 5 OR LEN(ORD.CHK) = 6
                        IF NUM(ORD.CHK) THEN
                           ITEM = T.DAT
                        END

                     CASE 1
                        ITEM = ''
                  END CASE
               END                       ; * GRB05
               IF CONVERSION = "GINVD" THEN
                  IF PRO.REC(21) = 1 THEN
                     ITEM = OCONV(PRO.REC(1),'D2/')
                  END ELSE
                     IF PRO.REC(246) # '' THEN
                        ITEM = OCONV(PRO.REC(246),'D2/')
                     END ELSE
                        IF PRO.REC(183) # '' THEN
                           IF INDEX(PRO.REC(183),'/',1) THEN
                              DT.TST = ICONV(PRO.REC(183),'D')
                              IF DT.TST # "" THEN
                                 ITEM = OCONV(DT.TST,'D2/')
                              END
                           END ELSE
                              IF NUM(PRO.REC(183)) THEN
                                 DT.TST = PRO.REC(183)[1,2]:'/':PRO.REC(183)[3,2]:'/':PRO.REC(183)[5,2]
                                 DT.TST = ICONV(DT.TST,'D')
                                 IF DT.TST # "" THEN
                                    ITEM = OCONV(DT.TST,'D2/')
                                 END
                              END ELSE
                                 ITEM =''
                              END
                           END
                        END
                     END
                  END
               END


* Begin GRB14
               IF CONVERSION = "LTLFA" THEN
                  IF AIRGAS.FLG AND PRO.REC(37) GE 20483 THEN          ; * DRF20
                     IF PRO.REC(21) = 1 THEN       ; * DRF20
                        ITEM = OCONV(9430,'MD3')   ; * DRF20
                     END ELSE            ; * DRF20
                        ITEM = OCONV(570,'MD3')    ; * DRF20
                     END                 ; * DRF20
                     IF PRO.NUM[LEN(PRO.NUM)-1,2]='BD' OR PRO.NUM[LEN(PRO.NUM)-1,2]='AD' THEN ITEM = ''        ; * DRF17
                  END ELSE               ; * DRF18
                     IF AIRGAS.FLG AND PRO.REC(37) GE 20280 THEN       ; * DRF19
                        IF PRO.REC(21) = 1 THEN    ; * DRF19
                           ITEM = OCONV(9125,'MD3')          ; * DRF19
                        END ELSE         ; * DRF19
                           ITEM = OCONV(525,'MD3')           ; * DRF19
                        END              ; * DRF19
                        IF PRO.NUM[LEN(PRO.NUM)-1,2]='BD' OR PRO.NUM[LEN(PRO.NUM)-1,2]='AD' THEN ITEM = ''     ; * DRF17
                     END ELSE            ; * DRF18
                        IF AIRGAS.FLG AND PRO.REC(37) GE 20245 THEN    ; * DRF18
                           IF PRO.REC(21) = 1 THEN           ; * DRF18
                              ITEM = OCONV(9100,'MD3')       ; * DRF18
                           END ELSE      ; * DRF18
                              ITEM = OCONV(500,'MD3')        ; * DRF18
                           END           ; * DRF18
                           IF PRO.NUM[LEN(PRO.NUM)-1,2]='BD' OR PRO.NUM[LEN(PRO.NUM)-1,2]='AD' THEN ITEM = ''  ; * DRF17
                        END ELSE         ; * DRF18
                           IF AIRGAS.FLG AND PRO.REC(37) GE 20106 THEN           ; * DRF16
                              IF PRO.REC(21) = 1 THEN        ; * DRF16
                                 ITEM = OCONV(8550,'MD3')    ; * DRF16
                              END ELSE   ; * DRF16
                                 ITEM = OCONV(500,'MD3')     ; * DRF16
                              END        ; * DRF16
                              IF PRO.NUM[LEN(PRO.NUM)-1,2]='BD' OR PRO.NUM[LEN(PRO.NUM)-1,2]='AD' THEN ITEM = ''         ; * DRF17
                           END ELSE      ; * DRF16
                              IF AIRGAS.FLG AND PRO.REC(37) GE 20007 THEN        ; * DRF15
                                 IF PRO.REC(21) = 1 THEN     ; * DRF15
                                    ITEM = OCONV(7600,'MD3')           ; * DRF15
                                 END ELSE          ; * DRF15
                                    ITEM = OCONV(450,'MD3')  ; * DRF15
                                 END     ; * DRF15
                              END ELSE   ; * DRF15
                                 IF AIRGAS.FLG AND PRO.REC(37) GE 19730 THEN
                                    IF PRO.REC(21) = 1 THEN
                                       ITEM = OCONV(7625,'MD3')
                                    END ELSE
                                       ITEM = OCONV(475,'MD3')
                                    END
                                 END ELSE
                                    IF AIRGAS.FLG AND PRO.REC(37) GE 19503 THEN
                                       IF PRO.REC(21) = 1 THEN
                                          ITEM = OCONV(765,'MD2')
                                       END ELSE
                                          ITEM = OCONV(50,'MD2')
                                       END
                                    END ELSE
                                       IF AIRGAS.FLG AND PRO.REC(37) GE 19025 THEN
                                          IF PRO.REC(21) = 1 THEN
                                             ITEM = OCONV(770,'MD2')
                                          END ELSE
                                             ITEM = OCONV(55,'MD2')
                                          END
                                       END ELSE
                                          ITEM=""
                                       END
                                    END
                                 END
                              END
                           END
                        END
                     END
                  END
               END
               * End GRB14
               IF CONVERSION='MIN' THEN  ; * GRB01
                  IF PRO.ID = "00979*224542958*0" THEN DEBUG
                  IN.QUOTE.PERC = CLIENT.REC(136)<1,1>
                  OUT.QUOTE.PERC = CLIENT.REC(137)<1,1>
                  TP.QUOTE.PERC = CLIENT.REC(138)<1,1>
                  IF IN.QUOTE.PERC = '' OR OUT.QUOTE.PERC='' OR TP.QUOTE.PERC='' THEN
                     ITEM = 'Cannot Determine Minimum amount'
                     GO 888
                  END
                  IF LINE<1,I-1> = "MIN" THEN
                     ITEM = "Minimum"
                  END
                  IF LINE<1,I-1> = "FLAT" THEN
                     ITEM = "Flat"
                  END ELSE
                     MIN.CHG = 0
                     CALL CALC.MIN.CHG(CLIENT.ID,CARRIER.ID,MAT PRO.REC,MAT CLIENT.REC,MIN.CHG,FLAT.CHG)
                     TYP.TOT = 0
                     DEF.FLG=0
                     IF PRO.REC(252) # "" THEN
                        MIN.CHK = INDEX(PRO.REC(252),'ABMIN',1)
                        MIN.CHK2 = INDEX(PRO.REC(252),'TMIN',1)
                        DEF.CHK = INDEX(PRO.REC(252),'DEF',1)
                     END ELSE
                        MIN.CHK = INDEX(PRO.REC(252),'ABMIN',1)
                        MIN.CHK2 = INDEX(PRO.REC(151),'TMIN',1)
                        DEF.CHK = INDEX(PRO.REC(151),'DEF',1)
                     END
                     IF DEF.CHK GT 0 THEN DEF.FLG = 1
                     IF MIN.CHK GT "0" OR MIN.CHK2 GT "0" THEN
                        ITEM = "MIN"
                     END ELSE
                        IF PRO.REC(252) # "" THEN
                           TYP.CNT = DCOUNT(PRO.REC(252),@VM)
                           FOR K = 1 TO TYP.CNT
                              IF PRO.REC(252)<1,K> = "FRT" OR PRO.REC(151)<1,K> = "DEF" THEN
                                 TYP.TOT = TYP.TOT + PRO.REC(259)<1,K>
                              END
                           NEXT K
                        END ELSE
                           TYP.CNT = DCOUNT(PRO.REC(151),@VM)
                           FOR K = 1 TO TYP.CNT
                              IF PRO.REC(151)<1,K> = "FRT" OR PRO.REC(151)<1,K> = "DEF" THEN
                                 TYP.TOT = TYP.TOT + PRO.REC(152)<1,K>
                              END
                           NEXT K
                        END

                        IF MIN.CHG GT "0" OR FLAT.CHG GT "0" THEN
                           * sum up all frt type
                           IF MIN.CHG GE TYP.TOT OR MIN.CHK GT 0 THEN
                              IF PRO.REC(8) GT "0" THEN
                                 ITEM = "MIN"
                              END
                           END
                           IF FLAT.CHG GT 0 THEN
                              ITEM = "FLAT"
                           END
                        END
                        IF PRO.REC(6) = 0 THEN
                           ITEM = "OTHER"
                        END
                        IF PRO.REC(74) = "" THEN
                           ITEM = "OTHER"
                        END
                        IF DEF.FLG = 1 THEN
                           ITEM = "DEFICIT"
                        END
                     END
                     * End GRB11
                  END                    ; * GRB01

               END
**********************************************
888:           IF VERSION = '63' AND I = 10 THEN   ; * GRB04
                  ITEM=OCONV(PRO.REC(8)+PRO.REC(44)+ PRO.REC(43),'MD2')          ; * GRB04
               END                       ; * GRB04
               IF VERSION = '26' AND ATTR = "62" THEN

                  VER26.CNT = DCOUNT(PRO.REC(ATTR),@VM)
                  ITEM = OCONV(PRO.REC(ATTR)<1,VER26.CNT,2>,"D2-")
               END
*****************************************************
               * Begin NKH01
               * ATTR 74 = Class
               * ATTR 75 = Weight

               IF ATTR = 74 THEN
                  SAVE.CLASS = ITEM
               END
               IF ATTR = 75 THEN
                  * Remove weight if no class
                  IF CARRIER # '23288' THEN        ; * NKH06
                     IF SAVE.CLASS = "" AND NUM(ITEM) THEN
                        IF ITEM > 0 THEN
                           HDG.DESC = DSPECS(2)
                           LOCATE 'Weight' IN HDG.DESC<1> SETTING W.POS THEN
                              IF NOT(NUM(CLIENT)) THEN W.POS += 2
                              IF NUM(LINE<1,W.POS>) THEN
                                 IF LINE<1,W.POS> > 0 THEN

*IF USER = 'NMEDDAUGH' THEN
*   FIX.ID = CLIENT.ID:"*":PRO.ID
*   FIX.REC = ''
*   WRITE FIX.REC ON F.FIX, FIX.ID

                                    ** LINE<1,W.POS> -= ITEM       ; * Remove weight from total weight
                                    **  ITEM = ''
*END
                                 END
                              END
                           END
                        END
                     END
                  END                    ; * NKH06
                  SAVE.CLASS = ''
               END
               * End NKH01
               IF I < ITEM.COUNT THEN
                  LINE<1>:=ITEM:@VM
               END ELSE
                  LINE<1>:=ITEM
               END
               IF RPT.STYLE='H' THEN     ; * JMK60
                  IF ITEM#'' THEN        ; * JMK60
                     BEGIN CASE          ; * JMK60

                        CASE CONVERSION[1,2]='BC'  ; * JMK61 ; * JMK63
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,'MD2'),'MD2,'):\</TD>\           ; * JMK61
                        CASE CONVERSION[1,2]='FC'  ; * JMK60 ; * JMK63
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,'MD2'),'MD2,'):\</TD>\           ; * JMK60
                        CASE CONVERSION[1,2]='TC'  ; * JMK60 ; * JMK63
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,'MD2'),'MD2'):\</TD>\  ; * JMK60
                        CASE CONVERSION='MOPAY'    ; * JMK60
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,'MD2'),'MD2'):\</TD>\  ; * JMK60
                        CASE CONVERSION='LOPAY'    ; * JMK60
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,'MD2'),'MD2'):\</TD>\  ; * JMK60
                        CASE CONVERSION[1,2]='MD'  ; * JMK60
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                        CASE CONVERSION[1,2]='MR'  ; * JMK60
                           DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(ITEM,CONVERSION),CONVERSION):\</TD>\  ; * JMK60
                        CASE 1           ; * JMK60
                           DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\  ; * JMK60
                     END CASE            ; * JMK60
                  END ELSE               ; * JMK60
                     DARRAY.HTML:=\<TD>&nbsp;</TD>\          ; * JMK60
                  END                    ; * JMK60
               END                       ; * JMK60
*** For FedEx Ground paper bills, copy column E to column AW
               IF CARRIER.ID='01075' AND I=207 AND ITEM='PPR' AND LINE<1,49> = '' THEN LINE<1,49> = LINE<1,5>  ; * JCW05
            NEXT I
            IF VERSION='115' AND DTL.ARRAY#'' THEN           ; * JMK51
               BDTL.ARRAY=''             ; * JMK51
               BDTL.ARRAY<1>=DTL.ARRAY<1>          ; * JMK51
               NDVAL=DCOUNT(BDTL.ARRAY<1>,@VM)     ; * JMK51
               FOR DVAL=1 TO NDVAL       ; * JMK51
                  BDTL.ARRAY<2,DVAL>=0   ; * JMK51
                  BDTL.ARRAY<3,DVAL>=''  ; * JMK51
                  BDTL.ARRAY<4,DVAL>=''  ; * JMK51
               NEXT DVAL                 ; * JMK51
               NDVAL=DCOUNT(PRO.REC(151),@VM)      ; * JMK51
               FOR DVAL=1 TO NDVAL       ; * JMK51
                  DCODE=PRO.REC(151)<1,DVAL>       ; * JMK51
                  LOCATE DCODE IN LI.CODES<1> SETTING LPOS THEN        ; * JMK51
                     DDESC=LI.CODES<2,LPOS>        ; * JMK51
                     IF DCODE='MISC' AND PRO.REC(218)<1,DVAL>#'' THEN  ; * JMK51
                        DDESC=PRO.REC(218)<1,DVAL>           ; * JMK51
                     END                 ; * JMK51

                     DAMT=PRO.REC(152)<1,DVAL>     ; * JMK51

                  END ELSE               ; * JMK59
                     DDESC='---Unknown---'         ; * JMK59


                     DAMT=PRO.REC(152)<1,DVAL>     ; * JMK59

                  END                    ; * JMK51
                  LOCATE DCODE IN BDTL.ARRAY<1> BY 'AL' SETTING DPOS ELSE        ; * JMK51
                     INS DCODE BEFORE BDTL.ARRAY<1,DPOS>     ; * JMK51
                     INS 0 BEFORE BDTL.ARRAY<2,DPOS>         ; * JMK51
                     INS '' BEFORE BDTL.ARRAY<3,DPOS>        ; * JMK51
                     INS '' BEFORE BDTL.ARRAY<4,DPOS>        ; * JMK51
                  END                    ; * JMK51
                  BDTL.ARRAY<2,DPOS>+=1  ; * JMK51
                  SVPOS=BDTL.ARRAY<2,DPOS>         ; * JMK51
                  BDTL.ARRAY<3,DPOS,SVPOS>=DDESC   ; * JMK51
                  BDTL.ARRAY<4,DPOS,SVPOS>=DAMT    ; * JMK51
               NEXT DVAL                 ; * JMK51
               NDVAL=DCOUNT(DTL.ARRAY<1>,@VM)      ; * JMK51
               FOR DVAL=1 TO NDVAL       ; * JMK51
                  DCNT=DTL.ARRAY<2,DVAL>           ; * JMK51
                  IF DCNT>0 THEN         ; * JMK51
                     FOR DCOL=1 TO DCNT  ; * JMK51
                        IF BDTL.ARRAY<4,DVAL,DCOL>+0=0 THEN  ; * JMK51
                           ITEM=''       ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                           ITEM=''       ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                           ITEM=''       ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                        END ELSE         ; * JMK51
                           ITEM=BDTL.ARRAY<1,DVAL>           ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                           ITEM=BDTL.ARRAY<3,DVAL,DCOL>      ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                           ITEM=BDTL.ARRAY<4,DVAL,DCOL>'R26'           ; * JMK51
                           LINE<1>:=@VM:ITEM       ; * JMK51
                           IF RPT.STYLE='H' THEN   ; * JMK60
                              DARRAY.HTML:=\<TD>\:CHANGE(ITEM,'&','&amp;'):\</TD>\         ; * JMK60
                           END           ; * JMK60
                        END              ; * JMK51
                     NEXT DCOL           ; * JMK51
                  END                    ; * JMK51
               NEXT DVAL                 ; * JMK51
            END                          ; * JMK51
            IF RPT.STYLE='H' THEN        ; * JMK60
               DARRAY.HTML:=\</TR>\      ; * JMK60
            END                          ; * JMK60

            IF (CLIENT='06898' OR CLIENT='06891') AND VERSION='222' THEN         ; * DRF11
*DFIF USER='DAVID' THEN CALL ELINE('PRESS BREAK')
               NUM.OF.ITEM=DCOUNT(PRO.REC(151),@VM)          ; * DRF11
               FOR J = 1 TO NUM.OF.ITEM  ; * DRF11
                  IF PRO.REC(151)<1,J>='FSC' THEN GOTO NEXT.ITEM       ; * DRF11
                  IF PRO.REC(151)<1,J>='FRT' THEN GOTO NEXT.ITEM       ; * DRF11
                  IF PRO.REC(151)<1,J>='BASE' THEN GOTO NEXT.ITEM      ; * DRF11
                  IF PRO.REC(151)<1,J>='FUEL' THEN GOTO NEXT.ITEM      ; * DRF11
                  LINE<1,1>=OCONV(PRO.REC(152)<1,J>,'MR2')   ; * DRF11
                  LINE<1,13>=PRO.REC(151)<1,J>     ; * DRF11
                  LOCATE LINE<1,13> IN LI.CODES<1> SETTING LI.CODE.POS THEN      ; * DRF11
                     LINE<1,14>=LI.CODES<2,LI.CODE.POS>      ; * DRF11
                  END ELSE               ; * DRF11
                     LOCATE LINE<1,13> IN AIR.CODES<1> SETTING AIR.CODE.POS THEN           ; * DRF11
                        LINE<1,14>=AIR.CODES<2,AIR.CODE.POS>           ; * DRF11
                     END                 ; * DRF11
                  END                    ; * DRF11
                  DARRAY<-1>=LINE        ; * DRF11
                  LINE.COUNT = LINE.COUNT +1       ; * DRF11
NEXT.ITEM:***     ; * DRF11
               NEXT                      ; * DRF11
            END ELSE                     ; * DRF11
               DARRAY<-1>=LINE
               LINE.COUNT = LINE.COUNT +1
            END                          ; * DRF11

            IF LINE.COUNT >= ROW.MAX THEN          ; * JMK41
               IF NAME.EXT = '' THEN
                  NAME.EXT = 0
               END

               DARRAY.HOLD = DARRAY<1>
               DARRAY.HOLD<-1> = @VM
               DARRAY.HOLD<-1> = DARRAY<3>
               GOSUB CONTINUE.BUILD
               DARRAY = DARRAY.HOLD
               LINE.COUNT = 3
               NAME.EXT = NAME.EXT+1
            END
*
            IF INC.BD THEN
               PRO.ID=FIELD(PRO.ID,'*',1):'*':FIELD(PRO.ID,'*',2):'BD*':FIELD(PRO.ID,'*',3)
               MATREAD PRO.REC FROM FB.BILLS,PRO.ID THEN GOTO GET.BILL
            END
            IF TEMP.ID[1,11] MATCHES "1N'-'3N'-'5N" ELSE
               PRO.ID=TEMP.ID
               TEMP.ID=''
               LINE=''
               MATREAD PRO.REC FROM FB.BILLS,PRO.ID THEN GOTO GET.BILL
            END
         END
OWEN.REPEAT:***
      REPEAT

      IF EXPAND.ACC THEN                 ; * SWB03
*Conversion Code 'ACCCD' must be the last column defined in FB.BUILD.SPEC. If there are columns defined
*after it, results will probably not be what is intended
         IF BEG.ACC.COL < LAST.ACC.COL THEN        ; * SWB03
            FIRST.DET.LINE = 1           ; * SWB03
            IF HDG.ONLY#'E' THEN         ; * SWB03
               FOR MAC = 1 TO MAX.ACC.CNT          ; * SWB03
                  IF MAC = 1 THEN        ; * SWB03
                     START.COL = BEG.ACC.COL       ; * SWB03
                  END ELSE               ; * SWB03
                     START.COL = BEG.ACC.COL + ((MAC - 1) * 3)         ; * SWB03
                  END                    ; * SWB03
                  DARRAY<COL.HEAD.ROW, START.COL> = 'Accessorial ':MAC           ; * SWB03
                  DARRAY<COL.HEAD.ROW, START.COL + 1> = 'Desc ':MAC    ; * SWB03
                  DARRAY<COL.HEAD.ROW, START.COL + 2> = 'Amount ':MAC  ; * SWB03
               NEXT MAC                  ; * SWB03
               FIRST.DET.LINE = COL.HEAD.ROW + 1   ; * SWB03
            END                          ; * SWB03
            LINE.CNT = DCOUNT(DARRAY, @FM)         ; * SWB03
            FOR LC = FIRST.DET.LINE TO LINE.CNT    ; * SWB03
               COL.CNT = DCOUNT(DARRAY<LC>, @VM)   ; * SWB03
               MISSING.COLS = LAST.ACC.COL - COL.CNT -1      ; * SWB03
               DARRAY<LC> := STR(@VM, MISSING.COLS)          ; * SWB03
            NEXT LC                      ; * SWB03
         END                             ; * SWB03
      END                                ; * SWB03
      IF VERSION='115' AND DTL.CAPTURE THEN        ; * JMK51
         RETURN                          ; * JMK51
      END                                ; * JMK51
      IF SHOULD.SUBTOTAL THEN
         DARRAY<-1> = SUBTOTAL<1>
         DARRAY<-1> = ''
         IF RPT.STYLE='H' THEN           ; * JMK60
            LNCOLOR=LNCOLOR=0            ; * JMK60
            IF LNCOLOR=1 THEN            ; * JMK60
               DARRAY.HTML<-1>=\<TR BGCOLOR="white">\        ; * JMK60
            END ELSE                     ; * JMK60
               DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\    ; * JMK60
            END                          ; * JMK60
            FOR CCNT=1 TO COL.COUNT      ; * JMK60
               BEGIN CASE                ; * JMK60
                  CASE SUB.ATTR='CARRIER.NAME'     ; * JMK60
                     IF OCONV(DSPECS(2)<1,CCNT>,'MCU')='CARRIER NAME' THEN       ; * JMK60
                        DARRAY.HTML:=\<TD><I>\:CHANGE(SUBTOTAL<1,CCNT>,'&','&amp;'):\</I></TD>\      ; * JMK60
                     END ELSE            ; * JMK60
                        IF SUBTOTAL<1,CCNT>#'' THEN          ; * JMK60
                           CONVERSION=DSPECS(6)<1,CCNT>      ; * JMK60
                           BEGIN CASE    ; * JMK60

                              CASE CONVERSION[1,2]='BC'      ; * JMK61 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK61

                              CASE CONVERSION[1,2]='FC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK60

                              CASE CONVERSION[1,2]='TC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='MOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='LOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MD'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MR'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE 1     ; * JMK60
                                 IF SUBTOTAL<1,CCNT>='' THEN           ; * JMK60
                                    DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\           ; * JMK60
                                 END ELSE          ; * JMK60
                                    DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\       ; * JMK60
                                 END     ; * JMK60
                           END CASE      ; * JMK60
                        END ELSE         ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                        END              ; * JMK60
                     END                 ; * JMK60
                  CASE SUB.ATTR='CARRIER.ID'       ; * JMK60
                     IF OCONV(DSPECS(2)<1,CCNT>,'MCU')='CARRIER#' THEN           ; * JMK60
                        DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\   ; * JMK60
                     END ELSE            ; * JMK60
                        IF SUBTOTAL<1,CCNT>#'' THEN          ; * JMK60
                           CONVERSION=DSPECS(6)<1,CCNT>      ; * JMK60
                           BEGIN CASE    ; * JMK60

                              CASE CONVERSION[1,2]='BC'      ; * JMK61 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK61

                              CASE CONVERSION[1,2]='FC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK60

                              CASE CONVERSION[1,2]='TC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='MOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='LOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MD'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MR'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE 1     ; * JMK60
                                 IF SUBTOTAL<1,CCNT>='' THEN           ; * JMK60
                                    DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\           ; * JMK60
                                 END ELSE          ; * JMK60
                                    DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\       ; * JMK60
                                 END     ; * JMK60
                           END CASE      ; * JMK60
                        END ELSE         ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                        END              ; * JMK60
                     END                 ; * JMK60
                  CASE 1                 ; * JMK60
                     IF ATTR = SUB.ATTR THEN       ; * JMK60
                        IF SUBTOTAL<1,CCNT>#'' THEN          ; * JMK60
                           CONVERSION=DSPECS(6)<1,CCNT>      ; * JMK60
                           BEGIN CASE    ; * JMK60

                              CASE CONVERSION[1,2]='BC'      ; * JMK61 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK61

                              CASE CONVERSION[1,2]='FC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\   ; * JMK60

                              CASE CONVERSION[1,2]='TC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='MOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION='LOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MD'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE CONVERSION[1,2]='MR'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(SUBTOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\    ; * JMK60
                              CASE 1     ; * JMK60
                                 IF SUBTOTAL<1,CCNT>='' THEN           ; * JMK60
                                    DARRAY.HTML:=\<TD>\:SUBTOTAL<1,CCNT>:\</TD>\           ; * JMK60
                                 END ELSE          ; * JMK60
                                    DARRAY.HTML:=\<TD ALIGN="RIGHT">\:SUBTOTAL<1,CCNT>:\</TD>\       ; * JMK60
                                 END     ; * JMK60
                           END CASE      ; * JMK60
                        END ELSE         ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                        END              ; * JMK60
                     END                 ; * JMK60
               END CASE                  ; * JMK60
            NEXT CCNT                    ; * JMK60
            DARRAY.HTML:=\</TR>\         ; * JMK60
         END                             ; * JMK60
      END
      IF SHOULD.SUBTOTAL THEN
         IF (CLIENT='02138' AND VERSION='526') OR (CLIENT='05495' AND VERSION='263') OR (CLIENT='05813' AND VERSION='772') THEN    ; * DRF06; * DRF09
            NULL                         ; * DRF06
         END ELSE                        ; * DRF04
            DARRAY<-1> = TOTAL
         END                             ; * DRF04
         IF RPT.STYLE='H' THEN           ; * JMK60
            LNCOLOR=LNCOLOR=0            ; * JMK60
            IF LNCOLOR=1 THEN            ; * JMK60
               DARRAY.HTML<-1>=\<TR BGCOLOR="white">\        ; * JMK60
            END ELSE                     ; * JMK60
               DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\    ; * JMK60
            END                          ; * JMK60
            FOR CCNT=1 TO COL.COUNT      ; * JMK60
               BEGIN CASE                ; * JMK60
                  CASE SUB.ATTR='CARRIER.NAME'     ; * JMK60
                     IF OCONV(DSPECS(2)<1,CCNT>,'MCU')='CARRIER NAME' THEN       ; * JMK60
                        DARRAY.HTML:=\<TD><B>\:CHANGE(TOTAL<1,CCNT>,'&','&amp:'):\</B></TD>\         ; * JMK60
                     END ELSE            ; * JMK60
                        IF TOTAL<1,CCNT>#'' THEN   ; * JMK60
                           CONVERSION=DSPECS(6)<1,CCNT>      ; * JMK60
                           BEGIN CASE    ; * JMK60

                              CASE CONVERSION[1,2]='BC'      ; * JMK61 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\      ; * JMK61

                              CASE CONVERSION[1,2]='FC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,'MD2'),'MD2,'):\</TD>\      ; * JMK60

                              CASE CONVERSION[1,2]='TC'      ; * JMK60 ; * JMK63
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\       ; * JMK60
                              CASE CONVERSION='MOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\       ; * JMK60
                              CASE CONVERSION='LOPAY'        ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,'MD2'),'MD2'):\</TD>\       ; * JMK60
                              CASE CONVERSION[1,2]='MD'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\       ; * JMK60
                              CASE CONVERSION[1,2]='MR'      ; * JMK60
                                 DARRAY.HTML:=\<TD ALIGN="RIGHT">\:OCONV(ICONV(TOTAL<1,CCNT>,CONVERSION),CONVERSION):\</TD>\       ; * JMK60
                              CASE 1     ; * JMK60
                                 IF TOTAL<1,CCNT>='' THEN    ; * JMK60
                                    DARRAY.HTML:=\<TD>\:TOTAL<1,CCNT>:\</TD>\    ; * JMK60
                                 END ELSE          ; * JMK60
                                    DARRAY.HTML:=\<TD ALIGN="RIGHT">\:TOTAL<1,CCNT>:\</TD>\          ; * JMK60
                                 END     ; * JMK60
                           END CASE      ; * JMK60
                        END ELSE         ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                        END              ; * JMK60
                     END                 ; * JMK60
               END CASE                  ; * JMK60
            NEXT CCNT                    ; * JMK60
            DARRAY.HTML:=\</TR>\         ; * JMK60
         END                             ; * JMK60
      END
CONTINUE.UPS.BUILD:* ; * JMK69

      IF ALL.RPT=1 AND CARRIER='UPSDTL' THEN       ; * JMK78
         GOSUB BUILD.UPS.INFO            ; * JMK78
      END                                ; * JMK78

      RETURN

*****************************************************************************
CONTINUE.BUILD:***
*****************************************************************************
      IF VERSION='115' AND DTL.CAPTURE THEN        ; * JMK51
         RETURN                          ; * JMK51
      END                                ; * JMK51
      DARRAY.VM=DARRAY
      DARRAY=CHANGE(DARRAY,@VM,TAB)
      IF RPT.STYLE='H' THEN              ; * JMK60
         IF VERSION='11' THEN            ; * DFP01
            DARRAY.HTML<-1>=\<TABLE BORDER="0" WIDTH="100%">\          ; * JMK60 ; * DFP01
            DARRAY.HTML<-1>=\<TR><TD ALIGN="RIGHT"><FONT SIZE="3" COLOR="RED">\:TCRTXT3:\</FONT></TD></TR>\    ; * JMK60 ; * DFP01
            DARRAY.HTML<-1>=\</TABLE>\   ; * JMK60 ; * DFP01
         END                             ; * DFP01
         DARRAY.HTML<-1>=\</TABLE>\      ; * JMK60
         DARRAY.HTML<-1>=\</BODY>\       ; * JMK60
         DARRAY.HTML<-1>=\</HTML>\       ; * JMK60
         HTML.NAME=''                    ; * JMK60
      END                                ; * JMK60
      SUMMARY.REC.NAME = 'SUMMARY_OF_CHARGES.'
      EXPENSE.REC.NAME = 'SUMMARY_OF_EXPENSES.'
      DIVISION.REC.NAME = 'SUMMARY_OF_DIVISIONS.'

      IF (CLIENT='ALL' OR CLIENT='AFS' OR CLIENT='SCT' OR CLIENT='UNI' OR CLIENT='UFM' OR CLIENT='LGI') THEN   ; * JMK11 ; * JMK65 ; * JMK85 ; * JMK86
         RECORD.NAME=CLIENT
         SUMMARY.REC.NAME := CLIENT:'.'
         EXPENSE.REC.NAME := CLIENT:'.'
         DIVISION.REC.NAME := CLIENT:'.'
      END ELSE
         IF SEPARATE.DIVISIONS THEN
            IF DIVISIONAL.ID='ALL' THEN
               RECORD.NAME=CLIENT'R%5'
               RECORD.NAME:='-':DIVS<1,DIV.COUNT>
            END ELSE
               RECORD.NAME=CLIENT'R%5'
               RECORD.NAME:='-':DIVISIONAL.ID
            END
         END ELSE
            RECORD.NAME=CLIENT'R%5'
            SUMMARY.REC.NAME:=CLIENT:'.'
            EXPENSE.REC.NAME:=CLIENT:'.'
            DIVISION.REC.NAME:=CLIENT:'.'
         END
      END
      RECORD.NAME:='-'
      D=BEG.DATE'D2/'
      IF BD.ONLY='I' THEN                ; * JMK86
         RECORD.NAME:=END.DATE'DY':'_'   ; * JMK86
      END                                ; * JMK86
      RECORD.NAME:=D[1,2]:D[4,2]
      D=END.DATE'D2/'
      RECORD.NAME:=D[1,2]:D[4,2]
      IF BD.ONLY='I' THEN                ; * JMK86
         RECORD.NAME:='-BD'              ; * JMK86
      END                                ; * JMK86
      RECORD.XLS=RECORD.NAME
      SUMMARY.REC.NAME := CH.NUM
      EXPENSE.REC.NAME := CH.NUM
      DIVISION.REC.NAME := CH.NUM
      IF NAME.EXT <> '' THEN
         RECORD.NAME:='-':NAME.EXT
      END
      IF RPT.STYLE='H' THEN              ; * JMK60
         HTML.NAME=RECORD.NAME:\.HTM\    ; * JMK60
      END                                ; * JMK60
      RECORD.NAME:='.XLS'
      SUMMARY.REC.NAME := '.TXT'
      EXPENSE.REC.NAME := '.TXT'
      DIVISION.REC.NAME := '.TXT'
      IF CLIENT='01706' AND VERSION='460' THEN     ; * JMK93
         IF SEPARATE.DIVISIONS THEN      ; * JMK93
            IF DIVISIONAL.ID='ALL' THEN  ; * JMK93
               RECORD.NAME=CLIENT'R%5'   ; * JMK93
               RECORD.NAME:='_':DIVS<1,DIV.COUNT>  ; * JMK93
            END ELSE                     ; * JMK93
               RECORD.NAME=CLIENT'R%5'   ; * JMK93
               RECORD.NAME:='_':DIVISIONAL.ID      ; * JMK93
            END                          ; * JMK93
         END ELSE                        ; * JMK93
            RECORD.NAME = CLIENT'R%5'    ; * JMK93
         END                             ; * JMK93
         RECORD.NAME:='-'                ; * JMK93
         D=BEG.DATE'D2/'                 ; * JMK93
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]         ; * JMK93
         RECORD.NAME:='-'                ; * JMK93
         D=END.DATE'D2/'                 ; * JMK93
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]         ; * JMK93
         IF RPT.STYLE='H' THEN           ; * JMK93
            HTML.NAME=RECORD.NAME:'-460.HTM'       ; * JMK93
         END                             ; * JMK93
         RECORD.NAME:='-460.XLS'         ; * JMK93
      END                                ; * JMK93
*DFIF USER='DAVID' THEN CALL ELINE('PRESS BREAK')

      IF WHERE.FROM='FROM FB.3.1.NEW' OR WHERE.FROM='FROM FB.2.3.NW' THEN
         IF SEPARATE.DIVISIONS THEN
            IF DIVISIONAL.ID='ALL' THEN
               RECORD.NAME=CLIENT'R%5'
               RECORD.NAME:='_':DIVS<1,DIV.COUNT>
            END ELSE
               RECORD.NAME=CLIENT'R%5'
               RECORD.NAME:='_':DIVISIONAL.ID
            END
         END ELSE
            RECORD.NAME = CLIENT'R%5'
         END
         RECORD.NAME:='-'
         D=BEG.DATE'D2/'
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]
         RECORD.NAME:='-'
         D=END.DATE'D2/'
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]
         IF WHERE.FROM='FROM FB.3.1.NEW' OR WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' THEN
            BEGIN CASE                   ; * JMK31
               CASE DUP.ONLY             ; * JMK31
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     HTML.NAME=RECORD.NAME:'-DUP.HTM'        ; * JMK60
                  END                    ; * JMK60
                  IF RPT.STYLE='C' THEN  ; * JMK100
                     RECORD.NAME:='-DUP.CSV'       ; * JMK100
                  END ELSE               ; * JMK100
                     RECORD.NAME:='-DUP.XLS'       ; * JMK31
                  END                    ; * JMK100
               CASE MISROUTE.INFO='I'    ; * JMK31
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     HTML.NAME:=RECORD.NAME:'-MRS.HTM'       ; * JMK60
                  END                    ; * JMK60
                  IF RPT.STYLE='C' THEN  ; * JMK100
                     RECORD.NAME:='-MRS.CSV'       ; * JMK100
                  END ELSE               ; * JMK100
                     RECORD.NAME:='-MRS.XLS'       ; * JMK31
                  END                    ; * JMK100
                  IF DCOUNT(DARRAY,@AM)<4 THEN     ; * JMK31
                     GO EXIT.PROGRAM     ; * JMK31
                  END                    ; * JMK31
               CASE LCC.INFO='I'         ; * JMK55
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     HTML.NAME=RECORD.NAME:'-LCC.HTM'        ; * JMK60
                  END                    ; * JMK60
                  IF RPT.STYLE='C' THEN  ; * JMK100
                     RECORD.NAME:='-LCC.CSV'       ; * JMK100
                  END ELSE               ; * JMK100
                     RECORD.NAME:='-LCC.XLS'       ; * JMK55
                  END                    ; * JMK100
                  IF DCOUNT(DARRAY,@AM)<4 THEN     ; * JMK55
                     GO EXIT.PROGRAM     ; * JMK55
                  END                    ; * JMK55
               CASE VERSION='11'         ; * JMK60
                  IF RPT.STYLE='H' THEN  ; * JMK60
                     HTML.NAME=RECORD.NAME:'-TCR.HTM'        ; * JMK60
                  END                    ; * JMK60
                  IF RPT.STYLE='C' THEN  ; * JMK100
                     RECORD.NAME:='-TCR.CSV'       ; * JMK100
                  END ELSE               ; * JMK100
                     RECORD.NAME:='-TCR.XLS'       ; * JMK60
                  END                    ; * JMK100
               CASE VERSION='610'        ; * SWB03
                  RECORD.NAME:='-ACC.XLS'          ; * SWB03
               CASE 1                    ; * JMK31
                  BEGIN CASE
                     CASE CLIENT='02275' AND VERSION='265'   ; * JMK100
                        IF SEPARATE.DIVISIONS THEN           ; * JMK100
                           IF DIVISIONAL.ID='ALL' THEN       ; * JMK100
                              RECORD.NAME='AFSWK'  ; * JMK100
                              RECORD.NAME:='_':DIVS<1,DIV.COUNT>       ; * JMK100
                           END ELSE      ; * JMK100
                              RECORD.NAME='AFSWK'  ; * JMK100
                              RECORD.NAME:='_':DIVISIONAL.ID           ; * JMK100
                           END           ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME='AFSWK'     ; * JMK100
                        END              ; * JMK100
                        IF RPT.STYLE='H' THEN      ; * JMK100
                           HTML.NAME=RECORD.NAME:'.HTM'      ; * JMK100
                        END              ; * JMK100
                        IF RPT.STYLE='C' THEN      ; * JMK100
                           RECORD.NAME:='.CSV'     ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME:='.XLS'     ; * JMK100
                        END              ; * JMK100
                     CASE CLIENT='01706' AND VERSION='460'   ; * JMK93
                        IF SEPARATE.DIVISIONS THEN           ; * JMK93
                           IF DIVISIONAL.ID='ALL' THEN       ; * JMK93
                              RECORD.NAME=CLIENT'R%5'        ; * JMK93
                              RECORD.NAME:='_':DIVS<1,DIV.COUNT>       ; * JMK93
                           END ELSE      ; * JMK93
                              RECORD.NAME=CLIENT'R%5'        ; * JMK93
                              RECORD.NAME:='_':DIVISIONAL.ID           ; * JMK93
                           END           ; * JMK93
                        END ELSE         ; * JMK93
                           RECORD.NAME = CLIENT'R%5'         ; * JMK93
                        END              ; * JMK93
                        RECORD.NAME:='-'           ; * JMK93
                        D=BEG.DATE'D2/'  ; * JMK93
                        RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]    ; * JMK93
                        RECORD.NAME:='-'           ; * JMK93
                        D=END.DATE'D2/'  ; * JMK93
                        RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]    ; * JMK93
                        IF RPT.STYLE='H' THEN      ; * JMK93
                           HTML.NAME=RECORD.NAME:'-460.HTM'  ; * JMK93
                        END              ; * JMK93
                        IF RPT.STYLE='C' THEN      ; * JMK100
                           RECORD.NAME:='-460.CSV'           ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME:='-460.XLS'           ; * JMK93
                        END              ; * JMK100
                     CASE CLIENT='10356' AND CARRIER='01075'
                        IF RPT.STYLE='H' THEN      ; * JMK60
                           HTML.NAME=RECORD.NAME:'-PARCEL.HTM'         ; * JMK60
                        END              ; * JMK60
                        IF RPT.STYLE='C' THEN      ; * JMK100
                           RECORD.NAME:='-PARCEL.CSV'        ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME:='-PARCEL.XLS'        ; * JMK31
                        END              ; * JMK100
                     CASE CLIENT='02138' AND CARRIER='UPSDTL'          ; * DRF04
                        RECORD.NAME:='-OVERCHARGE.XLS'       ; * DRF04
                     CASE CLIENT='05495' AND VERSION='263'   ; * DRF06
                        RECORD.NAME:='-CONDENSED.XLS'        ; * DRF06
                     CASE CLIENT='05813' AND VERSION='772'   ; * DRF09
                        RECORD.NAME:='-SPECIAL.XLS'          ; * DRF09
                     CASE CLIENT='07252' AND VERSION='729'   ; * DRF09
                        RECORD.NAME:='-SPECIAL.XLS'          ; * DRF09
                     CASE CLIENT='07291' AND VERSION='729'   ; * DRF09
                        RECORD.NAME:='-SPECIAL.XLS'          ; * DRF09
                     CASE VERSION='77'
                        RECORD.NAME:='-SPECIAL.XLS'
                     CASE (CLIENT='06898' OR CLIENT='06891') AND VERSION='222'   ; * DRF11
                        RECORD.NAME=RECORD.NAME:'-ACC.XLS'   ; * DRF11
                     CASE ALL.RPT=1 AND CARRIER='UPSDTL'
                        IF RPT.STYLE='H' THEN      ; * JMK61
                           HTML.NAME=RECORD.NAME:'-ALL.HTM'  ; * JMK61
                        END              ; * JMK61
                        IF RPT.STYLE='C' THEN      ; * JMK100
                           RECORD.NAME:='-ALL.CSV'           ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME:='-ALL.XLS'           ; * JMK61
                        END              ; * JMK100
                     CASE WHERE.FROM = 'FROM FB.3.1.NEW' AND CLIENT.ID = '01977' AND VERSION = '62'  ; * SWB04
                        IF RPT.STYLE='H' THEN      ; * SWB04
                           HTML.NAME=RECORD.NAME:'-MBI.HTM'  ; * SWB04
                        END              ; * SWB04
                        IF RPT.STYLE='C' THEN      ; * SWB04
                           RECORD.NAME:='-MBI.CSV'           ; * SWB04
                        END ELSE         ; * SWB04
                           RECORD.NAME:='-MBI.XLS'           ; * SWB04
                        END              ; * SWB04
                     CASE 1
                        IF RPT.STYLE='H' THEN      ; * JMK60
                           HTML.NAME=RECORD.NAME:'-BLS.HTM'  ; * JMK60
                        END              ; * JMK60
                        IF RPT.STYLE='C' THEN      ; * JMK100
                           RECORD.NAME:='-BLS.CSV'           ; * JMK100
                        END ELSE         ; * JMK100
                           RECORD.NAME:='-BLS.XLS'           ; * JMK31
                        END              ; * JMK100
                  END CASE

            END CASE                     ; * JMK31
         END ELSE
            IF RPT.STYLE='H' THEN        ; * JMK60
               HTML.NAME=RECORD.NAME:'-ACR.HTM'    ; * JMK60
            END                          ; * JMK60
            IF RPT.STYLE='C' THEN        ; * JMK100
               RECORD.NAME:='-ACR.CSV'   ; * JMK100
            END ELSE                     ; * JMK100
               RECORD.NAME:='-ACR.XLS'
            END                          ; * JMK100
         END

         BEGIN CASE                      ; * JMK60
            CASE CLIENT='02275' AND VERSION='265'  ; * JMK100
               NATT=DCOUNT(DARRAY,@AM)   ; * JMK100
               NEW.DARRAY=''             ; * JMK100
               TYPE='CSV'                ; * JMK100
               FOR ATT=1 TO NATT         ; * JMK100
                  IN=DARRAY<ATT>         ; * JMK100
                  OUT=''                 ; * JMK100
                  CALL CONVERT.STRING(IN,OUT,TYPE)           ; * JMK100
                  NEW.DARRAY<ATT>=OUT    ; * JMK100
               NEXT ATT                  ; * JMK100
               WRITE DARRAY ON F.FTP.LUND,RECORD.NAME        ; * JMK100
            CASE RPT.STYLE='H'           ; * JMK60
               WRITE DARRAY.HTML ON F.FILE,HTML.NAME         ; * JMK60
            CASE RPT.STYLE='C'           ; * JMK100
               NATT=DCOUNT(DARRAY,@AM)   ; * JMK100
               NEW.DARRAY=''             ; * JMK100
               TYPE='CSV'                ; * JMK100
               FOR ATT=1 TO NATT         ; * JMK100
                  IN=DARRAY<ATT>         ; * JMK100
                  OUT=''                 ; * JMK100
                  CALL CONVERT.STRING(IN,OUT,TYPE)           ; * JMK100
                  NEW.DARRAY<ATT>=OUT    ; * JMK100
               NEXT ATT                  ; * JMK100
               WRITE NEW.DARRAY ON F.FILE,RECORD.NAME
            CASE 1                       ; * JMK60
               WRITE DARRAY ON F.FILE,RECORD.NAME  ; * JMK60
         END CASE                        ; * JMK60


         IF CLIENT='01706' AND WHERE.FROM='FROM FB.3.1.NEW' AND INDEX(RECORD.NAME,"460.XLS",1) AND NOT(SEPARATE.DIVISIONS) THEN    ; * JMK@@
            WRITE DARRAY ON F.FTP.REXEL,RECORD.NAME          ; * JMK@@
         END                             ; * JMK@@
         IF CLIENT='02427' OR CLIENT='05654' OR CLIENT='06006' OR CLIENT='06007' THEN      ; * DRF12
            IF WHERE.FROM='FROM FB.3.1.NEW' AND NOT(SEPARATE.DIVISIONS) AND INDEX(RECORD.NAME,"BLS.XLS",1) THEN          ; * DRF12
               WRITE DARRAY ON F.FTP.BLS.TO.210,RECORD.NAME  ; * DRF12
            END                          ; * DRF12
         END                             ; * DRF12
*DFIF USER='DAVID' THEN CALL ELINE('CHECK VARIABLES')
         IF CLIENT='02192' AND WHERE.FROM='FROM FB.3.1.NEW' AND INDEX(RECORD.NAME,"BLS.CSV",1) AND NOT(SEPARATE.DIVISIONS) THEN
            WRITE NEW.DARRAY ON F.FTP.02192,RECORD.NAME
         END
*DFIF USER = 'DAVID' THEN CALL ELINE('CHECK VARIABLES')
         IF CLIENT='01067' AND WHERE.FROM='FROM FB.3.1.NEW' AND INDEX(RECORD.NAME,"BLS",1) AND NOT(SEPARATE.DIVISIONS) THEN        ; * DRF13
            WRITE DARRAY ON F.FTP.SMA,RECORD.NAME  ; * DRF13
         END                             ; * DRF13
         VOUT=''
         VOUT<1>=RECORD.NAME
         IF RPT.STYLE='H' THEN           ; * JMK60
            VOUT<1>=HTML.NAME            ; * JMK60
         END                             ; * JMK60
         RETURN
      END

      IF WHERE.FROM='FROM FB.SEND.MISROUTE.EMAILS' THEN      ; * JMK02
         RECORD.NAME = CLIENT'R%5'       ; * JMK02
         RECORD.NAME:='-'                ; * JMK02
         D=BEG.DATE'D2/'                 ; * JMK02
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]         ; * JMK02
         RECORD.NAME:='-'                ; * JMK02
         D=END.DATE'D2/'                 ; * JMK02
         RECORD.NAME:=D[7,2]:D[1,2]:D[4,2]         ; * JMK02
         IF LCC.INFO='I' THEN            ; * JMK55
            IF RPT.STYLE='H' THEN        ; * JMK60
               HTML.NAME=RECORD.NAME:'-LCC.HTM'    ; * JMK60
            END                          ; * JMK60
            IF RPT.STYLE='C' THEN        ; * JMK100
               RECORD.NAME:='-LCC.CSV'   ; * JMK100
            END ELSE                     ; * JMK100
               RECORD.NAME:='-LCC.XLS'   ; * JMK02
            END                          ; * JMK100
         END ELSE                        ; * JMK55
            IF RPT.STYLE='H' THEN        ; * JMK60
               HTML.NAME=RECORD.NAME:'-MRS.HTM'    ; * JMK60
            END                          ; * JMK60
            IF RPT.STYLE='C' THEN        ; * JMK100
               RECORD.NAME:='-MRS.CSV'   ; * JMK02
            END ELSE                     ; * JMK100
               RECORD.NAME:='-MRS.XLS'   ; * JMK02
            END                          ; * JMK100
         END                             ; * JMK55
         BEGIN CASE                      ; * JMK60
            CASE RPT.STYLE='H'           ; * JMK60
               WRITE DARRAY.HTML ON F.FILE,HTML.NAME         ; * JMK60
            CASE RPT.STYLE='C'           ; * JMK100
               NATT=DCOUNT(DARRAY,@AM)   ; * JMK100
               NEW.DARRAY=''             ; * JMK100
               TYPE='CSV'                ; * JMK100
               FOR ATT=1 TO NATT         ; * JMK100
                  IN=DARRAY<ATT>         ; * JMK100
                  OUT=''                 ; * JMK100
                  CALL CONVERT.STRING(IN,OUT,TYPE)           ; * JMK100
                  NEW.DARRAY<ATT>=OUT    ; * JMK100
               NEXT ATT                  ; * JMK100
               WRITE NEW.DARRAY ON F.FILE,RECORD.NAME
            CASE 1                       ; * JMK60
               WRITE DARRAY ON F.FILE,RECORD.NAME  ; * JMK02
         END CASE                        ; * JMK60
         VOUT=''                         ; * JMK02
         IF DARRAY<4>='' THEN            ; * JMK03
            JMK.MESSAGE<1,-1>='FROM BUILD.DF.SUB, LINES 4548-4574'     ; * JMK03
            EMAIL.OUT=''                 ; * JMK03
            EMAIL.OUT<1>='nmeddaugh@afs.net'       ; * JMK03
            EMAIL.OUT<2,-1>='DFriend@afs.net'

            IF RPT.STYLE='H' THEN        ; * JMK60
               EMAIL.OUT<5>='Missing attachment records for ':HTML.NAME          ; * JMK60
            END ELSE                     ; * JMK60
               EMAIL.OUT<5>='Missing attachment records for ':RECORD.NAME        ; * JMK03
            END                          ; * JMK60
            EMAIL.OUT<6>=JMK.MESSAGE     ; * JMK03
            EMAIL.OUT<7>=1               ; * JMK03
            IF RPT.STYLE='H' THEN        ; * JMK60
               EMAIL.OUT<11>='E:\ARDENT\PUBLIC\EMAILDATA\':HTML.NAME   ; * JMK60
            END ELSE                     ; * JMK60
               EMAIL.OUT<11>='E:\ARDENT\PUBLIC\EMAILDATA\':RECORD.NAME           ; * JMK03
            END                          ; * JMK60
            CALL SENDMAIL(EMAIL.OUT,RESULT)        ; * JMK03
         END ELSE                        ; * JMK03
            VOUT<1>=RECORD.NAME          ; * JMK02
            IF RPT.STYLE='H' THEN        ; * JMK60
               VOUT<1>=HTML.NAME         ; * JMK60
            END                          ; * JMK60
         END                             ; * JMK03
         RETURN                          ; * JMK02
      END

      IF USER='DAVID' THEN CALL ELINE('David... going to write')

      IF SLC.FRT OR SLC.ADJ THEN         ; * JMK87

         OBEG.DATE=BEG.DATE'D4/'         ; * JMK87
         OEND.DATE=END.DATE'D4/'         ; * JMK87
         IF SLC.FRT THEN                 ; * JMK87
            RECORD.NAME='SHV-':OBEG.DATE[7,4]:OBEG.DATE[1,2]:OBEG.DATE[4,2]:'-':OEND.DATE[7,4]:OEND.DATE[1,2]:OEND.DATE[4,2]:'-':OTIME:'-FRT.XLS'      ; * JMK87 ; * JMK92
         END                             ; * JMK87
         IF SLC.ADJ THEN                 ; * JMK87
            RECORD.NAME='SHV-':OBEG.DATE[7,4]:OBEG.DATE[1,2]:OBEG.DATE[4,2]:'-':OEND.DATE[7,4]:OEND.DATE[1,2]:OEND.DATE[4,2]:'-':OTIME:'-ADJ.XLS'      ; * JMK87 ; * JMK92
         END                             ; * JMK87
         DARRAY.DCNT=DCOUNT(DARRAY,@AM)  ; * JMK87
         IF DARRAY.DCNT>1 THEN           ; * JMK87
            WRITE DARRAY ON F.SHV.FRT.DATA,RECORD.NAME       ; * JMK87
            WRITE DARRAY ON F.SHV.FRT.DATA.HIST,RECORD.NAME  ; * JMK87
            EMAIL.OUT=''                 ; * JMK87
* Begin TAG02
            EMAIL.OUT<1,-1>='AFSAnalyticsConfig@afs.net '
*End TAG02
            EMAIL.OUT<4>='Reports@afs.net'         ; * JMK87
            IF SLC.FRT THEN              ; * JMK87
               EMAIL.OUT<5>='Freight Data transfer file ':RECORD.NAME:' is ready for import.'        ; * JMK87
            END                          ; * JMK87
            IF SLC.ADJ THEN              ; * JMK87
               EMAIL.OUT<5>='Freight Data Adjustment transfer file ':RECORD.NAME:' is ready for import.'       ; * JMK87
            END                          ; * JMK87
            EMAIL.OUT<6>=' '             ; * JMK87
            EMAIL.OUT<7>=1               ; * JMK87
            CALL SENDMAIL(EMAIL.OUT,RESULT)        ; * JMK87
         END                             ; * JMK87
      END                                ; * JMK87
      IF VERSION = 111 THEN              ; * Special for Cognas
         COGNAS.DARRAY=CHANGE(DARRAY,CHAR(9),"|")
         WRITE COGNAS.DARRAY ON F.FILE,RECORD.NAME
      END ELSE

         BEGIN CASE                      ; * JMK60
            CASE CLIENT='02275' AND VERSION='265'  ; * JMK100
               IF SEPARATE.DIVISIONS THEN          ; * JMK100
                  IF DIVISIONAL.ID='ALL' THEN      ; * JMK100
                     RECORD.NAME='AFSWK'           ; * JMK100
                     RECORD.NAME:='_':DIVS<1,DIV.COUNT>      ; * JMK100
                  END ELSE               ; * JMK100
                     RECORD.NAME='AFSWK'           ; * JMK100
                     RECORD.NAME:='_':DIVISIONAL.ID          ; * JMK100
                  END                    ; * JMK100
               END ELSE                  ; * JMK100
                  RECORD.NAME='AFSWK'    ; * JMK100
               END                       ; * JMK100
               IF RPT.STYLE='H' THEN     ; * JMK100
                  HTML.NAME=RECORD.NAME:'.HTM'     ; * JMK100
               END                       ; * JMK100
               IF RPT.STYLE='C' THEN     ; * JMK100
                  RECORD.NAME:='.CSV'    ; * JMK100
               END ELSE                  ; * JMK100
                  RECORD.NAME:='.XLS'    ; * JMK100
               END                       ; * JMK100
               NATT=DCOUNT(DARRAY,@AM)   ; * JMK100
               CARRAY=''                 ; * JMK100
               TYPE='CSV'                ; * JMK100
               FOR ATT=1 TO NATT         ; * JMK100
                  IN=DARRAY<ATT>         ; * JMK100
                  OUT=''                 ; * JMK100
                  CALL CONVERT.STRING(IN,OUT,TYPE)           ; * JMK100
                  CARRAY<ATT>=OUT        ; * JMK100
               NEXT ATT                  ; * JMK100
               IF WHERE.FROM='FB.3.1.NEW' THEN     ; * JMK100
                  WRITE CARRAY ON F.FTP.LUND,RECORD.NAME     ; * JMK100
               END                       ; * JMK100
            CASE RPT.STYLE='H'           ; * JMK60
               WRITE DARRAY.HTML ON F.FILE,HTML.NAME ELSE    ; * JMK60
                  CALL ELINE('Unable to write. Close IE ':HTML.NAME:'. Then press enter to write')   ; * JMK60
                  WRITE DARRAY.HTML ON F.FILE,HTML.NAME ELSE           ; * JMK60
                     CALL ELINE('Unable to write. Aborting')           ; * JMK60
                     STOP                ; * JMK60
                  END                    ; * JMK60
               END
            CASE 1                       ; * JMK60
               WRITE DARRAY ON F.FILE,RECORD.NAME ELSE
                  CALL ELINE('Unable to write. Close Excel ':RECORD.NAME:'. Then press enter to write')
                  WRITE DARRAY ON F.FILE,RECORD.NAME ELSE
                     CALL ELINE('Unable to write. Aborting')
                     STOP
                  END
               END
         END CASE                        ; * JMK60

      END
      VOUT<1>=RECORD.NAME                ; * JMK09
      IF RPT.STYLE='H' THEN              ; * JMK60
         VOUT<1>=HTML.NAME               ; * JMK60
      END                                ; * JMK60
*DFIF USER='DAVID' THEN CALL ELINE('PRESS BREAK - EMAIL')
      IF AUTO.EMAIL OR MANUAL.EMAIL THEN
         EMAIL.OUT=''
         IF MANUAL.EMAIL OR (AUTO.EMAIL AND SEPARATE.DIVISIONS) THEN
            EMAIL.OUT<1>=NEW.EMAIL.ADDR
         END ELSE
            EMAIL.OUT<1>=TRIM(CLIENT.REC(125))     ; * To Address
         END
         IF AUTO.EMAIL THEN
            EMAIL.OUT<2>=TRIM(CLIENT.REC(126))
            EMAIL.OUT<3>=TRIM(CLIENT.REC(127))
         END
         IF AUTO.EMAIL THEN              ; * DRF07
            IF CLIENT.REC(179)#'' AND ONCE=0 THEN  ; * JMK54 ; * JMK66
               EMAIL.OUT<1>=CLIENT.REC(179)        ; * JMK54
               EMAIL.OUT<2>=''           ; * JMK54
               EMAIL.OUT<3>=''           ; * JMK54
            END                          ; * JMK54
         END                             ; * DRF07
         EMAIL.OUT<4>='Reports@afs.net'
         EMAIL.OUT<5,1>=DARRAY<1>
         EMAIL.OUT<6>=DARRAY<1>
         EMAIL.OUT<6,2>=' The attached files are a Detail Spreadsheet and'
         EMAIL.OUT<6,3>='a Summary of Charges. If you have any questions,'
         EMAIL.OUT<6,4>=' please feel free to call Myra at 318-798-2111 x1232.'
         EMAIL.OUT<6,6>=' Thank you for your business.'
         EMAIL.OUT<11> = 'E:\ARDENT\PUBLIC\EMAILDATA\'
         IF RPT.STYLE='H' THEN           ; * JMK60
            EMAIL.OUT<11>:=HTML.NAME     ; * JMK60
         END ELSE                        ; * JMK60
            EMAIL.OUT<11>:=RECORD.NAME
         END                             ; * JMK60
         IF AUTO.EMAIL THEN
            EMAIL.OUT<11,2> = 'E:\ARDENT\PUBLIC\EMAILDATA\'
            EMAIL.OUT<11,2> := SUMMARY.REC.NAME
            READ EXIST.TEST FROM F.FILE,EXPENSE.REC.NAME THEN
               EMAIL.OUT<11,3> = 'E:\ARDENT\PUBLIC\EMAILDATA\'
               EMAIL.OUT<11,3> := EXPENSE.REC.NAME
            END
            READ EXIST.TEST FROM F.FILE,DIVISION.REC.NAME THEN
               EMAIL.OUT<11,4> = 'E:\ARDENT\PUBLIC\EMAILDATA\'
               EMAIL.OUT<11,4> := DIVISION.REC.NAME
            END
         END
         EVIN = EMAIL.OUT                ; * JMK09
         IF EMAIL.OUT<1>#'' THEN CALL SENDMAIL(EVIN,EVOUT)   ; * JMK09
      END
      RETURN
**************************************************************
ASSIGN.TEMP.REC:***
****************************************************************
      TEMP.ID=PRO.REC(94)
      MAT TEMP.REC=MAT PRO.REC
      TEMP.REC(88)=''
      TEMP.REC(2)='O'
      TEMP.REC(3)='99999'
      TEMP.REC(4)='99999'
      TEMP.REC(6)=0
      TEMP.REC(17)='01897'
      TEMP.REC(25)='ZZ'
      TEMP.REC(26)='ZZ'
      TEMP.REC(27)='FedEx Ground'
      TEMP.REC(28)='FedEx Ground'
      TEMP.REC(16)=EDI.REC<18>[1,4]:'-':EDI.REC<18>[5,4]:'-':EDI.REC<18>[9,999]
      TEMP.REC(100)='01897'
      TEMP.REC(7)=0
      TEMP.REC(8)=0
      TEMP.REC(10)=0
      TEMP.REC(11)=0
      TEMP.REC(12)=0
      TEMP.REC(13)=0
      TEMP.REC(42)=0
      TEMP.REC(43)=0
      TEMP.REC(44)=0
      TEMP.REC(32)=0
      TEMP.REC(33)=0
      TEMP.REC(151)='FSC'
      TEMP.REC(152)=0

      RETURN
******************************************************************
BUILD.UPS.INFO:***
******************************************************************
      CRT @(10,20):'Compiling UPS Details...'

      IF SEPARATE.DIVISIONS THEN         ; * JMK78
         IF DIVISIONAL.ID = 'ALL' THEN   ; * JMK78
            STMT='SELECT UPSDTL,':CLIENT.ID:' WITH CLI.NUM = "':CLIENT.ID'R%5':'" AND WITH DIV.NUM = "':DIVS<1,DIV.COUNT>'R%5':'" AND WITH PROC.DT >= "':BEG.DATE'D2/':'" AND WITH PROC.DT <= "':END.DATE'D2/':'"'           ; * JMK78
         END ELSE                        ; * JMK78
            STMT='SELECT UPSDTL,':CLIENT.ID:' WITH CLI.NUM = "':CLIENT.ID'R%5':'" AND WITH DIV.NUM = "':DIVISIONAL.ID'R%5':'" AND WITH PROC.DT >= "':BEG.DATE'D2/':'" AND WITH PROC.DT <= "':END.DATE'D2/':'"'     ; * JMK78
         END                             ; * JMK78
      END ELSE                           ; * JMK78
         STMT='SELECT UPSDTL,':CLIENT.ID:' WITH CLI.NUM = "':CLIENT.ID'R%5':'" AND WITH DIV.NUM = "" AND WITH PROC.DT >= "':BEG.DATE'D2/':' " AND WITH PROC.DT <= "':END.DATE'D2/':'"'         ; * JMK78
      END                                ; * JMK78
                                         ; * JMK71 ; * JMK78


      EXECUTE STMT CAPTURING OUTPUT
*DFIF USER='DAVID' THEN CALL ELINE('STMT':STMT)
      NUM.EBILL=@SELECTED
      CARRIER.ID="00041"
      READ CARRIER.REC FROM F.CARRIERS,CARRIER.ID THEN
         CARRIER.NAME=CARRIER.REC<1>
         CARRIER.MODE=CARRIER.REC<44>
         READ TR.REC FROM F.TRANSPORT,CARRIER.MODE THEN
            TR.MODE=TR.REC<1>
         END ELSE
            TR.MODE=''
         END
      END ELSE
         CARRIER.NAME=''
         CARRIER.MODE=''
         TR.MODE=''
      END

      IF NUM.EBILL > 0 THEN              ; * JCW02
         DONE=0
         EBILL.CNT=0
         EBILL.PER=''
         COMM.ARRAY =''
         LOOP
            READNEXT EBILL.ID ELSE DONE=1
         UNTIL DONE=1
            EBILL.DATE=FIELD(EBILL.ID,'*',2)
            EBILL.CNT+=1
            CALL PROG.BAR(22,EBILL.CNT,NUM.EBILL,EBILL.PER)
            READ EBILL.REC FROM F.UPSDATA,EBILL.ID THEN
               PRV.SHIPPER=''            ; * JMK75
               NUM.OF.REC=DCOUNT(EBILL.REC,@AM)
               FOR I = 2 TO NUM.OF.REC

                  BEGIN CASE
                     CASE CLIENT='01706'
                        BEGIN CASE
                           CASE EBILL.REC<I,3>[1,1]="'"
                              UPS.SHIPPER=EBILL.REC<I,3>[2,6]
                           CASE LEN(EBILL.REC<I,3>)=6
                              UPS.SHIPPER=EBILL.REC<I,3>
                           CASE 1
                              UPS.SHIPPER=EBILL.REC<I,3>[5,6]
                        END CASE
                        ECAX.ID='00041*':UPS.SHIPPER
                        IF UPS.SHIPPER='500426' THEN
                           ECAX.ID='12810*':UPS.SHIPPER
                        END
                        READ ECAX.REC FROM F.ECAX,ECAX.ID ELSE ECAX.REC=''
                        DIV.ID=ECAX.REC<2>
                        REG.ID=''
                        MATREAD DIV.REC FROM F.DIVISION,DIV.ID ELSE MAT DIV.REC=''
                        REG.ID=DIV.REC(45)
                        AREA.ID=DIV.REC(46)        ; * JMK76
                        FILE.DATE=EBILL.REC<I,5>
                        PRO.NUMBER=UPS.SHIPPER[1,3]:'-':UPS.SHIPPER[4,3]
                        PRO.NUMBER:=FILE.DATE[1,2]:FILE.DATE[3,2]:FILE.DATE[7,2]
                        BILLS.ID=CARRIER.ID:'*':PRO.NUMBER:'-O*0'      ; * Same ID used for Bills, Bills Hist, and CRX
                        READ BILLS.REC FROM FB.BILLS,BILLS.ID ELSE
                           BILLS.ID=CARRIER.ID:'*':PRO.NUMBER:'-I*0'   ; * Same ID used for Bills, Bills Hist, and CRX
                           READ BILLS.REC FROM FB.BILLS,BILLS.ID ELSE
                              BILLS.ID=CARRIER.ID:'*':PRO.NUMBER:'-T*0'          ; * Same ID used for Bills, Bills Hist, and CRX
                              READ BILLS.REC FROM FB.BILLS,BILLS.ID ELSE
                                 BILLS.REC=''
                              END
                           END
                        END

                        LINE=''
                        LINE<1,1>=CARRIER.ID
                        LINE<1,2>=CARRIER.NAME
                        LINE<1,3>=CARRIER.MODE
                        LINE<1,4>=TR.MODE
                        LINE<1,5>=EBILL.REC<I,7>
                        TEMP=EBILL.REC<I,5>
                        TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]
                        LINE<1,6>=TEMP
                        BEGIN CASE
                           CASE EBILL.REC<I,22>='1' OR EBILL.REC<I,22>='4'
                              IOT='O'
                           CASE EBILL.REC<I,22>='2'
                              IOT='I'
                           CASE EBILL.REC<I,22>='3'
                              IOT='T'
                           CASE EBILL.REC<I,22>=''
                              IOT='O'
                        END CASE
                        LINE<1,7>=IOT
                        IF IOT='O' THEN
                           IF EBILL.REC<I,29>='' AND EBILL.REC<I,27>='' AND EBILL.REC<I,28>='' THEN
                              EBILL.REC<I,27>=DIV.REC(16)
                              EBILL.REC<I,28>=DIV.REC(17)
                              EBILL.REC<I,29>=DIV.REC(1)
                           END
                        END
                        LINE<1,8>=EBILL.REC<I,29>
                        LINE<1,9>=EBILL.REC<I,27>
                        LINE<1,10>=EBILL.REC<I,28>
                        LINE<1,11>=EBILL.REC<I,35>
                        LINE<1,12>=EBILL.REC<I,33>
                        LINE<1,13>=EBILL.REC<I,34>
                        LINE<1,14>=REG.ID
                        LINE<1,15>=EBILL.REC<I,89>
                        LINE<1,16>=EBILL.REC<I,14>
                        LINE<1,17>=EBILL.REC<I,37>
                        LINE<1,18>=EBILL.REC<I,37>
                        LINE<1,22>=DIV.ID
                        LINE<1,29>=EBILL.REC<I,9>
                        IF NOT(NUM(LINE<1,29>)) THEN LINE<1,29>=0      ; * TAG01
                        LINE<1,30>=EBILL.REC<I,31>
                        LINE<1,35>=BILLS.REC<37>'D2/'
                        LINE<1,50>=EBILL.REC<I,4>[2,9999]
                        LINE<1,60>=UPS.SHIPPER
                        LINE<1,61>=OCONV(EBILL.REC<I,24>,'MCT')
                        LINE<1,62>=OCONV(EBILL.REC<I,25>,'MCT')
                        LINE<1,63>=OCONV(EBILL.REC<I,26>,'MCT')
                        LINE<1,65>=OCONV(EBILL.REC<I,27>,'MCT')
                        LINE<1,66>=EBILL.REC<I,28>
                        LINE<1,67>=EBILL.REC<I,29>
                        LINE<1,70>=OCONV(EBILL.REC<I,30>,'MCT')
                        LINE<1,71>=OCONV(EBILL.REC<I,31>,'MCT')
                        LINE<1,72>=OCONV(EBILL.REC<I,32>,'MCT')
                        LINE<1,74>=OCONV(EBILL.REC<I,33>,'MCT')
                        LINE<1,75>=EBILL.REC<I,34>
                        LINE<1,76>=EBILL.REC<I,35>
                        LINE<1,77>=EBILL.REC<I,36>
                        TEMP=EBILL.REC<I,23>
                        TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]
                        LINE<1,79>=TEMP
                        LINE<1,86>=EBILL.REC<I,21>
                        LINE<1,207>=EBILL.REC<I,87>
                        LINE<1,237>=DIV.ID
                        LINE<1,238>=AREA.ID        ; * JMK76
                        IF RPT.STYLE='H' THEN      ; * JMK60
                           LNCOLOR=LNCOLOR=0       ; * JMK60
                           IF LNCOLOR=1 THEN       ; * JMK60
                              DARRAY.HTML<-1>=\<TR BGCOLOR="white">\   ; * JMK60
                           END ELSE      ; * JMK60
                              DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\         ; * JMK60
                           END           ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.ID:\</TD>\      ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.NAME:\</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.MODE:\</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:TR.MODE:\</TD>\         ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,7>:\</TD>\  ; * JMK60
                           TEMP=EBILL.REC<I,5>     ; * JMK60
                           TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]  ; * JMK60
                           DARRAY.HTML:=\<TD>\:TEMP:\</TD>\  ; * JMK60
                           BEGIN CASE    ; * JMK60
                              CASE EBILL.REC<I,22>='1' OR EBILL.REC<I,22>='4'    ; * JMK60
                                 IOT='O'           ; * JMK60
                              CASE EBILL.REC<I,22>='2'       ; * JMK60
                                 IOT='I'           ; * JMK60
                              CASE EBILL.REC<I,22>='3'       ; * JMK60
                                 IOT='T'           ; * JMK60
                              CASE EBILL.REC<I,22>=''        ; * JMK60
                                 IOT='O'           ; * JMK60
                           END CASE      ; * JMK60
                           DARRAY.HTML:=\<TD>\:IOT:\</TD>\   ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,29>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,27>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,28>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,35>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,33>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,34>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:REG.ID:\</TD>\          ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,89>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,14>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,37>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,37>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:DIV.ID:\</TD>\          ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,9>:\</TD>\  ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,31>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:BILLS.REC<37>'D2/':\</TD>\        ; * JMK60
                           FOR II = 1 TO 14
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,4>[2,9999]:\</TD>\    ; * JMK60
                           FOR II = 1 TO 9
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II

                           DARRAY.HTML:=\<TD>\:UPS.SHIPPER:\</TD>\     ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,24>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,25>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,26>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,27>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,28>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,29>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,30>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,31>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,32>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,33>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,34>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,35>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,36>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           TEMP=EBILL.REC<I,23>    ; * JMK60
                           TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]  ; * JMK60
                           DARRAY.HTML:=\<TD>\:TEMP:\</TD>\  ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,21>:\</TD>\           ; * JMK60
                           FOR II = 1 TO 120
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,87>:\</TD>\           ; * JMK60
                           FOR II = 1 TO 29
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II
                           DARRAY.HTML:=\<TD>\:DIV.ID:\</TD>\          ; * JMK60
                           DARRAY.HTML:=\<TD>\:AREA.ID:\</TD>\         ; * JMK76
                           DARRAY.HTML:=\</TR>\    ; * JMK60
                        END              ; * JMK60

                     CASE 1              ; * JMK78
                        BEGIN CASE       ; * JMK75
                           CASE I <= 2   ; * JMK75
                              PRV.UPS.SHIPPER=''   ; * JMK75
                              **  CASE EBILL.REC<I-1,3>[1,1]=\'\    ; * JMK75
                           CASE EBILL.REC<I-1,3>[1,1]="'"    ; * JMK75
                              PRV.UPS.SHIPPER=EBILL.REC<I-1,3>[2,6]    ; * JMK75
                           CASE LEN(EBILL.REC<I-1,3>)=6      ; * JMK75
                              PRV.UPS.SHIPPER=EBILL.REC<I-1,3>         ; * JMK75
                           CASE 1        ; * JMK75
                              PRV.UPS.SHIPPER=EBILL.REC<I-1,3>[5,6]    ; * JMK75
                        END CASE         ; * JMK75
                        BEGIN CASE

                           CASE EBILL.REC<I,3>[1,1]="'"
                              UPS.SHIPPER=EBILL.REC<I,3>[2,6]
                           CASE LEN(EBILL.REC<I,3>)=6
                              UPS.SHIPPER=EBILL.REC<I,3>
                           CASE 1
                              UPS.SHIPPER=EBILL.REC<I,3>[5,6]
                        END CASE
                        BEGIN CASE       ; * JMK75
                           CASE I+1 > NUM.OF.REC   ; * JMK75
                              NXT.UPS.SHIPPER=''   ; * JMK75
                              NXT.SVC.DESC=''      ; * JMK79

                           CASE EBILL.REC<I+1,3>[1,1]="'"    ; * JMK75
                              NXT.UPS.SHIPPER=EBILL.REC<I+1,3>[2,6]    ; * JMK75
                              NXT.SVC.DESC=TRIM(EBILL.REC<I+1,21>)     ; * JMK79
                           CASE LEN(EBILL.REC<I+1,3>)=6      ; * JMK75
                              NXT.UPS.SHIPPER=EBILL.REC<I+1,3>         ; * JMK75
                              NXT.SVC.DESC=TRIM(EBILL.REC<I+1,21>)     ; * JMK79
                           CASE 1        ; * JMK75
                              NXT.UPS.SHIPPER=EBILL.REC<I+1,3>[5,6]    ; * JMK75
                              NXT.SVC.DESC=TRIM(EBILL.REC<I+1,21>)     ; * JMK79
                        END CASE         ; * JMK75
                        ECAX.ID='00041*':UPS.SHIPPER
                        IF UPS.SHIPPER='500426' THEN
                           ECAX.ID='12810*':UPS.SHIPPER
                        END
                        READ ECAX.REC FROM F.ECAX,ECAX.ID ELSE ECAX.REC=''
                        DIV.ID=ECAX.REC<2>
                        REG.ID=''
                        MAT DIV.REC=''
                        IF DIVISION THEN
                           MATREAD DIV.REC FROM F.DIVISION,DIV.ID ELSE MAT DIV.REC=''
                           REG.ID=DIV.REC(45)
                        END
                        FILE.DATE=EBILL.REC<I,5>
                        PRO.NUMBER=UPS.SHIPPER[1,3]:'-':UPS.SHIPPER[4,3]
                        PRO.NUMBER:=FILE.DATE[1,2]:FILE.DATE[3,2]:FILE.DATE[7,2]
                        READ CARRIER.REC FROM F.CARRIERS,CARRIER.ID ELSE CARRIER.REC=''    ; * JMK74
                        IF UPS.SHIPPER#PRV.UPS.SHIPPER THEN  ; * JMK75
                           COMM.ARRAY=''           ; * JMK75
                           TEST.ID=CARRIER.ID:'*':PRO.NUMBER:'-O*0'    ; * Same ID used for Bills, Bills Hist, and CRX
                           READ TEST.REC FROM FB.BILLS,TEST.ID THEN    ; * JMK75
                              LOCATE TEST.ID IN COMM.ARRAY<1> SETTING BPOS ELSE  ; * JMK75
                                 COMM.ARRAY<1,-1>=TEST.ID    ; * JMK75
                                 COMM.ARRAY<2>+=TEST.REC<10>           ; * JMK75
                                 COMM.ARRAY<3>+=TEST.REC<11>           ; * JMK75
                                 COMM.ARRAY<4>+=TEST.REC<12>           ; * JMK75
                                 COMM.ARRAY<5>+=TEST.REC<42>           ; * JMK75
                                 COMM.ARRAY<6>+=TEST.REC<43>           ; * JMK75
                                 COMM.ARRAY<7>+=TEST.REC<44>           ; * JMK75
                              END        ; * JMK75
                           END           ; * JMK75
                           TEST.ID=CARRIER.ID:'*':PRO.NUMBER:'-I*0'    ; * Same ID used for Bills, Bills Hist, and CRX
                           READ TEST.REC FROM FB.BILLS,TEST.ID THEN    ; * JMK75
                              LOCATE TEST.ID IN COMM.ARRAY<1> SETTING BPOS ELSE  ; * JMK75
                                 COMM.ARRAY<1,-1>=TEST.ID    ; * JMK75
                                 COMM.ARRAY<2>+=TEST.REC<10>           ; * JMK75
                                 COMM.ARRAY<3>+=TEST.REC<11>           ; * JMK75
                                 COMM.ARRAY<4>+=TEST.REC<12>           ; * JMK75
                                 COMM.ARRAY<5>+=TEST.REC<42>           ; * JMK75
                                 COMM.ARRAY<6>+=TEST.REC<43>           ; * JMK75
                                 COMM.ARRAY<7>+=TEST.REC<44>           ; * JMK75
                              END        ; * JMK75
                           END           ; * JMK75
                           TEST.ID=CARRIER.ID:'*':PRO.NUMBER:'-T*0'    ; * Same ID used for Bills, Bills Hist, and CRX
                           READ TEST.REC FROM FB.BILLS,TEST.ID THEN    ; * JMK75
                              LOCATE TEST.ID IN COMM.ARRAY<1> SETTING BPOS ELSE  ; * JMK75
                                 COMM.ARRAY<1,-1>=TEST.ID    ; * JMK75
                                 COMM.ARRAY<2>+=TEST.REC<10>           ; * JMK75
                                 COMM.ARRAY<3>+=TEST.REC<11>           ; * JMK75
                                 COMM.ARRAY<4>+=TEST.REC<12>           ; * JMK75
                                 COMM.ARRAY<5>+=TEST.REC<42>           ; * JMK75
                                 COMM.ARRAY<6>+=TEST.REC<43>           ; * JMK75
                                 COMM.ARRAY<7>+=TEST.REC<44>           ; * JMK75
                              END        ; * JMK75
                           END           ; * JMK75
                        END              ; * JMK75
                        IF COMM.ARRAY<5>+0=0 THEN
                           EBILL.REC<I,92>=0
                        END
                        IF COMM.ARRAY<6>+0=0 THEN
                           EBILL.REC<I,93>=0
                        END
                        IF COMM.ARRAY<7>+0=0 THEN
                           EBILL.REC<I,94>=0
                        END

                        LINE=''
                        LINE<1,1>=CARRIER.ID
                        LINE<1,2>=CARRIER.NAME
                        LINE<1,3>=CARRIER.MODE
                        LINE<1,4>=TR.MODE
                        LINE<1,5>=EBILL.REC<I,7>
                        TEMP=EBILL.REC<I,5>
                        TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]
                        LINE<1,6>=TEMP
                        BEGIN CASE
                           CASE CLIENT.ID='01322' AND PRO.NUMBER='X76-0F0113013'           ; * JMK98
                              IOT='T'    ; * JMK98
                           CASE EBILL.REC<I,22>='1' OR EBILL.REC<I,22>='4'
                              IOT='O'
                           CASE EBILL.REC<I,22>='2'
                              IOT='I'
                           CASE EBILL.REC<I,22>='3'
                              IOT='T'
                           CASE EBILL.REC<I,22>=''
                              IOT='O'
                        END CASE
                        LINE<1,7>=IOT
                        IF IOT='O' THEN
                           IF EBILL.REC<I,29>='' AND EBILL.REC<I,27>='' AND EBILL.REC<I,28>='' THEN
                              EBILL.REC<I,27>=DIV.REC(16)
                              EBILL.REC<I,28>=DIV.REC(17)
                              EBILL.REC<I,29>=DIV.REC(1)
                           END
                        END
                        BILLS.ID=CARRIER.ID:'*':PRO.NUMBER:'-':IOT:'*0'          ; * Same ID used for Bills, Bills Hist, and CRX
                        READ BILLS.REC FROM FB.BILLS,BILLS.ID ELSE BILLS.REC=''
                        LINE<1,8>=EBILL.REC<I,29>
                        LINE<1,9>=EBILL.REC<I,27>
                        LINE<1,10>=EBILL.REC<I,28>
                        LINE<1,11>=EBILL.REC<I,35>
                        LINE<1,12>=EBILL.REC<I,33>
                        LINE<1,13>=EBILL.REC<I,34>
                        LINE<1,14>=EBILL.REC<I,89>           ; * EXPENSE.CODE
                        LINE<1,15>=EBILL.REC<I,14>

                        CARRIER.CHG=EBILL.REC<I,37>-EBILL.REC<I,92>-EBILL.REC<I,93>-EBILL.REC<I,94>  ; * JMK75
                        LINE<1,16>=CARRIER.CHG     ; * JMK75
                        ACTUAL.CHG=EBILL.REC<I,37>           ; * JMK75
                        LINE<1,17>=ACTUAL.CHG
                        IF BILLS.REC<8>+0=0 AND EBILL.REC<I,6> < 0 THEN
                           IF CARRIER.CHG<=0 THEN
                              LINE<1,16>=0
                           END
                           IF ACTUAL.CHG<=0 THEN
                              LINE<1,17>=0
                           END
                        END

                        UPS.BILL.REC=BILLS.REC     ; * JMK75
                        CVIN=BILLS.ID    ; * JMK75
                        CVIN<2>=CLIENT.REC(84)     ; * JMK75
                        CVIN<3>=CLIENT.REC(34)     ; * JMK75
                        CVIN<4>=CLIENT.REC(33)     ; * JMK75
                        CVIN<5>=CLIENT.REC(85)     ; * JMK75
                        CVIN<6>=CLIENT.REC(88)     ; * JMK75
                        CVIN<7>=CARRIER.ID         ; * JMK75
                        CVIN<8>=CLIENT   ; * JMK75
                        CVIN<9>=USER     ; * JMK75
                        CVIN<10>=CLIENT.REC(131)   ; * JMK75
                        CVIN<11>=CLIENT.REC(177)   ; * JMK75
                        CVIN<12>=CLIENT.REC(178)   ; * JMK75
                        CVIN<13>=CLIENT.REC(187)   ; * JMK75
                        CVIN<14>=CLIENT.REC(200)   ; * JMK75
                        CVIN<15>=CLIENT.REC(208)   ; * JMK75
                        CVIN<16>=CLIENT.REC(209)   ; * JMK75
                        CVIN<17>=CLIENT.REC(210)   ; * JMK75
                        CVIN<18>=CLIENT.REC(211)   ; * JMK75
                        CVIN<19>=CLIENT.REC(212)   ; * JMK75
                        CVIN<20>=CLIENT.REC(213)   ; * JMK75
                        CVIN<21>=CLIENT.REC(214)   ; * JMK75
                        CVIN<22>=CLIENT.REC(215)   ; * JMK75
                        CVIN<23>=CLIENT.REC(216)   ; * JMK75
                        CVIN<24>=CLIENT.REC(217)   ; * JMK75
                        CVIN<25>=CLIENT.REC(218)   ; * JMK75
                        CVIN<26>=CLIENT.REC(219)   ; * JMK75
                        CVIN<28>=CLIENT.REC(268)   ; * JMK82
                        UPS.BILL.REC<7>=ICONV(EBILL.REC<I,37>-EBILL.REC<I,92>-EBILL.REC<I,93>-EBILL.REC<I,94>,'MR2')     ; * JMK75
                        UPS.BILL.REC<8>=ICONV(EBILL.REC<I,37>,'MR2')   ; * JMK75  NET CHARGE
                        UPS.BILL.REC<10>=ICONV(EBILL.REC<I,92>,'MR2')  ; * JMK75   DISC VARIANCE
                        UPS.BILL.REC<11>=ICONV(EBILL.REC<I,93>,'MR2')  ; * JMK75    OVRCHG VARIANCE
                        UPS.BILL.REC<12>=ICONV(EBILL.REC<I,94>,'MR2')  ; * JMK75    LOGISTIC VARIANCE
                        IF BILLS.REC<8>+0=0 AND EBILL.REC<I,6> < 0 THEN
                           IF CARRIER.CHG<=0 THEN
                              UPS.BILL.REC<7>=0
                           END
                           IF ACTUAL.CHG<=0 THEN
                              UPS.BILL.REC<8>=0
                           END
                           UPS.BILL.REC<12>=UPS.BILL.REC<8>-UPS.BILL.REC<7>
                        END
                        CVOUT=''
                        DISCOUNT.COMM=0  ; * JMK75
                        OVERCHG.COMM=0   ; * JMK75
                        CONSULTING.COMM=0          ; * JMK75
                        EXPENSE.DIST.COMM=0        ; * JMK75
                        MGMT.SVC.COMM=0  ; * JMK75
                        MISR.CONS.COMM=0           ; * JMK75
                        OVERCHG.PERC=0   ; * JMK75
                        LOG.COMM.PERC=0  ; * JMK75
                        CALL CALC.COMMISSION(UPS.BILL.REC,CVIN,CVOUT)  ; * JMK75
                        DISCOUNT.COMM=CVOUT<1>     ; * JMK75
                        OVERCHG.COMM=CVOUT<2>      ; * JMK75
                        CONSULTING.COMM=CVOUT<3>   ; * JMK75
                        EXPENSE.DIST.COMM=CVOUT<4>           ; * JMK75
                        MGMT.SVC.COMM=CVOUT<5>     ; * JMK75
                        MISR.CONS.COMM=CVOUT<6>    ; * JMK75
                        OVERCHG.PERC=CVOUT<7>      ; * JMK75
                        LOG.COMM.PERC = CVOUT<8>   ; * JMK75

                        IF COMM.ARRAY<5>+0#0 THEN  ; * JMK75
                           COMM.ARRAY<5>-=DISCOUNT.COMM      ; * JMK75
                        END              ; * JMK75
                        IF COMM.ARRAY<6>+0#0 THEN  ; * JMK75
                           COMM.ARRAY<6>-=OVERCHG.COMM       ; * JMK75
                        END              ; * JMK75
                        IF COMM.ARRAY<7>+0#0 THEN  ; * JMK75
                           COMM.ARRAY<7>-=CONSULTING.COMM    ; * JMK75
                        END              ; * JMK75

                        IF UPS.SHIPPER#NXT.UPS.SHIPPER OR (CLIENT='01825' AND NXT.SVC.DESC='SERVICE CHARGE') THEN        ; * JMK75 ; * JMK79 ; * JMK80
                           IF COMM.ARRAY<5>+0#0 THEN         ; * JMK75
                              DISCOUNT.COMM+=COMM.ARRAY<5>   ; * JMK75
                              COMM.ARRAY<5>=0      ; * JMK79
                           END           ; * JMK75
                           IF COMM.ARRAY<6>+0#0 THEN         ; * JMK75
                              OVERCHG.COMM+=COMM.ARRAY<6>    ; * JMK75
                              COMM.ARRAY<6>=0      ; * JMK79
                           END           ; * JMK75
                           IF COMM.ARRAY<7>+0#0 THEN         ; * JMK75
                              CONSULTING.COMM+=COMM.ARRAY<7>           ; * JMK75
                              COMM.ARRAY<7>=0      ; * JMK79
                           END           ; * JMK75
                        END              ; * JMK75
                        LINE<1,18>=DISCOUNT.COMM'R26'        ; * JMK75
                        LINE<1,19>=OVERCHG.COMM'R26'         ; * JMK75
                        LINE<1,20>=CONSULTING.COMM'R26'      ; * JMK75   ***********************************************
                        LINE<1,21>=DIV.ID
                        IF CLIENT.ID = "01825" THEN
                           GB.EXP =LINE<1,14>      ; * EXPENSE.CODE
                           COM.TBL.ID = DATE():"*":CLIENT.ID:"*":EBILL.REC<I,4>[2,9999]    ; * INVOICE NUMBER

                           GB.COMM.TOT = LINE<1,20> + LINE<1,19>       ; * CONSULTING.COMM + OVERCHG.COM
                           READ COMM.DAT FROM F.COMMTBL,COM.TBL.ID THEN
                              LOCATE(GB.EXP,COMM.DAT<1>,1;CPOS;'AR') THEN
                                 COMM.DAT<2,CPOS>=COMM.DAT<2,CPOS> + GB.COMM.TOT
                              END ELSE
                                 COMM.DAT<1> = INSERT(COMM.DAT<1>,1,CPOS,0,GB.EXP)         ; * EXPENSE.CODE
                                 COMM.DAT<2> = INSERT(COMM.DAT<2>,1,CPOS,0,GB.COMM.TOT)
                              END
                           END ELSE
                              COMM.DAT=""
                              CPOS=1
                              COMM.DAT<1,CPOS> = GB.EXP
                              COMM.DAT<2,CPOS> = GB.COMM.TOT
                           END
                           WRITE COMM.DAT ON F.COMMTBL,COM.TBL.ID

                           COM.TBL.ID = DATE():"*":"EXP*":GB.EXP
                           READ COMM.DAT FROM F.COMMTBL,COM.TBL.ID THEN
                              ***LOCATE(GB.EXP,COMM.DAT<1>,1;CPOS) THEN
                              COMM.DAT<1>=COMM.DAT<1> + GB.COMM.TOT
                           END ELSE
                              ***    COMM.DAT<1,CPOS> = GB.EXP
                              COMM.DAT=""
                              COMM.DAT<1> = GB.COMM.TOT
                           END
                           WRITE COMM.DAT ON F.COMMTBL,COM.TBL.ID
                            LINE<1,195> = SEND.STORE
                              LINE<1,196> = RECV.STORE
                       
                        END

                        LINE<1,22>=EBILL.REC<I,92>           ; * JMK75
                        LINE<1,23>=EBILL.REC<I,93>           ; * JMK75
                        LINE<1,24>=EBILL.REC<I,94>           ; * JMK75
                        LINE<1,28>=EBILL.REC<I,9>
                        LINE<1,29>=EBILL.REC<I,31>
                        IF NOT(NUM(LINE<1,29>)) THEN LINE<1,29>=0      ; * TAG01
                        LINE<1,34>=BILLS.REC<37>'D2/'
                        LINE<1,49>=EBILL.REC<I,4>[2,9999]
                        LINE<1,59>=UPS.SHIPPER
                        LINE<1,60>=OCONV(EBILL.REC<I,24>,'MCT')
                        LINE<1,61>=OCONV(EBILL.REC<I,25>,'MCT')
                        LINE<1,62>=OCONV(EBILL.REC<I,26>,'MCT')
                        LINE<1,64>=OCONV(EBILL.REC<I,27>,'MCT')
                        LINE<1,65>=EBILL.REC<I,28>
                        LINE<1,66>=EBILL.REC<I,29>
                        LINE<1,69>=OCONV(EBILL.REC<I,30>,'MCT')
                        LINE<1,70>=OCONV(EBILL.REC<I,31>,'MCT')
                        LINE<1,71>=OCONV(EBILL.REC<I,32>,'MCT')
                        LINE<1,73>=OCONV(EBILL.REC<I,33>,'MCT')
                        LINE<1,74>=EBILL.REC<I,34>
                        LINE<1,75>=EBILL.REC<I,35>
                        LINE<1,76>=EBILL.REC<I,36>
                        IF USER = 'NMEDDAUGH' THEN DEBUG
                        TEMP=EBILL.REC<I,23>
                        TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]
                        LINE<1,78>=TEMP
                        LINE<1,84>=EBILL.REC<I,21>
                        LINE<1,156>=EBILL.REC<I,89>          ; * JMK74
                        LINE<1,157>=EBILL.REC<I,37>          ; * JMK74
                        LINE<1,188>=CARRIER.REC<12>          ; * JMK74
                        LINE<1,194>=EBILL.REC<I,86>
                        CSCAC.ID=CLIENT.ID:'*':CARRIER.ID    ; * JMK74
                        READ CSCAC.REC FROM F.CSCAC,CSCAC.ID ELSE CSCAC.REC=''   ; * JMK74
                        ITEM=CSCAC.REC<1>          ; * JMK74
                        IF ITEM='' THEN  ; * JMK74
                           READ CARR.REC FROM F.CARRIERS,CARRIER.ID ELSE CARR.REC=''       ; * JMK74
                           ITEM=CARR.REC<12>       ; * JMK74
                           IF ITEM='' THEN         ; * JMK74
                              ITEM=CARR.REC<1>[1,5]          ; * JMK74
                           END           ; * JMK74
                        END              ; * JMK74
                        LINE<1,201>=ITEM           ; * JMK74
                        LINE<1,202>=CARRIER.REC<2,1>         ; * JMK74
                        LINE<1,203>=CARRIER.REC<2,2>         ; * JMK74
                        LINE<1,204>=CARRIER.REC<3>           ; * JMK74
                        LINE<1,205>=CARRIER.REC<4>           ; * JMK74
                        LINE<1,206>=CARRIER.REC<5>           ; * JMK74
                        LINE<1,207>='EDI'
                        LINE<1,220>=EBILL.REC<I,12>          ; * JMK74
                        LINE<1,224>=REG.ID
                        LINE<1,225>=BILLS.REC<68>  ; * JMK74
                        LINE<1,226>=BILLS.REC<96>  ; * JMK74
                        LINE<1,230>=EBILL.REC<I,19>          ; * JMK68
                        OZIP=EBILL.REC<I,29>[1,5]'R%5'       ; * JMK74
                        DZIP=EBILL.REC<I,35>[1,5]'R%5'       ; * JMK74
                        READ OZIP.REC FROM F.ZIPS,OZIP ELSE OZIP.REC=''          ; * JMK74
                        READ DZIP.REC FROM F.ZIPS,DZIP ELSE DZIP.REC=''          ; * JMK74
                        LINE<1,232>=OZIP.REC<3>    ; * JMK74
                        LINE<1,233>=DZIP.REC<3>    ; * JMK74
                        LINE<1,234>=EBILL.REC<I,12>          ; * JMK74
                        LINE<1,235>=EBILL.REC<I,90>          ; * COST CENTER
                        LINE<1,236>=EBILL.REC<I,91>          ; * PROJECT NUMBER

                        IF RPT.STYLE='H' THEN      ; * JMK60
                           LNCOLOR=LNCOLOR=0       ; * JMK60
                           IF LNCOLOR=1 THEN       ; * JMK60
                              DARRAY.HTML<-1>=\<TR BGCOLOR="white">\   ; * JMK60
                           END ELSE      ; * JMK60
                              DARRAY.HTML<-1>=\<TR BGCOLOR="lightgrey">\         ; * JMK60
                           END           ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.ID:\</TD>\      ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.NAME:\</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:CARRIER.MODE:\</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:TR.MODE:\</TD>\         ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,7>:\</TD>\  ; * JMK60
                           TEMP=EBILL.REC<I,5>     ; * JMK60
                           TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]  ; * JMK60
                           DARRAY.HTML:=\<TD>\:TEMP:\</TD>\  ; * JMK60
                           BEGIN CASE    ; * JMK60
                              CASE EBILL.REC<I,22>='1' OR EBILL.REC<I,22>='4'    ; * JMK60
                                 IOT='O'           ; * JMK60
                              CASE EBILL.REC<I,22>='2'       ; * JMK60
                                 IOT='I'           ; * JMK60
                              CASE EBILL.REC<I,22>='3'       ; * JMK60
                                 IOT='T'           ; * JMK60
                              CASE EBILL.REC<I,22>=''        ; * JMK60
                                 IOT='O'           ; * JMK60
                           END CASE      ; * JMK60
                           DARRAY.HTML:=\<TD>\:IOT:\</TD>\   ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,29>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,27>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,28>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,35>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,33>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,34>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,89>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,14>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,37>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,37>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:DIV.ID:\</TD>\          ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,9>:\</TD>\  ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,31>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:BILLS.REC<37>'D2/':\</TD>\        ; * JMK60
                           FOR II = 1 TO 14
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II

                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,4>[2,9999]:\</TD>\    ; * JMK60
                           FOR II = 1 TO 9
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT

                           DARRAY.HTML:=\<TD>\:UPS.SHIPPER:\</TD>\     ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,24>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,25>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,26>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,27>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,28>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,29>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,30>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,31>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,32>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:OCONV(EBILL.REC<I,33>,'MCT'):\</TD>\        ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,34>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,35>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,36>:\</TD>\           ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           TEMP=EBILL.REC<I,23>    ; * JMK60
                           TEMP=TEMP[1,2]:"/":TEMP[3,2]:"/":TEMP[5,4]  ; * JMK60
                           DARRAY.HTML:=\<TD>\:TEMP:\</TD>\  ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>&nbsp;</TD>\    ; * JMK60
                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,21>:\</TD>\           ; * JMK60
                           FOR II = 1 TO 120
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II

                           DARRAY.HTML:=\<TD>\:EBILL.REC<I,87>:\</TD>\           ; * JMK60
                           FOR II = 1 TO 16
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II

                           DARRAY.HTML:=\<TD>\:REG.ID:\</TD>\          ; * JMK60
                           FOR II = 1 TO 12
                              DARRAY.HTML:=\<TD>&nbsp;</TD>\           ; * JMK60
                           NEXT II

                           DARRAY.HTML:=\</TR>\    ; * JMK60
                        END              ; * JMK60
                  END CASE
                  IF CLIENT.ID='01706' AND LINE<1,18>+0=0 THEN         ; * DRF08
                     NULL                ; * DRF08
                  END ELSE               ; * DRF08
                     DARRAY<-1>=LINE
                  END                    ; * DRF08
SKIP.NEXT.EBILL.LINE:***     ; * DRF04
               NEXT I
               IF CLIENT='02138' AND VERSION='526' THEN      ; * DRF04
                  IF SUBTOTAL#'' THEN DARRAY<-1>=SUBTOTAL    ; * DRF04
                  DARRAY<-1>=TOTAL       ; * DRF04
               END                       ; * DRF04
            END
         REPEAT
      END
      RETURN
*****************************************************************
HANDLE.LI.CODES:                         ; * SWB03
****************************************************************

      IF ITEM # '' THEN                  ; * SWB03
         T.FILE.ITEM='---Unknown---'     ; * JMK87    ; * SWB03
         BEGIN CASE                      ; * JMK87    ; * SWB03
            CASE PRO.REC(21)='12'        ; * JMK87    ; * SWB03
               LOCATE ITEM IN AIR.CODES<1> SETTING POS THEN  ; * JMK87    ; * SWB03
                  T.FILE.ITEM=AIR.CODES<2,POS>     ; * JMK87              ; * SWB03
               END                       ; * JMK87                        ; * SWB03
            CASE PRO.REC(21)='8' OR PRO.REC(3)='99999' OR PRO.REC(4)='99999'     ; * JMK87    ; * SWB03
               LOCATE ITEM IN INTL.CODES<1> SETTING POS THEN           ; * JMK87              ; * SWB03
                  T.FILE.ITEM=INTL.CODES<2,POS>    ; * JMK87                                  ; * SWB03
               END                       ; * JMK87                                            ; * SWB03
            CASE 1                       ; * SWB03
               LOCATE ITEM IN LI.CODES<1> SETTING POS THEN   ; * JMK87    ; * SWB03
                  T.FILE.ITEM=LI.CODES<2,POS>      ; * JMK87              ; * SWB03
               END                       ; * JMK87                        ; * SWB03
         END CASE                        ; * JMK87                        ; * SWB03
      END ELSE                           ; * SWB03
         T.FILE.ITEM=''                  ; * SWB03
      END                                ; * SWB03

      RETURN                             ; * SWB03
